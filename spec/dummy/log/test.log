  [1m[35m (0.4ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20160809214321)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-02 20:23:01.135569"], ["updated_at", "2017-08-02 20:23:01.135569"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-02 20:25:37.329078"], ["updated_at", "2017-08-02 20:25:37.329078"]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-02 20:26:24.672873"], ["updated_at", "2017-08-02 20:26:24.672873"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$LTWurd/13vbTrPUQZKvOOuFF5pXx2.XTtO8sVKRQiFbPxqZpXiBQS"], ["created_at", "2017-08-02 20:26:24.761483"], ["updated_at", "2017-08-02 20:26:24.761483"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:7PqKkCiJhq_1T7DqWFLo"], ["updated_at", "2017-08-02 20:26:24.766105"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (2.6ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-02 20:26:57.673613"], ["updated_at", "2017-08-02 20:26:57.673613"]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$fBzU7JFGPt4YBazixzC5xeFEogKmaMS2Dl6P5vII7d8bPj3tcA0dq"], ["created_at", "2017-08-02 20:26:57.779239"], ["updated_at", "2017-08-02 20:26:57.779239"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:QVpso4y-qaqSyGysBJCb"], ["updated_at", "2017-08-02 20:26:57.782255"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-02 20:28:00.598300"], ["updated_at", "2017-08-02 20:28:00.598300"]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$5UcGP0Q4qCMGgjlKGtphheIs/FSi6LKREAg4W94GFk8KDylyPCpFa"], ["created_at", "2017-08-02 20:28:00.685338"], ["updated_at", "2017-08-02 20:28:00.685338"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:ztAvJTBqUpbRysxeu1Bv"], ["updated_at", "2017-08-02 20:28:00.687586"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"34", "user_reply"=>"yes"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "34"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 0.3ms)
  [1m[35m (2.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-02 20:28:29.877203"], ["updated_at", "2017-08-02 20:28:29.877203"]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$tA2qw5K0l4HJv29veeqNT.Gc7Bnpcc0C8u0YZq6Alft1vpRTTuMli"], ["created_at", "2017-08-02 20:28:29.980227"], ["updated_at", "2017-08-02 20:28:29.980227"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:MBKzbkzYXa4eyeA8CLZ9"], ["updated_at", "2017-08-02 20:28:29.982562"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"34", "user_reply"=>"yes"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "34"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.6ms | ActiveRecord: 0.3ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-02 20:34:37.107759"], ["updated_at", "2017-08-02 20:34:37.107759"]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-02 20:35:40.364138"], ["updated_at", "2017-08-02 20:35:40.364138"]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$4mADRFTfH49Ya9Mc.8hjaOOfqs5isAbb47fmzTin.eHoV5ZQ3YIbK"], ["created_at", "2017-08-02 20:35:40.456501"], ["updated_at", "2017-08-02 20:35:40.456501"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:xm6yQXEPo7FdEkERrUam"], ["updated_at", "2017-08-02 20:35:40.458720"], ["id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"34", "user_reply"=>"yes"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "34"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.6ms | ActiveRecord: 0.3ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (2.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-02 20:36:05.507227"], ["updated_at", "2017-08-02 20:36:05.507227"]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$/Z6JIZWDUuzpBMuu924Xr.C7tSyDRuqyoUglLaqFoQr/Wi9v0DbZi"], ["created_at", "2017-08-02 20:36:05.610258"], ["updated_at", "2017-08-02 20:36:05.610258"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:G8rrGbr3KFve1zfbdWbp"], ["updated_at", "2017-08-02 20:36:05.612250"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"34", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "34"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.6ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-02 20:41:27.062237"], ["updated_at", "2017-08-02 20:41:27.062237"]]
  [1m[35m (0.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$7zHZw7227Binh59BLVkKP.bB8NwM5l9J058s9WRlhjI3xnCyMFmF6"], ["created_at", "2017-08-02 20:41:27.163042"], ["updated_at", "2017-08-02 20:41:27.163042"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:rzugymfEXi7knxzs4tbG"], ["updated_at", "2017-08-02 20:41:27.164878"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"34", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "34"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-02 20:41:56.644032"], ["updated_at", "2017-08-02 20:41:56.644032"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$du53Vy6U.r.ZMtuslaEM9O8jx3sDJTqcsUQryL7zJUZrUFdXV56WC"], ["created_at", "2017-08-02 20:41:56.743746"], ["updated_at", "2017-08-02 20:41:56.743746"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:4UWyz9ckSydsCzx3B9xx"], ["updated_at", "2017-08-02 20:41:56.747523"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"34", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "34"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-02 20:42:26.069646"], ["updated_at", "2017-08-02 20:42:26.069646"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$oWS6Z1YOxTlfJSoa/G0E4eqrZVFqZ67bLAkCO36reQlaif6c2wQZ2"], ["created_at", "2017-08-02 20:42:26.162728"], ["updated_at", "2017-08-02 20:42:26.162728"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:2S7kDXBMyqUzfWkyn8Ko"], ["updated_at", "2017-08-02 20:42:26.164591"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"34", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "34"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 5ms (ActiveRecord: 0.2ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-02 20:55:43.579296"], ["updated_at", "2017-08-02 20:55:43.579296"]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.7ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$0TVjjyozrlVLeGHCh6M3jOliNOHk/zgBtDngofFxS/QCclCT/kApa"], ["created_at", "2017-08-02 20:55:43.696569"], ["updated_at", "2017-08-02 20:55:43.696569"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:ZYvsv1UjefugxHEDf6eG"], ["updated_at", "2017-08-02 20:55:43.701020"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"34", "user_reply"=>"yes"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "34"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 15ms (ActiveRecord: 0.6ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-02 20:58:51.989221"], ["updated_at", "2017-08-02 20:58:51.989221"]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$fEuwAlZVlM0BN9Q0lIfd2e9uWTFXKw3XJ0BeKK/FhDdfYVddCd9.W"], ["created_at", "2017-08-02 20:58:52.079450"], ["updated_at", "2017-08-02 20:58:52.079450"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:sKy6fpQoH6FozfWgr8fS"], ["updated_at", "2017-08-02 20:58:52.081925"], ["id", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"34", "user_reply"=>"yes"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "34"], ["LIMIT", 1]]
Completed 200 OK in 64252ms (Views: 0.6ms | ActiveRecord: 0.4ms)
  [1m[35m (1.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-02 21:00:04.244366"], ["updated_at", "2017-08-02 21:00:04.244366"]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$YwLDGSR5sIkrTQeKqgOOkulORc4CzB6u7nfTAIqSL/jGlAD7Ng6kC"], ["created_at", "2017-08-02 21:00:04.354381"], ["updated_at", "2017-08-02 21:00:04.354381"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:P6JSWXVXQqbjrBEtTXsz"], ["updated_at", "2017-08-02 21:00:04.356378"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.6ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-02 21:00:49.371487"], ["updated_at", "2017-08-02 21:00:49.371487"]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$r36GnNJEK/Z/ypCDgBjOz.63GvjHxZ1a6GZt/6QoMPfLMMLoy8yhi"], ["created_at", "2017-08-02 21:00:49.458170"], ["updated_at", "2017-08-02 21:00:49.458170"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:RvAo9ndvshh7UaUhYHYv"], ["updated_at", "2017-08-02 21:00:49.460422"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.6ms | ActiveRecord: 0.2ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.5ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 09:07:13.942892"], ["updated_at", "2017-08-03 09:07:13.942892"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$ksRYBZjjRE7wBjFsvu.LS./R4ncc43MaLVpP2rW2DlUwS5e0xUpQe"], ["created_at", "2017-08-03 09:07:14.036666"], ["updated_at", "2017-08-03 09:07:14.036666"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:Xs3X_sx_tpz2zszadFgs"], ["updated_at", "2017-08-03 09:07:14.040696"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.7ms | ActiveRecord: 0.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 9ms (Views: 0.7ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.6ms | ActiveRecord: 0.5ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.6ms | ActiveRecord: 0.5ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 9ms (Views: 0.6ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.8ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 1.0ms | ActiveRecord: 0.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 10ms (Views: 0.7ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 10ms (Views: 1.0ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.6ms | ActiveRecord: 0.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 9ms (Views: 1.2ms | ActiveRecord: 0.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.6ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 11ms (Views: 0.9ms | ActiveRecord: 1.3ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.7ms | ActiveRecord: 0.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 9ms (Views: 0.7ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 11ms (Views: 0.9ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.7ms | ActiveRecord: 0.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 13ms (Views: 1.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 10ms (Views: 0.7ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 15ms (Views: 1.3ms | ActiveRecord: 1.5ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 26ms (Views: 1.0ms | ActiveRecord: 2.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.7ms | ActiveRecord: 0.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 14ms (Views: 1.1ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (1.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 25ms (Views: 1.3ms | ActiveRecord: 4.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 12ms (Views: 0.9ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 11ms (Views: 0.9ms | ActiveRecord: 1.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.7ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 11ms (Views: 1.1ms | ActiveRecord: 1.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.8ms | ActiveRecord: 0.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 10ms (Views: 0.7ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 12ms (Views: 0.8ms | ActiveRecord: 1.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[35m (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$Wix8bltMlj0D8rli8cZ96ebbuGyPVVNZlSlvIplzwkB9qyKSISOJS"], ["created_at", "2017-08-03 09:07:18.492156"], ["updated_at", "2017-08-03 09:07:18.492156"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:s-DsFUSzaKYAEAEy-wnM"], ["updated_at", "2017-08-03 09:07:18.493657"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 09:07:57.473224"], ["updated_at", "2017-08-03 09:07:57.473224"]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$kMfmKn2w7IQJ1Goa0q99VepXOvh8hpvgKg0h8yo9SL5K1ov4dFq9G"], ["created_at", "2017-08-03 09:07:57.572773"], ["updated_at", "2017-08-03 09:07:57.572773"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:ExQzG2d4Py-E-622Pp_q"], ["updated_at", "2017-08-03 09:07:57.574690"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3013ms (Views: 0.9ms | ActiveRecord: 1.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3014ms (Views: 0.9ms | ActiveRecord: 1.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3015ms (Views: 0.8ms | ActiveRecord: 1.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3011ms (Views: 0.8ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3016ms (Views: 0.9ms | ActiveRecord: 1.3ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3012ms (Views: 0.8ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3014ms (Views: 0.9ms | ActiveRecord: 1.5ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3012ms (Views: 1.2ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3012ms (Views: 1.0ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3013ms (Views: 1.0ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3009ms (Views: 0.8ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3012ms (Views: 0.9ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3013ms (Views: 1.0ms | ActiveRecord: 1.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3014ms (Views: 0.8ms | ActiveRecord: 1.3ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3013ms (Views: 0.7ms | ActiveRecord: 1.5ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3013ms (Views: 1.0ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3012ms (Views: 1.0ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3015ms (Views: 0.8ms | ActiveRecord: 1.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3014ms (Views: 0.9ms | ActiveRecord: 1.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3015ms (Views: 0.9ms | ActiveRecord: 1.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3011ms (Views: 0.9ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3017ms (Views: 1.0ms | ActiveRecord: 1.3ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3015ms (Views: 1.0ms | ActiveRecord: 1.5ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3018ms (Views: 0.7ms | ActiveRecord: 1.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3013ms (Views: 1.0ms | ActiveRecord: 1.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3015ms (Views: 0.9ms | ActiveRecord: 1.3ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3014ms (Views: 0.9ms | ActiveRecord: 1.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3011ms (Views: 0.7ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3011ms (Views: 0.9ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3013ms (Views: 1.2ms | ActiveRecord: 1.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3015ms (Views: 1.0ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3012ms (Views: 0.9ms | ActiveRecord: 0.8ms)
  [1m[35m (1.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 09:09:58.354650"], ["updated_at", "2017-08-03 09:09:58.354650"]]
  [1m[35m (0.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (1.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$C.UPxoN0/oA9U/j/cvb/V.DqCNB/t7Pw7V68Tvk1HsX1OBjdrJacq"], ["created_at", "2017-08-03 09:09:58.462172"], ["updated_at", "2017-08-03 09:09:58.462172"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:TG-sDVYRCMBtBRkawxGt"], ["updated_at", "2017-08-03 09:09:58.466095"], ["id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3013ms (Views: 0.8ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3015ms (Views: 0.8ms | ActiveRecord: 1.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3015ms (Views: 0.8ms | ActiveRecord: 1.3ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3012ms (Views: 0.9ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3014ms (Views: 0.9ms | ActiveRecord: 1.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3011ms (Views: 0.8ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3016ms (Views: 0.8ms | ActiveRecord: 1.3ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3012ms (Views: 0.8ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3014ms (Views: 0.8ms | ActiveRecord: 1.3ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3012ms (Views: 1.0ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3015ms (Views: 0.8ms | ActiveRecord: 1.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3015ms (Views: 0.8ms | ActiveRecord: 1.3ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3013ms (Views: 0.8ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3014ms (Views: 0.9ms | ActiveRecord: 1.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3014ms (Views: 0.9ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3019ms (Views: 1.2ms | ActiveRecord: 2.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3013ms (Views: 0.8ms | ActiveRecord: 1.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3012ms (Views: 0.8ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3012ms (Views: 0.8ms | ActiveRecord: 1.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3013ms (Views: 0.7ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3014ms (Views: 0.8ms | ActiveRecord: 1.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 09:11:11.476971"], ["updated_at", "2017-08-03 09:11:11.476971"]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$UjFRDRNlN5hFBW3OYJXsEuNeZ.22YTDvROBm4cLeZwEAyxzZR5JAm"], ["created_at", "2017-08-03 09:11:11.585306"], ["updated_at", "2017-08-03 09:11:11.585306"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:6vFQ77uysiDvTBCJMmx4"], ["updated_at", "2017-08-03 09:11:11.587098"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3014ms (Views: 0.9ms | ActiveRecord: 1.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3015ms (Views: 0.8ms | ActiveRecord: 1.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3014ms (Views: 0.8ms | ActiveRecord: 1.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3011ms (Views: 0.7ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3013ms (Views: 0.8ms | ActiveRecord: 1.5ms)
  [1m[35m (1.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$M6QF646AjKTVZyHHmm.lOOzHC8lihruR2dwMseo0D.NE6ItJsyoNm"], ["created_at", "2017-08-03 09:11:27.291062"], ["updated_at", "2017-08-03 09:11:27.291062"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:HVDTzRuEKzW-ry3gJo6Z"], ["updated_at", "2017-08-03 09:11:27.294877"], ["id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3014ms (Views: 0.5ms | ActiveRecord: 0.4ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 09:11:41.985774"], ["updated_at", "2017-08-03 09:11:41.985774"]]
  [1m[35m (0.5ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (2.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$BvQr1AzmLSna36J3vKbyMuZTJ8gnkO4cvyoUCU8B8uYl928vWyY8C"], ["created_at", "2017-08-03 09:11:42.115061"], ["updated_at", "2017-08-03 09:11:42.115061"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:huwjaisyH_WaDru768eW"], ["updated_at", "2017-08-03 09:11:42.119928"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.6ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.5ms | ActiveRecord: 0.5ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.6ms | ActiveRecord: 0.5ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.5ms | ActiveRecord: 0.5ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$aPXL.ZhuR.5xwZD4Qt6QKuS7c4ysuD8VVkWrdPXXwAdjrxvIgM4jK"], ["created_at", "2017-08-03 09:11:42.761447"], ["updated_at", "2017-08-03 09:11:42.761447"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:yTngKkPcxkfs8cEx73Cx"], ["updated_at", "2017-08-03 09:11:42.763134"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 1.1ms | ActiveRecord: 0.2ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 09:17:19.284606"], ["updated_at", "2017-08-03 09:17:19.284606"]]
  [1m[35m (1.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$KL/vqBzSDEpBW9myd4CZGuSko22fcg0VyNKl6iLYVASP34MwYSBbq"], ["created_at", "2017-08-03 09:17:19.418224"], ["updated_at", "2017-08-03 09:17:19.418224"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:f1qGhroAbmLtu-FsGasj"], ["updated_at", "2017-08-03 09:17:19.422293"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.6ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 9ms (Views: 0.9ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.6ms | ActiveRecord: 0.5ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 10ms (Views: 0.7ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.6ms | ActiveRecord: 0.6ms)
  [1m[35m (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$XrWFsQzyjvDGv.dGwpjeoegKlMdIjGlSus3ro8yzFQghTstQQbYzi"], ["created_at", "2017-08-03 09:17:20.026216"], ["updated_at", "2017-08-03 09:17:20.026216"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:dPKDzEohw2aUGfg7ncC_"], ["updated_at", "2017-08-03 09:17:20.027578"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$.kNfbbhtrVyGANwaDj/3weLkmWxlT3.Ah2mUwcJ0Lg5Wm8E6eN9vi"], ["created_at", "2017-08-03 09:17:20.060926"], ["updated_at", "2017-08-03 09:17:20.060926"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:7ZF7HiXgCc-pu_hUGbFT"], ["updated_at", "2017-08-03 09:17:20.063749"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (2.5ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 09:18:03.131206"], ["updated_at", "2017-08-03 09:18:03.131206"]]
  [1m[35m (1.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (2.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$UGgxKFsSYroVfE7cv/2XcOd./nJPi25K8nrdQucK23bqu85Vaci66"], ["created_at", "2017-08-03 09:18:03.263208"], ["updated_at", "2017-08-03 09:18:03.263208"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:rgbK4-ruAR9GCDzX8fig"], ["updated_at", "2017-08-03 09:18:03.267788"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 11ms (Views: 1.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 11ms (Views: 0.7ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.7ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.9ms | ActiveRecord: 0.5ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[35m (1.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$OVvj3FST0cQpJRlwuYukJOjNbEQrq9RX9JzvjkdvBRlDOglSkzSKW"], ["created_at", "2017-08-03 09:18:03.917542"], ["updated_at", "2017-08-03 09:18:03.917542"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:jHagmrbPyytczs92DG3_"], ["updated_at", "2017-08-03 09:18:03.919566"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.8ms | ActiveRecord: 0.4ms)
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$vNLB/RGxql.Ens8FZsQHl.5PphsXUzGIPnwW8ez3Y7yy/Kwv/NVqG"], ["created_at", "2017-08-03 09:18:03.986508"], ["updated_at", "2017-08-03 09:18:03.986508"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:H3e7zpRgqArxETxGGses"], ["updated_at", "2017-08-03 09:18:03.988614"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 09:22:50.368288"], ["updated_at", "2017-08-03 09:22:50.368288"]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.8ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$sLKpLMhcH3yycQsc21EcAeEU9zSW3E2NobHHVMh0sNSaN/R4ynvYa"], ["created_at", "2017-08-03 09:22:50.486082"], ["updated_at", "2017-08-03 09:22:50.486082"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:izHHnQKv9k5psK19bWN6"], ["updated_at", "2017-08-03 09:22:50.489120"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.6ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 9ms (Views: 0.9ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.6ms | ActiveRecord: 0.5ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.6ms | ActiveRecord: 0.5ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 9ms (Views: 0.7ms | ActiveRecord: 0.8ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$YEZ.wcLi9Qofq5Nckhpo9uM5KgfwMcHWjjaKNHzlSA6ZyTjBSwKiy"], ["created_at", "2017-08-03 09:22:51.087420"], ["updated_at", "2017-08-03 09:22:51.087420"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:jehLNNvt2q9o-CtBxQNi"], ["updated_at", "2017-08-03 09:22:51.088840"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$1rXYmXjDhaAb4eqsi8Xlr.EtX6BhK4Hw.8sru74/ww3lxUjL.UyPe"], ["created_at", "2017-08-03 09:22:51.126265"], ["updated_at", "2017-08-03 09:22:51.126265"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.6ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:WrrqbNT-n8hkE7nXmBnq"], ["updated_at", "2017-08-03 09:22:51.129220"], ["id", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (2.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 09:23:33.216743"], ["updated_at", "2017-08-03 09:23:33.216743"]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$5yFywYYISZ3CGKaiVmzYN.FURZUFjBbYrmileta3juqSfwBiglYMC"], ["created_at", "2017-08-03 09:23:33.350213"], ["updated_at", "2017-08-03 09:23:33.350213"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:5DazH1PebngNZuFxfTAo"], ["updated_at", "2017-08-03 09:23:33.353422"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 10ms (Views: 0.7ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.9ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.6ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[35m (1.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$oM33SV6iQu6Sl1XKywqQ0.MoFXzv3ohcoex.vh3cYZVqAvKrdVwGi"], ["created_at", "2017-08-03 09:23:33.968107"], ["updated_at", "2017-08-03 09:23:33.968107"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:GpKpexvkNcnghyGeTs5r"], ["updated_at", "2017-08-03 09:23:33.969715"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$M/J7Iv64mhtLJXKhXVBMzes/Z3a.1/GDO93CP/A5mu9s6ITEmc6rS"], ["created_at", "2017-08-03 09:23:33.992175"], ["updated_at", "2017-08-03 09:23:33.992175"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:TgycsQHz-VAAWnRJsguY"], ["updated_at", "2017-08-03 09:23:33.993824"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 0.3ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 09:24:59.480922"], ["updated_at", "2017-08-03 09:24:59.480922"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$uxL07Xx1TrZA3d08R9dHou.wLrce/YRvmFD/rEOXyWd5cfknc3BUe"], ["created_at", "2017-08-03 09:24:59.587681"], ["updated_at", "2017-08-03 09:24:59.587681"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:69v2H2Y9XbzPCDbzk8P5"], ["updated_at", "2017-08-03 09:24:59.589640"], ["id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 10ms (Views: 0.8ms | ActiveRecord: 1.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 9ms (Views: 0.7ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.7ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.6ms | ActiveRecord: 0.5ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[35m (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$TAwAB0I2sJr6v/11bYyXO.A/lizh7YzxKbXUODfIBtLaQCUXZHYq6"], ["created_at", "2017-08-03 09:25:00.212293"], ["updated_at", "2017-08-03 09:25:00.212293"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:C_cyULkDfxQSL6MkX7mU"], ["updated_at", "2017-08-03 09:25:00.213883"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$UMHeuZ/eqbL1q.1nH76pYeQWaNzhJTx7uBIlo2wWWrDV9U0LfmhQm"], ["created_at", "2017-08-03 09:25:00.248897"], ["updated_at", "2017-08-03 09:25:00.248897"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:u_QSYSHi5n4HW8fH2QdN"], ["updated_at", "2017-08-03 09:25:00.251959"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.4ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 09:25:24.451272"], ["updated_at", "2017-08-03 09:25:24.451272"]]
  [1m[35m (1.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$XPMr7IH.bybqj3lsa5nQPuWZ0AQ/DPIDNKX5lfI3n5yK/2LjND4jW"], ["created_at", "2017-08-03 09:25:24.588303"], ["updated_at", "2017-08-03 09:25:24.588303"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:mbLny79sZAfq8LMDL5QK"], ["updated_at", "2017-08-03 09:25:24.591423"], ["id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 11ms (Views: 0.7ms | ActiveRecord: 1.3ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 10ms (Views: 0.6ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.6ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.7ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.6ms | ActiveRecord: 0.7ms)
  [1m[35m (1.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$qV/HFVuVw6vdsmMhbR3RLOYI7nv4Hrr5iV4Jwe.joBPTdXtUhqCYu"], ["created_at", "2017-08-03 09:25:25.206331"], ["updated_at", "2017-08-03 09:25:25.206331"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:U4kHqpN6xuHRx5XyPr3H"], ["updated_at", "2017-08-03 09:25:25.207902"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.4ms | ActiveRecord: 0.3ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$xcpEuVjkNMUsgt7KlY7AHe/wFLB2Z1ewlWOq3/KKVW1FkCyni95Ja"], ["created_at", "2017-08-03 09:25:25.265490"], ["updated_at", "2017-08-03 09:25:25.265490"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:yRGXsjohg5gxe1v5wixa"], ["updated_at", "2017-08-03 09:25:25.267244"], ["id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 09:26:09.124873"], ["updated_at", "2017-08-03 09:26:09.124873"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$GE88UVO661IG7834ZY.jCenLTtkrwBJmQF1eVw1uzcqnxMMNrqOj."], ["created_at", "2017-08-03 09:26:09.230228"], ["updated_at", "2017-08-03 09:26:09.230228"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:J4qDtv8ydWc6iv9RhV6P"], ["updated_at", "2017-08-03 09:26:09.232435"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 10ms (Views: 0.7ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.6ms | ActiveRecord: 0.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 10ms (Views: 0.9ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.7ms | ActiveRecord: 0.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[35m (1.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$2tMthM2/Q9jTRtiDY6VLCeI7UU7VZAONaP1uInCZH4G7iVZyB0OOi"], ["created_at", "2017-08-03 09:26:09.863140"], ["updated_at", "2017-08-03 09:26:09.863140"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:iAsU7iGn8mm8-_DxcZ4y"], ["updated_at", "2017-08-03 09:26:09.864746"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$UcaPEEegeGwc2TIrZM5omuFp6aa9iZ2yExc2GH3CswY.Kr8sGzcga"], ["created_at", "2017-08-03 09:26:09.900107"], ["updated_at", "2017-08-03 09:26:09.900107"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:pTcXJy4UuuKTtBEnPaGP"], ["updated_at", "2017-08-03 09:26:09.901655"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 09:34:25.146637"], ["updated_at", "2017-08-03 09:34:25.146637"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$HyYl8Vaukm.OGYzMb0e7nOsy61nP/eWuEM5Al.981Lli1saBkXtvS"], ["created_at", "2017-08-03 09:34:25.245332"], ["updated_at", "2017-08-03 09:34:25.245332"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:VdU2ojxANaMuvjxi-PE8"], ["updated_at", "2017-08-03 09:34:25.247780"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$eLNodCm.aY/nPDm7kjXK6ewPUq1r6VCTYsGbNGvFJR95qvl6eDL86"], ["created_at", "2017-08-03 09:34:25.273381"], ["updated_at", "2017-08-03 09:34:25.273381"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:X_sriKt9pjzM3arSZf1h"], ["updated_at", "2017-08-03 09:34:25.274823"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 0.8ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$lcbdi1uq7Je0oahFobMkFuaQWbFxhTATC0tRTG19dN3tGu0N1Fc.2"], ["created_at", "2017-08-03 09:34:25.840159"], ["updated_at", "2017-08-03 09:34:25.840159"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:pJ1XnGA5KLx7EZEXoTyf"], ["updated_at", "2017-08-03 09:34:25.842156"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.6ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$cCvkWaPB1a7qQOpGwWtZZO/omGK8sf14qRUHboA/KqvbTeBffs.yO"], ["created_at", "2017-08-03 09:34:25.872385"], ["updated_at", "2017-08-03 09:34:25.872385"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:kU-NbyNzYyGAZ9fTTfox"], ["updated_at", "2017-08-03 09:34:25.874515"], ["id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.4ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 09:42:20.154372"], ["updated_at", "2017-08-03 09:42:20.154372"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$pn3gMFXRNhT5E4jOcHS.nOn2Yil19491QEAz9zt9Y206tmTZLYwsm"], ["created_at", "2017-08-03 09:42:20.244861"], ["updated_at", "2017-08-03 09:42:20.244861"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:7AqQaZfhduxvyAPt-KAe"], ["updated_at", "2017-08-03 09:42:20.246859"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$kBVK3lU/HarYaQxmMzRnJuxbWhPTdPXXqyGdGRae1apGNyBHOKl4m"], ["created_at", "2017-08-03 09:42:20.267977"], ["updated_at", "2017-08-03 09:42:20.267977"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:ySscfsJGtSTCEUuGFFsz"], ["updated_at", "2017-08-03 09:42:20.269409"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 11ms (Views: 0.5ms | ActiveRecord: 0.6ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$t6hHO5gGTFOAPPlggXqvBOc8cshL4yCMPbNNVXb.vp3IZuLqTjyXG"], ["created_at", "2017-08-03 09:42:20.404268"], ["updated_at", "2017-08-03 09:42:20.404268"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:Fo9stj11UZsPsP99J15t"], ["updated_at", "2017-08-03 09:42:20.405841"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 6ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$vCUNxdCbgDl6zNv7oo/7ceTKr36mjR.THIEdZCwb2703UUtSPatdW"], ["created_at", "2017-08-03 09:42:20.432362"], ["updated_at", "2017-08-03 09:42:20.432362"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:NdTVSCXTwmYjSSFkAm7o"], ["updated_at", "2017-08-03 09:42:20.433777"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 6ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 09:43:07.671831"], ["updated_at", "2017-08-03 09:43:07.671831"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$gsr3Iq5/hFniS.3rn0Jzqe8nvTYwvNM2cjFs5eEex/.wB37Vp7amW"], ["created_at", "2017-08-03 09:43:07.761703"], ["updated_at", "2017-08-03 09:43:07.761703"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:aWPyHzeVygr_nSxWcccx"], ["updated_at", "2017-08-03 09:43:07.763448"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$65G/z/YLOHiXoF7.RlubYewkM6Nrblmwego1Y2l9guKMULvUqwL7i"], ["created_at", "2017-08-03 09:43:07.784230"], ["updated_at", "2017-08-03 09:43:07.784230"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:8DSqLnmhpUyoTnPD-9jT"], ["updated_at", "2017-08-03 09:43:07.785700"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 11ms (Views: 0.4ms | ActiveRecord: 0.5ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$ts169TaURUHFyOHnH.vH9ea3kGSmRjNKNRMYz228aa6CnK00v3G4m"], ["created_at", "2017-08-03 09:43:07.918374"], ["updated_at", "2017-08-03 09:43:07.918374"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:t77_WXg2amryqk1BxvQn"], ["updated_at", "2017-08-03 09:43:07.919849"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 7ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$NXlw/oilAyjnWReIC7owq.DJSyCDvXESg8mVuPVtJhR3l.xTQQlEO"], ["created_at", "2017-08-03 09:43:07.947721"], ["updated_at", "2017-08-03 09:43:07.947721"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:TvW2oDLZjxm6B_ZxtEBK"], ["updated_at", "2017-08-03 09:43:07.949010"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 5ms (Views: 0.2ms | ActiveRecord: 0.0ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 09:44:17.255681"], ["updated_at", "2017-08-03 09:44:17.255681"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$soEa8VRVEWItr9Oz1Nn/N.satJdI/fp1ae4jIyYf2yF6m1rVxJUMq"], ["created_at", "2017-08-03 09:44:17.362035"], ["updated_at", "2017-08-03 09:44:17.362035"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:sVSzvgw7Jez5x7UteQiN"], ["updated_at", "2017-08-03 09:44:17.365525"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$kF1nLNyHE6DjL7UF1NNKX.6CGjsfpUMg015ZUJnvhK4z4eVP9Dxq2"], ["created_at", "2017-08-03 09:44:17.386909"], ["updated_at", "2017-08-03 09:44:17.386909"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:trCRcjHfyzYsv8zmhoU6"], ["updated_at", "2017-08-03 09:44:17.388231"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 0.8ms)
  [1m[35m (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$IUaASelKqnExyljQmDCg7uKjoI3cutDIVj.WZCeIrLb.AJOYb4Mf2"], ["created_at", "2017-08-03 09:44:17.882154"], ["updated_at", "2017-08-03 09:44:17.882154"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:phXBcx3H4_i24f9ENzyV"], ["updated_at", "2017-08-03 09:44:17.884094"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$xu4te0T8lwAYNU/MNhBRbeW9roUPBeAwgfWDe66T7zhIOBNkoD1HS"], ["created_at", "2017-08-03 09:44:17.908617"], ["updated_at", "2017-08-03 09:44:17.908617"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:S5FRPBZwu4MpEUuX7ToC"], ["updated_at", "2017-08-03 09:44:17.910033"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 09:48:30.251164"], ["updated_at", "2017-08-03 09:48:30.251164"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$JDLYrmRsFz0lA4KXJoB0LubtxK5pP5Qz9zkrtD8BiLUUHGyN0Ai92"], ["created_at", "2017-08-03 09:48:30.339836"], ["updated_at", "2017-08-03 09:48:30.339836"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:n-HU8CdAMWc7HR6z6bdx"], ["updated_at", "2017-08-03 09:48:30.344359"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.5ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$3yAX2UMnwv5B25okjsRjTuyq3svE9cB5gFf4E2sg6THxiSkXnQe/m"], ["created_at", "2017-08-03 09:48:30.378163"], ["updated_at", "2017-08-03 09:48:30.378163"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:GzTBxfR7uzL1Ct-4wzBZ"], ["updated_at", "2017-08-03 09:48:30.379472"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
  [1m[35m (16.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$HGsqBgPeI9PMqJDeWoGYDeEgA41FGtey7lpTrCtHBDp/wdU87bvwi"], ["created_at", "2017-08-03 09:48:30.877024"], ["updated_at", "2017-08-03 09:48:30.877024"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:hSn4oBtJshsKy56qAwb9"], ["updated_at", "2017-08-03 09:48:30.878959"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$VUEqqc73Ciscu3.cojJ6RemVFMmHO6I14FXKmEyiruyfGqNuudDe2"], ["created_at", "2017-08-03 09:48:30.902870"], ["updated_at", "2017-08-03 09:48:30.902870"], ["kit_user_id", "1234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:goLGH64edAxEhyzx_VA7"], ["updated_at", "2017-08-03 09:48:30.904153"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.0ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 10:09:28.296120"], ["updated_at", "2017-08-03 10:09:28.296120"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
Processing by KitController#callback as HTML
Completed 500 Internal Server Error in 2ms (ActiveRecord: 0.0ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 10:12:21.414925"], ["updated_at", "2017-08-03 10:12:21.414925"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
Processing by KitController#callback as HTML
Completed 500 Internal Server Error in 8ms (ActiveRecord: 0.1ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170802202410)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 10:20:10.526778"], ["updated_at", "2017-08-03 10:20:10.526778"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
Processing by KitController#callback as HTML
Completed 500 Internal Server Error in 1ms (ActiveRecord: 0.1ms)
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 10:21:51.926742"], ["updated_at", "2017-08-03 10:21:51.926742"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.com"], ["created_at", "2017-08-03 10:21:51.988777"], ["updated_at", "2017-08-03 10:21:51.988777"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$YeeEIqE3yr7z7GPSv4faw.TraFbDvOOmzc6WBSEn8DwRMXbsuRjbG"], ["created_at", "2017-08-03 10:21:52.046697"], ["updated_at", "2017-08-03 10:21:52.046697"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:PSYJzgyJsias21Lb8Js-"], ["updated_at", "2017-08-03 10:21:52.048433"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (2.1ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.com"], ["created_at", "2017-08-03 10:21:52.067555"], ["updated_at", "2017-08-03 10:21:52.067555"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$axZnxCi5pkn0LTGIZZqReedxU60dQ.6ryhXGYF45ElwJO3azIT3HK"], ["created_at", "2017-08-03 10:21:52.073613"], ["updated_at", "2017-08-03 10:21:52.073613"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:tSEwSu1-M2DMXb983kg5"], ["updated_at", "2017-08-03 10:21:52.074949"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 1.0ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.com"], ["created_at", "2017-08-03 10:21:52.599812"], ["updated_at", "2017-08-03 10:21:52.599812"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$z/VfMgQ6L2RBJoRVbc732eeAnXzvhRz1Bye6RTY9wMFICbl3wC5R6"], ["created_at", "2017-08-03 10:21:52.604862"], ["updated_at", "2017-08-03 10:21:52.604862"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:fGJfahrSHCUx9dvmeP_N"], ["updated_at", "2017-08-03 10:21:52.606218"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.com"], ["created_at", "2017-08-03 10:21:52.627749"], ["updated_at", "2017-08-03 10:21:52.627749"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$uMw2SSb7Z9.wTCfOy7Fz1uDdBoIkbkprrO5cKEsc4HbQ6J.aki7gS"], ["created_at", "2017-08-03 10:21:52.631680"], ["updated_at", "2017-08-03 10:21:52.631680"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:1Qnh-AyywTwY_E_VZnop"], ["updated_at", "2017-08-03 10:21:52.633014"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.2ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 2ms (ActiveRecord: 0.2ms)
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 10:22:34.873977"], ["updated_at", "2017-08-03 10:22:34.873977"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.com"], ["created_at", "2017-08-03 10:22:34.930735"], ["updated_at", "2017-08-03 10:22:34.930735"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$EdOKEISV8G5mEjtXoXdHfOQziDNh0V6r2bEsljBZYusrG2E.r9F1C"], ["created_at", "2017-08-03 10:22:34.968958"], ["updated_at", "2017-08-03 10:22:34.968958"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:Tiy9e9Ggy8v3VGvAhCiE"], ["updated_at", "2017-08-03 10:22:34.970744"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (1.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.com"], ["created_at", "2017-08-03 10:22:35.004390"], ["updated_at", "2017-08-03 10:22:35.004390"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$jzzTx.kyC0JMWsWrXULl1OPXe7qyocvJ0dNnZkjtwMpRYxDdt88oC"], ["created_at", "2017-08-03 10:22:35.013050"], ["updated_at", "2017-08-03 10:22:35.013050"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:prdzdDYXaZoW7iF8t_bR"], ["updated_at", "2017-08-03 10:22:35.015909"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.com"], ["created_at", "2017-08-03 10:22:35.520717"], ["updated_at", "2017-08-03 10:22:35.520717"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$SApl3q8xCxkG7odkgCtK2OFCx2mtuxEBUwrL05rfv4J.hKegLs7EW"], ["created_at", "2017-08-03 10:22:35.524858"], ["updated_at", "2017-08-03 10:22:35.524858"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:--2wHFqe6Zf7dZQyGgB-"], ["updated_at", "2017-08-03 10:22:35.526060"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.com"], ["created_at", "2017-08-03 10:22:35.548533"], ["updated_at", "2017-08-03 10:22:35.548533"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$EbMr/9wOdfQj3V6nsMM7k.rbL.fnQ/nC6CsqJR7Yr9xeluZEXD90S"], ["created_at", "2017-08-03 10:22:35.552294"], ["updated_at", "2017-08-03 10:22:35.552294"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:4sTLcjwkgEFwpac6TzbG"], ["updated_at", "2017-08-03 10:22:35.553380"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.2ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
Completed 404 Not Found in 1ms (ActiveRecord: 0.2ms)
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 10:22:55.168161"], ["updated_at", "2017-08-03 10:22:55.168161"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:22:55.232526"], ["updated_at", "2017-08-03 10:22:55.232526"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$vTu803iR459U6iXtRQLdM.NQqi6n2t/6tKfoS6X6B.Vm4vD50ppwK"], ["created_at", "2017-08-03 10:22:55.275336"], ["updated_at", "2017-08-03 10:22:55.275336"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:qzcXnjsRKiCu9v1Sn1Vm"], ["updated_at", "2017-08-03 10:22:55.280530"], ["id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.4ms | ActiveRecord: 0.4ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:22:55.313812"], ["updated_at", "2017-08-03 10:22:55.313812"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$Y1d7It6rrWlZ0rEMFWMbiOJhemHdrqiYSI02fC38f44/V7LH1Ypc6"], ["created_at", "2017-08-03 10:22:55.317870"], ["updated_at", "2017-08-03 10:22:55.317870"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:53SrV5oYJsExY9MkqgmA"], ["updated_at", "2017-08-03 10:22:55.319059"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 1.1ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.7ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:22:55.826078"], ["updated_at", "2017-08-03 10:22:55.826078"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$rtHOaHHO/Q2s5FLZlB.Ul.3q.Rck2vBkP/8r0RGsjoPYwNVAnh/9K"], ["created_at", "2017-08-03 10:22:55.831051"], ["updated_at", "2017-08-03 10:22:55.831051"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:yHMMjkhFxnBmA8CktDiM"], ["updated_at", "2017-08-03 10:22:55.832450"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:22:55.853068"], ["updated_at", "2017-08-03 10:22:55.853068"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$k7wbBSsaDkw6TUxj4.vIx.bjuUerS3j9MuB0xBAsAeixAXQONlzXS"], ["created_at", "2017-08-03 10:22:55.859692"], ["updated_at", "2017-08-03 10:22:55.859692"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:fx3CS21o7mzd8sy2m4Us"], ["updated_at", "2017-08-03 10:22:55.860932"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
Completed 404 Not Found in 1ms (ActiveRecord: 0.1ms)
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 10:26:01.626389"], ["updated_at", "2017-08-03 10:26:01.626389"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:26:01.690534"], ["updated_at", "2017-08-03 10:26:01.690534"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$8yoUV3T8qvol9dYp6EbCTOJzTU8No5jLeAJ4Vpgba3eXUBCwSqOam"], ["created_at", "2017-08-03 10:26:01.745071"], ["updated_at", "2017-08-03 10:26:01.745071"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:CfuUM1sdBth_8Ehu1XAD"], ["updated_at", "2017-08-03 10:26:01.747957"], ["id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:26:01.771493"], ["updated_at", "2017-08-03 10:26:01.771493"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$6OWWYdRVwgcBd10.Mz.OCeTSMcSAYErpilxzBcJj7/wWdogdDELIy"], ["created_at", "2017-08-03 10:26:01.775385"], ["updated_at", "2017-08-03 10:26:01.775385"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:um3xL3f-yZuazisrBykc"], ["updated_at", "2017-08-03 10:26:01.776737"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 1.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 1.0ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
  [1m[35m (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:26:02.277861"], ["updated_at", "2017-08-03 10:26:02.277861"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$lsHHzc8/nhCkcNUmVFwqjOJ56QlUgLRsO5dgge.p.LnQrYxtFc88S"], ["created_at", "2017-08-03 10:26:02.282317"], ["updated_at", "2017-08-03 10:26:02.282317"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:xLqMsVHTYTgkCdap7dmL"], ["updated_at", "2017-08-03 10:26:02.283619"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:26:02.307742"], ["updated_at", "2017-08-03 10:26:02.307742"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$TwELsarxQeTY7pONKlwv/e6idNqojdRtxhPc/7JnWllgg0o2oAw8O"], ["created_at", "2017-08-03 10:26:02.312120"], ["updated_at", "2017-08-03 10:26:02.312120"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:RPUDsyD5ufxthag-Dv2h"], ["updated_at", "2017-08-03 10:26:02.313324"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.3ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" LIMIT ?[0m  [["LIMIT", 11]]
  [1m[36mShop Load (0.2ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
Completed 404 Not Found in 9824ms (ActiveRecord: 0.5ms)
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 10:26:29.082858"], ["updated_at", "2017-08-03 10:26:29.082858"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:26:29.144739"], ["updated_at", "2017-08-03 10:26:29.144739"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$OkRGPYrErwCsHRTAl2n21O0MhyJPnTsd.muQgIgLYWm6WJkjJP3Mi"], ["created_at", "2017-08-03 10:26:29.199514"], ["updated_at", "2017-08-03 10:26:29.199514"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:uMVfxTcm5n9SCgkNr2YK"], ["updated_at", "2017-08-03 10:26:29.201977"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:26:29.223468"], ["updated_at", "2017-08-03 10:26:29.223468"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$khSRKCovNF52zV/k2RJRS.o48XmfRjc7IwB6pyHIkxpdihgUGPj.e"], ["created_at", "2017-08-03 10:26:29.227203"], ["updated_at", "2017-08-03 10:26:29.227203"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:z5V-SKQ9uva_npy6z9LB"], ["updated_at", "2017-08-03 10:26:29.228319"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.7ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:26:29.729274"], ["updated_at", "2017-08-03 10:26:29.729274"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$.Thcz93QUkSxeWGCbB4SdeluZTloxYWbQCJlx6fylRITG0ek6m5hu"], ["created_at", "2017-08-03 10:26:29.734023"], ["updated_at", "2017-08-03 10:26:29.734023"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:ovBf8E3Zz54uxMRRwMsD"], ["updated_at", "2017-08-03 10:26:29.735459"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:26:29.756798"], ["updated_at", "2017-08-03 10:26:29.756798"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$xNlncUh3RDE2A61WdXOpru.BVeWl01IWrJAdjk2VDNj5C7yUjxcF6"], ["created_at", "2017-08-03 10:26:29.761184"], ["updated_at", "2017-08-03 10:26:29.761184"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:ncKx7NFKsyV2F9VuRsh8"], ["updated_at", "2017-08-03 10:26:29.762402"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:26:29.768805"], ["updated_at", "2017-08-03 10:26:29.768805"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$mkl8K0uTmi62QqaWsE/RPuQYMRjR8RSqA8GxmKOtSY.uX9K5Hf5ES"], ["created_at", "2017-08-03 10:26:29.772339"], ["updated_at", "2017-08-03 10:26:29.772339"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:DpLVPYiGX2F13n3wBn5R"], ["updated_at", "2017-08-03 10:26:29.773532"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 10:26:29.790845"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to 
Completed 500 Internal Server Error in 17ms (ActiveRecord: 0.6ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 10:27:40.596860"], ["updated_at", "2017-08-03 10:27:40.596860"]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:27:40.655405"], ["updated_at", "2017-08-03 10:27:40.655405"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$lgSsS8UKz2Dk9SUpQVxrFuCVhYgjoWe8Rs.3mz0feA.oxW/nx4Q3q"], ["created_at", "2017-08-03 10:27:40.698455"], ["updated_at", "2017-08-03 10:27:40.698455"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:vfMyh5qE6quQdwAxhGsE"], ["updated_at", "2017-08-03 10:27:40.699904"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.4ms | ActiveRecord: 0.3ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:27:40.725758"], ["updated_at", "2017-08-03 10:27:40.725758"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$M9h8DFMGQ5hitXlfEDH9rOTDtYYNG1c.MAuP6M43SV3l9fENepzdm"], ["created_at", "2017-08-03 10:27:40.731612"], ["updated_at", "2017-08-03 10:27:40.731612"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:eyZZzWjBoY7cKxs-zruM"], ["updated_at", "2017-08-03 10:27:40.733583"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
  [1m[35m (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:27:41.242768"], ["updated_at", "2017-08-03 10:27:41.242768"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$vrsWyyFIozUr084Kar.ITOzpIl87Q7PCz/8/f4SQRQ7XzBK6uRqDS"], ["created_at", "2017-08-03 10:27:41.247697"], ["updated_at", "2017-08-03 10:27:41.247697"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:uADdS1iLMxdoBrXnWyq_"], ["updated_at", "2017-08-03 10:27:41.249122"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:27:41.270830"], ["updated_at", "2017-08-03 10:27:41.270830"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$i70xckJaKjTqkLJdh//E9ewlp8QJOYRJzbRVHFB5iZMHcboR08mhK"], ["created_at", "2017-08-03 10:27:41.275716"], ["updated_at", "2017-08-03 10:27:41.275716"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:19xETr9GHVDZdz4SBkGz"], ["updated_at", "2017-08-03 10:27:41.277329"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:27:41.283341"], ["updated_at", "2017-08-03 10:27:41.283341"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$UWGUjs756/FdiRydrxKraOq2wOGAC4dyAliMSZ5UU03yVqzzZzB3C"], ["created_at", "2017-08-03 10:27:41.287384"], ["updated_at", "2017-08-03 10:27:41.287384"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:Lx-d9MQJEjCHxgzT_3tx"], ["updated_at", "2017-08-03 10:27:41.288823"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 10:27:41.305107"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 16ms (ActiveRecord: 0.5ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 10:28:01.939807"], ["updated_at", "2017-08-03 10:28:01.939807"]]
  [1m[35m (1.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:28:02.003219"], ["updated_at", "2017-08-03 10:28:02.003219"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$fnN5BfUTD3H9khAXDWQz0uUOxovb0ZpYzv2xDMfBCIW57yXttS8g."], ["created_at", "2017-08-03 10:28:02.056454"], ["updated_at", "2017-08-03 10:28:02.056454"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:okyQe4Tjb4dLFyajtUzj"], ["updated_at", "2017-08-03 10:28:02.058309"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:28:02.076732"], ["updated_at", "2017-08-03 10:28:02.076732"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$Ty3yyE9B1.Hwoy0C4S4FOOP.8c6BqRFyoO8YkBAv0yD.MoMSDgvqi"], ["created_at", "2017-08-03 10:28:02.081084"], ["updated_at", "2017-08-03 10:28:02.081084"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:CMNXpHsvgG7ac5Jsrty7"], ["updated_at", "2017-08-03 10:28:02.082693"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.9ms | ActiveRecord: 1.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.7ms | ActiveRecord: 0.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 1.2ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:28:02.640755"], ["updated_at", "2017-08-03 10:28:02.640755"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$RwEF6j5MlGX.q050IJBU7.XLYurHzTLE/3OvDv8fc2Qc7rObXXUPq"], ["created_at", "2017-08-03 10:28:02.646338"], ["updated_at", "2017-08-03 10:28:02.646338"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:W2mreN5YyZ91hh4M5a9A"], ["updated_at", "2017-08-03 10:28:02.647866"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:28:02.666883"], ["updated_at", "2017-08-03 10:28:02.666883"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$2velLHb/BUf2N4WI.V61MOICsTRr1cNR5OIkTnRXIDMo4wrFjO3rW"], ["created_at", "2017-08-03 10:28:02.671592"], ["updated_at", "2017-08-03 10:28:02.671592"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:_ByATyLpZK8qoP1aPuTp"], ["updated_at", "2017-08-03 10:28:02.672839"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:28:02.678792"], ["updated_at", "2017-08-03 10:28:02.678792"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$t2acVF262/NnQ3sfsew7De6MvwZxA2nah9dH.GOHVslLZA.vlGQ0u"], ["created_at", "2017-08-03 10:28:02.683362"], ["updated_at", "2017-08-03 10:28:02.683362"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:CGUj_cJ-aVymr1yoU_nU"], ["updated_at", "2017-08-03 10:28:02.684934"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 10:28:02.703840"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 21442ms (ActiveRecord: 1.0ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 10:28:41.960455"], ["updated_at", "2017-08-03 10:28:41.960455"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:28:42.024555"], ["updated_at", "2017-08-03 10:28:42.024555"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$whht1vhQRHefseCP0kBMFerurx.UkS9HcEV4Jft.0YmrZZYGNpIT."], ["created_at", "2017-08-03 10:28:42.078468"], ["updated_at", "2017-08-03 10:28:42.078468"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:ATv-MsBsQF_uZi-Rkxac"], ["updated_at", "2017-08-03 10:28:42.080299"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:28:42.098595"], ["updated_at", "2017-08-03 10:28:42.098595"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$AjvTVn3y8XCa5oXXPXD2/utdQIHHNrVywlcPOw/yBtQQq5QcbNRlS"], ["created_at", "2017-08-03 10:28:42.102875"], ["updated_at", "2017-08-03 10:28:42.102875"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:oMxREbJ-9zzy46U45g7o"], ["updated_at", "2017-08-03 10:28:42.104147"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 1.0ms | ActiveRecord: 1.3ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
  [1m[35m (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:28:42.600440"], ["updated_at", "2017-08-03 10:28:42.600440"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$1NgXq72DdRBoD7mgL0LFa.BOfqkqw47YHIkJXFqzlpFOv/RxE33DK"], ["created_at", "2017-08-03 10:28:42.604704"], ["updated_at", "2017-08-03 10:28:42.604704"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:jyMmsWxKxumjsztb_eps"], ["updated_at", "2017-08-03 10:28:42.605974"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:28:42.626560"], ["updated_at", "2017-08-03 10:28:42.626560"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$0FabKTs.EU.27RQaU5r9DeeATgHIEmfXmH/N.u8nrxcf/6hdHJR2C"], ["created_at", "2017-08-03 10:28:42.631260"], ["updated_at", "2017-08-03 10:28:42.631260"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:7s85gBWizxWHHA2GL4gT"], ["updated_at", "2017-08-03 10:28:42.632713"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:28:42.638508"], ["updated_at", "2017-08-03 10:28:42.638508"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$NvSGpxb81qBXMxd2rAMOHeQw6vIZRvESOtl3fWhlAxu2icUnick3u"], ["created_at", "2017-08-03 10:28:42.641998"], ["updated_at", "2017-08-03 10:28:42.641998"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:_yfPGEDmg8Hj9SgfPWYo"], ["updated_at", "2017-08-03 10:28:42.643139"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 10:28:42.659904"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 17ms (ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 10:34:53.326283"], ["updated_at", "2017-08-03 10:34:53.326283"]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:34:53.396943"], ["updated_at", "2017-08-03 10:34:53.396943"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$b8lEkLmjARVLdCw0C.FVseS3O5TU./82w3OSMmTeIjXOFu3VoxkUW"], ["created_at", "2017-08-03 10:34:53.438758"], ["updated_at", "2017-08-03 10:34:53.438758"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:Nz5nbzAN7iPT84ygwCFe"], ["updated_at", "2017-08-03 10:34:53.440416"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 10ms (Views: 0.6ms | ActiveRecord: 0.4ms)
  [1m[35m (0.8ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:34:53.476753"], ["updated_at", "2017-08-03 10:34:53.476753"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$b9bMNZ/j0Y2kKU23nJ/JJ.z1g/smk8if2RVuTK/evnYwajav7bJ5."], ["created_at", "2017-08-03 10:34:53.481487"], ["updated_at", "2017-08-03 10:34:53.481487"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:ZZcVi3J8cwGMg_sRPbou"], ["updated_at", "2017-08-03 10:34:53.482878"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 12ms (Views: 1.8ms | ActiveRecord: 3.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.5ms | ActiveRecord: 1.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.5ms | ActiveRecord: 1.5ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.7ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 1.0ms)
  [1m[35m (1.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:34:54.121813"], ["updated_at", "2017-08-03 10:34:54.121813"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$IyvVcTTdRxwsnrisCAfTKOdYYhRtzP2m6d75JysJA45xdYBAWErku"], ["created_at", "2017-08-03 10:34:54.128807"], ["updated_at", "2017-08-03 10:34:54.128807"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:YqemBQTyP7cWJRhhHtfx"], ["updated_at", "2017-08-03 10:34:54.130532"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.5ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:34:54.152931"], ["updated_at", "2017-08-03 10:34:54.152931"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$nTZxT1cQfcKH545n.f5etO.peuoIrZWq7JCwYztYsZgFWLKQfOyra"], ["created_at", "2017-08-03 10:34:54.157916"], ["updated_at", "2017-08-03 10:34:54.157916"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:RPjNQh9dYjqY6XPyGz1-"], ["updated_at", "2017-08-03 10:34:54.159775"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 10:34:54.165635"], ["updated_at", "2017-08-03 10:34:54.165635"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$NmqZO8AAFyn.dakGvMe7hubnClVhHZi6Jpr3KDt4SKMGjue7.pTHi"], ["created_at", "2017-08-03 10:34:54.169569"], ["updated_at", "2017-08-03 10:34:54.169569"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:-ooqo6azHVcy5PHtfsaF"], ["updated_at", "2017-08-03 10:34:54.170816"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 10:34:54.185639"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 16ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 11:03:18.741235"], ["updated_at", "2017-08-03 11:03:18.741235"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 11:03:18.802746"], ["updated_at", "2017-08-03 11:03:18.802746"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$p0RmK8L.kR.Xblxj5cxRb./x3jvJg9aJZJTgMbFGNUSk/cafDyo1K"], ["access_token", "abc"], ["created_at", "2017-08-03 11:03:18.842903"], ["updated_at", "2017-08-03 11:03:18.842903"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:gMaJExsX9hPaH82dqGWE"], ["updated_at", "2017-08-03 11:03:18.844374"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (1.9ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 11:03:18.865925"], ["updated_at", "2017-08-03 11:03:18.865925"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$pxl9h7VXGjs6VRhRhJWie.VLwIUX3xMtwMw2H09wSLBbL0bDc8hhi"], ["access_token", "abc"], ["created_at", "2017-08-03 11:03:18.872909"], ["updated_at", "2017-08-03 11:03:18.872909"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:hyButQyDGsEV-6qqZTqe"], ["updated_at", "2017-08-03 11:03:18.875352"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.7ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.7ms | ActiveRecord: 1.3ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 11:03:19.391895"], ["updated_at", "2017-08-03 11:03:19.391895"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$BNGWBvEbAimrIUMJLvo3ZeBhBrLn4z0VU6ZIme44CDfvHEYyuz1yS"], ["access_token", "abc"], ["created_at", "2017-08-03 11:03:19.396468"], ["updated_at", "2017-08-03 11:03:19.396468"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:MH62zaRvUDpdUQNKRh7X"], ["updated_at", "2017-08-03 11:03:19.397807"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 11:03:19.424497"], ["updated_at", "2017-08-03 11:03:19.424497"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$os8gxJ3KH8v0qPqST2VAaesj5iwhowIibzAGwhabc2r1kSZXASN26"], ["access_token", "abc"], ["created_at", "2017-08-03 11:03:19.428644"], ["updated_at", "2017-08-03 11:03:19.428644"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:nHQvCy_Ff2dzAxE-KNNY"], ["updated_at", "2017-08-03 11:03:19.429783"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 11:03:19.435453"], ["updated_at", "2017-08-03 11:03:19.435453"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$R0jk.Up60ytJYVNCcaZspuCYHxgOku9DyODjPyI7PjEzs3f041HxS"], ["access_token", "abc"], ["created_at", "2017-08-03 11:03:19.439484"], ["updated_at", "2017-08-03 11:03:19.439484"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:chhtgLsas3aaqq6ZRfcr"], ["updated_at", "2017-08-03 11:03:19.441081"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 11:03:19.456095"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 14ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 11:03:19.463421"], ["updated_at", "2017-08-03 11:03:19.463421"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$xVLZtqXcQSvWpm4vqPNDUuCLfi79bK3zFivcFRMTz8OrR126gqAYy"], ["access_token", "abc"], ["created_at", "2017-08-03 11:03:19.467353"], ["updated_at", "2017-08-03 11:03:19.467353"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:s3KzHKjLWsXeuk4GtAW5"], ["updated_at", "2017-08-03 11:03:19.468550"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 11:03:19.471484"], ["last_sign_in_at", "2017-08-03 11:03:19.471484"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 11:03:19.472091"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 11:03:19.473763"], ["kit_access_token", nil], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 7ms (ActiveRecord: 0.5ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 11:45:40.175432"], ["updated_at", "2017-08-03 11:45:40.175432"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 11:45:40.242502"], ["updated_at", "2017-08-03 11:45:40.242502"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (3.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$BK/2vIlSoSRPzUzrVE49Q.7p03uTcCW/u9Wq8Xr9e63y9yptbVV7q"], ["access_token", "abc"], ["created_at", "2017-08-03 11:45:40.298723"], ["updated_at", "2017-08-03 11:45:40.298723"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:ySyD31SXz7auezKuiPYT"], ["updated_at", "2017-08-03 11:45:40.300451"], ["id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 11:45:40.329675"], ["updated_at", "2017-08-03 11:45:40.329675"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$0rSDOZjhiddCUK5ZhHYJEOAB6X3lL6aRM57e54M5gnNTVTBAW05iS"], ["access_token", "abc"], ["created_at", "2017-08-03 11:45:40.334276"], ["updated_at", "2017-08-03 11:45:40.334276"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:wv-yYFhF4sAYFML1o5kq"], ["updated_at", "2017-08-03 11:45:40.335833"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.8ms | ActiveRecord: 2.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.7ms | ActiveRecord: 1.3ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 1.2ms | ActiveRecord: 1.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 11:45:40.960899"], ["updated_at", "2017-08-03 11:45:40.960899"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$t8vxlRwDCf5IdBtTHVGeF.yeiELAKyQmlI4uLm9bH9luCUfXntYl6"], ["access_token", "abc"], ["created_at", "2017-08-03 11:45:40.965679"], ["updated_at", "2017-08-03 11:45:40.965679"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:C62cjnvKpc4AA7akDf-T"], ["updated_at", "2017-08-03 11:45:40.967091"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.4ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 11:45:40.992609"], ["updated_at", "2017-08-03 11:45:40.992609"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$RGkLFbza7qz48c0/Y0zPOu5E0IHZsARMTAYbX2YFNhZYR57ftc/oe"], ["access_token", "abc"], ["created_at", "2017-08-03 11:45:40.997321"], ["updated_at", "2017-08-03 11:45:40.997321"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:QYj1tty6tSc7-tRUD78_"], ["updated_at", "2017-08-03 11:45:40.998580"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 11:45:41.004764"], ["updated_at", "2017-08-03 11:45:41.004764"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$o/MAkaMdWoVnCGuoC63YbOphfWdnFdv98LIbmMPTiHCp22DY1OnW2"], ["access_token", "abc"], ["created_at", "2017-08-03 11:45:41.008500"], ["updated_at", "2017-08-03 11:45:41.008500"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:mrLWs_9_oKPCuYyPFiYE"], ["updated_at", "2017-08-03 11:45:41.010112"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 11:45:41.029217"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 18ms (ActiveRecord: 0.4ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 11:45:41.035367"], ["updated_at", "2017-08-03 11:45:41.035367"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$l88l6UKrtE3LIIwoVBaIQOBD7W/ne8GnN.QyybjuORPk8W/DHU0sK"], ["access_token", "abc"], ["created_at", "2017-08-03 11:45:41.039486"], ["updated_at", "2017-08-03 11:45:41.039486"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:psiGsNUExjT46Kiiefvk"], ["updated_at", "2017-08-03 11:45:41.040720"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 11:45:41.044042"], ["last_sign_in_at", "2017-08-03 11:45:41.044042"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 11:45:41.044988"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 11:45:41.046792"], ["kit_access_token", nil], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 8ms (ActiveRecord: 0.6ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 12:20:10.577827"], ["updated_at", "2017-08-03 12:20:10.577827"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:20:10.643076"], ["updated_at", "2017-08-03 12:20:10.643076"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$S7UI1R1izqGiQdqLhDr.sOj7Vxr52PfO06pafstWAWAaCR02ItwzS"], ["access_token", "abc"], ["created_at", "2017-08-03 12:20:10.684959"], ["updated_at", "2017-08-03 12:20:10.684959"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:6RYYF2jNasHmmFCyGDpb"], ["updated_at", "2017-08-03 12:20:10.686564"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.8ms | ActiveRecord: 0.2ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (3.6ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:20:10.713575"], ["updated_at", "2017-08-03 12:20:10.713575"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$vBBiR4KjL6KI0FkWyV6Bzu5YqsvfAqha1J9vK.V7pSh0PgYVPyI/G"], ["access_token", "abc"], ["created_at", "2017-08-03 12:20:10.722674"], ["updated_at", "2017-08-03 12:20:10.722674"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:HHzJWKzBYyzTpbswBxqo"], ["updated_at", "2017-08-03 12:20:10.724855"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.6ms | ActiveRecord: 1.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 0.9ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:20:11.318496"], ["updated_at", "2017-08-03 12:20:11.318496"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$bqrl9Nu2Kr97g41VZ7KrOOjpiMdKKIEPKxDvPjX1FYF1zuiwICRNi"], ["access_token", "abc"], ["created_at", "2017-08-03 12:20:11.327103"], ["updated_at", "2017-08-03 12:20:11.327103"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:fevzFJ6-85_UkDxacRLh"], ["updated_at", "2017-08-03 12:20:11.328617"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:20:11.348662"], ["updated_at", "2017-08-03 12:20:11.348662"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$gbIwy7oyBdPICVa7DjKrYe5ORppKcfQY7eaRczS/DezF05UDI.WQG"], ["access_token", "abc"], ["created_at", "2017-08-03 12:20:11.353204"], ["updated_at", "2017-08-03 12:20:11.353204"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:v_6D3G_632gzDZTY_xsm"], ["updated_at", "2017-08-03 12:20:11.354884"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:20:11.360815"], ["updated_at", "2017-08-03 12:20:11.360815"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$d9.bVmMjpfYS4TOad/fLbOY7nIXVFBovKm40RbG0t/3HajrU9lkFe"], ["access_token", "abc"], ["created_at", "2017-08-03 12:20:11.364737"], ["updated_at", "2017-08-03 12:20:11.364737"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:QdcWHARcsJLKKFxkEZTa"], ["updated_at", "2017-08-03 12:20:11.366348"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 12:20:11.383530"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 17ms (ActiveRecord: 0.7ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:20:11.391349"], ["updated_at", "2017-08-03 12:20:11.391349"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$aJ/zzAyV9OmuDxCTwW7uIeR4B5WfW0ta.Vx7.ytr/fp229MojIpoO"], ["access_token", "abc"], ["created_at", "2017-08-03 12:20:11.395267"], ["updated_at", "2017-08-03 12:20:11.395267"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:MnJ_ERZn4GKFFkV5bNsm"], ["updated_at", "2017-08-03 12:20:11.396505"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 12:20:11.399454"], ["last_sign_in_at", "2017-08-03 12:20:11.399454"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 12:20:11.400162"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 12:20:11.402081"], ["kit_access_token", nil], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 500 Internal Server Error in 8ms (ActiveRecord: 0.6ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 12:25:57.661729"], ["updated_at", "2017-08-03 12:25:57.661729"]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:25:57.757934"], ["updated_at", "2017-08-03 12:25:57.757934"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$Ba3BhsD.NUFx.MRWQOEHTuXS6YVEcOOYvmvmO2MmNMZs.0UtFFlim"], ["access_token", "abc"], ["created_at", "2017-08-03 12:25:57.800801"], ["updated_at", "2017-08-03 12:25:57.800801"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:ka4Pafzqx1WEbphgQ89c"], ["updated_at", "2017-08-03 12:25:57.802940"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:25:57.841062"], ["updated_at", "2017-08-03 12:25:57.841062"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$.7zauryoETWL5hXuLTKQweCuXxb1YDpJiWPuGjDQCWxxAAWuxlH1C"], ["access_token", "abc"], ["created_at", "2017-08-03 12:25:57.845786"], ["updated_at", "2017-08-03 12:25:57.845786"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:tR8DsmdPyASfVL9bMMjQ"], ["updated_at", "2017-08-03 12:25:57.847120"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.6ms | ActiveRecord: 1.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.9ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.7ms | ActiveRecord: 1.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.2ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:25:58.416844"], ["updated_at", "2017-08-03 12:25:58.416844"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$LY8X7TviDYP0c/ZOe/7QIuRP8d8Xah6PGBJUJKiN5SVe1VHDPK9uK"], ["access_token", "abc"], ["created_at", "2017-08-03 12:25:58.422202"], ["updated_at", "2017-08-03 12:25:58.422202"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:bi2vzXd5ECBw7sZXjYSt"], ["updated_at", "2017-08-03 12:25:58.423810"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:25:58.451337"], ["updated_at", "2017-08-03 12:25:58.451337"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$DkAprToEaAYIrPkVqTeLOOe9K.NrJOmPUaNFtla6mtTSdVkTI06E6"], ["access_token", "abc"], ["created_at", "2017-08-03 12:25:58.455234"], ["updated_at", "2017-08-03 12:25:58.455234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:aREAm8t3U14fYfK8vXSV"], ["updated_at", "2017-08-03 12:25:58.456383"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.0ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:25:58.461818"], ["updated_at", "2017-08-03 12:25:58.461818"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$TeUhzwDcnphIryE0BE67h.nSUcWWQavyvCzxT4QKZHh7LPF6icFUi"], ["access_token", "abc"], ["created_at", "2017-08-03 12:25:58.465786"], ["updated_at", "2017-08-03 12:25:58.465786"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:pGuWpvdxsVguhqQb2o-E"], ["updated_at", "2017-08-03 12:25:58.467003"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.2ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 12:25:58.487382"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 20ms (ActiveRecord: 0.9ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:25:58.494084"], ["updated_at", "2017-08-03 12:25:58.494084"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$iqYG5dk0r0PkdfUQi7Ct2e85zzfXquhpFcyEqZxpEIrKPKvr6cZAq"], ["access_token", "abc"], ["created_at", "2017-08-03 12:25:58.499622"], ["updated_at", "2017-08-03 12:25:58.499622"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:k4GJRQhtrZsUa9K9VbNM"], ["updated_at", "2017-08-03 12:25:58.500902"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 12:25:58.503872"], ["last_sign_in_at", "2017-08-03 12:25:58.503872"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 12:25:58.504448"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 12:25:58.506102"], ["kit_access_token", nil], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 12:26:29.778118"], ["updated_at", "2017-08-03 12:26:29.778118"]]
  [1m[35m (1.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:26:29.869705"], ["updated_at", "2017-08-03 12:26:29.869705"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$JAf2d287OttR5bTZOKVn/e1Vn7n06CKLCcwebxE/5f96wsbia2HQO"], ["access_token", "abc"], ["created_at", "2017-08-03 12:26:29.911795"], ["updated_at", "2017-08-03 12:26:29.911795"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:oEUDZSPY93ENzJd713Mi"], ["updated_at", "2017-08-03 12:26:29.913166"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 9ms (Views: 0.8ms | ActiveRecord: 0.3ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:26:29.954536"], ["updated_at", "2017-08-03 12:26:29.954536"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$560OzQ2boVhC/XQ9s1rzn.sgdKNUtA1Foak1mnTy1fkZgMkyUEjFO"], ["access_token", "abc"], ["created_at", "2017-08-03 12:26:29.958216"], ["updated_at", "2017-08-03 12:26:29.958216"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:zGuCFttXXMaXk6UwRfZK"], ["updated_at", "2017-08-03 12:26:29.959319"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.6ms | ActiveRecord: 1.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.5ms | ActiveRecord: 1.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:26:30.458788"], ["updated_at", "2017-08-03 12:26:30.458788"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$ATou9SsKnhY6P2uLprxyZOnp3ofSwWjk1NWM4ILVWAh/1VJ8V9FHq"], ["access_token", "abc"], ["created_at", "2017-08-03 12:26:30.462964"], ["updated_at", "2017-08-03 12:26:30.462964"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:EU2wG8sDYx-ZhzJkL_aT"], ["updated_at", "2017-08-03 12:26:30.464236"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:26:30.493656"], ["updated_at", "2017-08-03 12:26:30.493656"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$PbqGaBKRrUjqu9dS/ubkE.rUiWSM/aLomUzsYjNk29BXOI6XKplf6"], ["access_token", "abc"], ["created_at", "2017-08-03 12:26:30.497871"], ["updated_at", "2017-08-03 12:26:30.497871"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:bWtCe_uALigGWzDzxyLK"], ["updated_at", "2017-08-03 12:26:30.499087"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:26:30.505151"], ["updated_at", "2017-08-03 12:26:30.505151"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$wECjkSWVhaAi.e9.PaG5hulo2ikuAWK4rElLjugXAZGZaXvsHO6XW"], ["access_token", "abc"], ["created_at", "2017-08-03 12:26:30.508850"], ["updated_at", "2017-08-03 12:26:30.508850"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:9WsFbD6y2KSMpZGqLyDL"], ["updated_at", "2017-08-03 12:26:30.509913"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 12:26:30.526208"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 16ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:26:30.533389"], ["updated_at", "2017-08-03 12:26:30.533389"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$W9RqtczJ6LxBX/kUxyAcPO03huGBDsKfLd7XASlKo8kjmDVObJ.Aa"], ["access_token", "abc"], ["created_at", "2017-08-03 12:26:30.538001"], ["updated_at", "2017-08-03 12:26:30.538001"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:Dx-hwx7F6F7Mqh8uu-6F"], ["updated_at", "2017-08-03 12:26:30.539380"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 12:26:30.542020"], ["last_sign_in_at", "2017-08-03 12:26:30.542020"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 12:26:30.542592"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 12:26:30.544322"], ["kit_access_token", nil], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 24391ms (Views: 0.8ms | ActiveRecord: 0.5ms)
  [1m[35m (1.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 12:27:11.203372"], ["updated_at", "2017-08-03 12:27:11.203372"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:27:11.294991"], ["updated_at", "2017-08-03 12:27:11.294991"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$1s/g/iEIgKboAyQ9g32M/e7L2WcZAYujFqwzmXvvhkZ295NGYgzam"], ["access_token", "abc"], ["created_at", "2017-08-03 12:27:11.336468"], ["updated_at", "2017-08-03 12:27:11.336468"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:CKGvmKt-pXqNsbtbhxub"], ["updated_at", "2017-08-03 12:27:11.338891"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.3ms | ActiveRecord: 0.3ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:27:11.370955"], ["updated_at", "2017-08-03 12:27:11.370955"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$3iozseB0e47HwtNY3HOfv.EN94dduyDgIwyO7.579dD/nhiFzypB2"], ["access_token", "abc"], ["created_at", "2017-08-03 12:27:11.375663"], ["updated_at", "2017-08-03 12:27:11.375663"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:NafgQxppzu1Ps7Qp-FCD"], ["updated_at", "2017-08-03 12:27:11.377306"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.2ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:27:11.915527"], ["updated_at", "2017-08-03 12:27:11.915527"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$xIw2CXZXk4Nhsl2sWhUPBOEf3/xulMozXnJrrfRZZ/aB.rgm1bKCm"], ["access_token", "abc"], ["created_at", "2017-08-03 12:27:11.920414"], ["updated_at", "2017-08-03 12:27:11.920414"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:CLsMGBYcyXeytsWS2xTD"], ["updated_at", "2017-08-03 12:27:11.922305"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:27:11.951946"], ["updated_at", "2017-08-03 12:27:11.951946"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$Pdaj15.i/K194F0RV3qgO.dZjqDVxCzybT.E9Pd9fQhqon/sQd6uK"], ["access_token", "abc"], ["created_at", "2017-08-03 12:27:11.956987"], ["updated_at", "2017-08-03 12:27:11.956987"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:KsJHmB2J3q1r9hn5kW1C"], ["updated_at", "2017-08-03 12:27:11.958399"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:27:11.964531"], ["updated_at", "2017-08-03 12:27:11.964531"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$wrQC522olKUyxn3wzVQmW.CaxsF9b9JgLv2B3qTOcHK4rz3a3FEPG"], ["access_token", "abc"], ["created_at", "2017-08-03 12:27:11.968298"], ["updated_at", "2017-08-03 12:27:11.968298"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:VKJVBcMyp7vxTTVyDNz1"], ["updated_at", "2017-08-03 12:27:11.969407"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 12:27:11.988891"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 18ms (ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:27:11.994848"], ["updated_at", "2017-08-03 12:27:11.994848"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$d6q1B82Xlm0tnQIaMibKd.QQwTXeBxEWJ0pOR2yTqpg671L1.iqz6"], ["access_token", "abc"], ["created_at", "2017-08-03 12:27:11.998650"], ["updated_at", "2017-08-03 12:27:11.998650"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:_73u2bC9MHfiFH5uJtsp"], ["updated_at", "2017-08-03 12:27:11.999879"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 12:27:12.005907"], ["last_sign_in_at", "2017-08-03 12:27:12.005907"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 12:27:12.007633"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 12:27:12.010899"], ["kit_access_token", nil], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 14ms (Views: 0.6ms | ActiveRecord: 1.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 12:27:52.764934"], ["updated_at", "2017-08-03 12:27:52.764934"]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:27:52.857732"], ["updated_at", "2017-08-03 12:27:52.857732"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$X/aagcb2Ou/d5Lrw5Op9WumKlPzugJeQbEaH6AbG6RnWi3Gyk8xnG"], ["access_token", "abc"], ["created_at", "2017-08-03 12:27:52.900151"], ["updated_at", "2017-08-03 12:27:52.900151"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:sxhtdnLrmsWJixnnUVNz"], ["updated_at", "2017-08-03 12:27:52.901668"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 10ms (Views: 0.8ms | ActiveRecord: 0.3ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:27:52.948537"], ["updated_at", "2017-08-03 12:27:52.948537"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$uFRSq/Yi2DUioMEzYoqtSeWQicKt1bgo9avJJccWszhvSR9Ncm9/m"], ["access_token", "abc"], ["created_at", "2017-08-03 12:27:52.952247"], ["updated_at", "2017-08-03 12:27:52.952247"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:6stuUsX92xyyyBKg7kCZ"], ["updated_at", "2017-08-03 12:27:52.953307"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.6ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:27:53.447044"], ["updated_at", "2017-08-03 12:27:53.447044"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$fOHRcu5iHZ55wi2L.RSOoe26fNTcOG7O3lBbvorWWh3ekOUGZzxRS"], ["access_token", "abc"], ["created_at", "2017-08-03 12:27:53.451427"], ["updated_at", "2017-08-03 12:27:53.451427"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:WEPhxz4j5iyzyCyhSx_A"], ["updated_at", "2017-08-03 12:27:53.452740"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:27:53.483201"], ["updated_at", "2017-08-03 12:27:53.483201"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$Q2ZEAIGHaORWWQH.gcH/huUEMjWFaGWiRZ4wtQyITAV2e2oLO4.Je"], ["access_token", "abc"], ["created_at", "2017-08-03 12:27:53.487284"], ["updated_at", "2017-08-03 12:27:53.487284"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:yFkqBaTfHzRW4FzwGRkk"], ["updated_at", "2017-08-03 12:27:53.488389"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.0ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:27:53.493315"], ["updated_at", "2017-08-03 12:27:53.493315"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$Kgup3gYed.ELg8TwXk/A5eXpwHLEkwcBUgbH0JClcCDcbuPlem4IW"], ["access_token", "abc"], ["created_at", "2017-08-03 12:27:53.497543"], ["updated_at", "2017-08-03 12:27:53.497543"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:i1hu3JeN9m2KwnKTyv-E"], ["updated_at", "2017-08-03 12:27:53.498662"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 12:27:53.513020"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 14ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:27:53.518861"], ["updated_at", "2017-08-03 12:27:53.518861"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$nPLDEVARP.mp.zDSIvrw9edBogRmPd0lDCBenLhWHkUNJlS7XEQt."], ["access_token", "abc"], ["created_at", "2017-08-03 12:27:53.522452"], ["updated_at", "2017-08-03 12:27:53.522452"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:WRt9Lutmm9zti-gRJ9iv"], ["updated_at", "2017-08-03 12:27:53.523691"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 12:27:53.526911"], ["last_sign_in_at", "2017-08-03 12:27:53.526911"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 12:27:53.527762"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 12:27:53.529814"], ["kit_access_token", nil], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.6ms | ActiveRecord: 0.7ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 12:29:26.274147"], ["updated_at", "2017-08-03 12:29:26.274147"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:29:26.372782"], ["updated_at", "2017-08-03 12:29:26.372782"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$5sC9532Ok0xWTy6E4W1aLOevNRqdZabmTiyEWJdLnX1zwrVjls2LO"], ["access_token", "abc"], ["created_at", "2017-08-03 12:29:26.425488"], ["updated_at", "2017-08-03 12:29:26.425488"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:F4qVytvydwbDvBuwWPso"], ["updated_at", "2017-08-03 12:29:26.427336"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:29:26.456627"], ["updated_at", "2017-08-03 12:29:26.456627"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$ABQbwIpV5WX5VT0W5f2Fw.3md9CpHCL7kryy3fzneGw20wubXguFW"], ["access_token", "abc"], ["created_at", "2017-08-03 12:29:26.460288"], ["updated_at", "2017-08-03 12:29:26.460288"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:tUxM1QkceqQTKXPnBGnM"], ["updated_at", "2017-08-03 12:29:26.461447"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:29:26.982368"], ["updated_at", "2017-08-03 12:29:26.982368"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$6z9a.GCzWoliGMn83kwAGeoIN9dOv2Vzdzun7hAk9lDy8JBWhyI9i"], ["access_token", "abc"], ["created_at", "2017-08-03 12:29:26.988836"], ["updated_at", "2017-08-03 12:29:26.988836"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:xzbZGGrgEwa3oaxzquze"], ["updated_at", "2017-08-03 12:29:26.990783"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:29:27.022384"], ["updated_at", "2017-08-03 12:29:27.022384"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$ejpVgOphf1tOXcj8KCQbse5HFDNoIPNN0o6cdXUYeXbqexMhCsLjS"], ["access_token", "abc"], ["created_at", "2017-08-03 12:29:27.026092"], ["updated_at", "2017-08-03 12:29:27.026092"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:gh2y3f3nZB5KMf2ErsuW"], ["updated_at", "2017-08-03 12:29:27.027171"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:29:27.032690"], ["updated_at", "2017-08-03 12:29:27.032690"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$XaoUobY5C7uUaEEVfg9KieuriD5OKihdOLFBxwqVU8qcwuE7cUvzK"], ["access_token", "abc"], ["created_at", "2017-08-03 12:29:27.036381"], ["updated_at", "2017-08-03 12:29:27.036381"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:2y6FSsG8w31rvMqxspbu"], ["updated_at", "2017-08-03 12:29:27.037497"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 12:29:27.052739"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 15ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:29:27.058867"], ["updated_at", "2017-08-03 12:29:27.058867"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$gjg7SjGq8aj55zr76NFGm.m1H04uKGb7efo7fbe9iwFwQt3cxOHFe"], ["access_token", "abc"], ["created_at", "2017-08-03 12:29:27.062330"], ["updated_at", "2017-08-03 12:29:27.062330"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:9tVvDxmiRoKH68ejBwxw"], ["updated_at", "2017-08-03 12:29:27.063691"], ["id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 12:29:27.067816"], ["last_sign_in_at", "2017-08-03 12:29:27.067816"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 12:29:27.068438"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 12:29:27.070371"], ["kit_access_token", nil], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.6ms | ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 12:29:42.400459"], ["updated_at", "2017-08-03 12:29:42.400459"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:29:42.493169"], ["updated_at", "2017-08-03 12:29:42.493169"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$6wfphW3q08/OdKgk.a3qNuh0YWNktDugZXk4ZGG7ft18IHKYLEqHK"], ["access_token", "abc"], ["created_at", "2017-08-03 12:29:42.536044"], ["updated_at", "2017-08-03 12:29:42.536044"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:qDLQjsfsKbBcRv5eLsB6"], ["updated_at", "2017-08-03 12:29:42.537700"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:29:42.582227"], ["updated_at", "2017-08-03 12:29:42.582227"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$iTUCStOKw/zAI7IIBM.Fc.lN8sEEuiVbtM6o.wKVYBxtrzIhIXkKC"], ["access_token", "abc"], ["created_at", "2017-08-03 12:29:42.586188"], ["updated_at", "2017-08-03 12:29:42.586188"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:nAYzyJph2gRLSGEUFm39"], ["updated_at", "2017-08-03 12:29:42.587398"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.8ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:29:43.097430"], ["updated_at", "2017-08-03 12:29:43.097430"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$3vFVXEcSlw1SDW3R.QzmduV7x8kUgAkzZWHX/R7bdiZRtlXA1/fBK"], ["access_token", "abc"], ["created_at", "2017-08-03 12:29:43.102225"], ["updated_at", "2017-08-03 12:29:43.102225"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:pzHFxQK7fpxtbro7_36m"], ["updated_at", "2017-08-03 12:29:43.104817"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:29:43.135191"], ["updated_at", "2017-08-03 12:29:43.135191"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$Uo2PxNlEQ6pFKEw2.bj0Fe.Aooxv/Om9lWfosjhMWdHxRKiBElhZO"], ["access_token", "abc"], ["created_at", "2017-08-03 12:29:43.139615"], ["updated_at", "2017-08-03 12:29:43.139615"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:yfsZAezfa1Jy5VrZyeqU"], ["updated_at", "2017-08-03 12:29:43.140805"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.0ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:29:43.145797"], ["updated_at", "2017-08-03 12:29:43.145797"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$w.rFv80wSbhdAtQa9g/wT.3hoHd2jSs4X8ACnnDVdxe7MSqyt6Hqe"], ["access_token", "abc"], ["created_at", "2017-08-03 12:29:43.150190"], ["updated_at", "2017-08-03 12:29:43.150190"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:wQ2JhMPbHN_on8bMEj-1"], ["updated_at", "2017-08-03 12:29:43.151837"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 12:29:43.167705"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 14ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:29:43.174123"], ["updated_at", "2017-08-03 12:29:43.174123"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$FEO3eQG/CMmiAC31AukWI.5IZxwVC6sxGSJei9CLqlr9j7RkugTEO"], ["access_token", "abc"], ["created_at", "2017-08-03 12:29:43.178259"], ["updated_at", "2017-08-03 12:29:43.178259"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:C6tmU4GHaS_J6wfYYFRc"], ["updated_at", "2017-08-03 12:29:43.179737"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 12:29:43.183082"], ["last_sign_in_at", "2017-08-03 12:29:43.183082"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 12:29:43.183723"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 12:29:43.185976"], ["kit_access_token", nil], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.6ms | ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 12:30:22.362033"], ["updated_at", "2017-08-03 12:30:22.362033"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:30:22.456773"], ["updated_at", "2017-08-03 12:30:22.456773"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.6ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$DT87ert9AcBzQzn2Ks05BuHA/HN/Ft74oT46gwPaG2ySYcTGbBu8q"], ["access_token", "abc"], ["created_at", "2017-08-03 12:30:22.511132"], ["updated_at", "2017-08-03 12:30:22.511132"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:z7aa6z6mDu5vB_is5Uao"], ["updated_at", "2017-08-03 12:30:22.514416"], ["id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:30:22.545585"], ["updated_at", "2017-08-03 12:30:22.545585"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$ceyae5Obl1Dw.erLe.sL3O314BfIkyP9.QIy3svJ1xx9nyFZUW0fC"], ["access_token", "abc"], ["created_at", "2017-08-03 12:30:22.549525"], ["updated_at", "2017-08-03 12:30:22.549525"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:6TSZF-7bytBgDDU7Hn4K"], ["updated_at", "2017-08-03 12:30:22.550632"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 1.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.6ms | ActiveRecord: 1.4ms)
  [1m[35m (1.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:30:23.059881"], ["updated_at", "2017-08-03 12:30:23.059881"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$nzmlce.ifiXhDU6KWgm8RuhibWq5eQ.7Fy6Hxyyb6zWogjUy5igyC"], ["access_token", "abc"], ["created_at", "2017-08-03 12:30:23.064664"], ["updated_at", "2017-08-03 12:30:23.064664"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:7MT72Q9iKPqe9t4FVv1s"], ["updated_at", "2017-08-03 12:30:23.066085"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:30:23.096865"], ["updated_at", "2017-08-03 12:30:23.096865"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$nNBlWuUT0LmdD3hobFjmjuLFYhQ.HEJMfLmQ30Jg7ziszY2iW5K7e"], ["access_token", "abc"], ["created_at", "2017-08-03 12:30:23.101324"], ["updated_at", "2017-08-03 12:30:23.101324"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:VGWU_XQBo3A62W-Dudzx"], ["updated_at", "2017-08-03 12:30:23.102511"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:30:23.108621"], ["updated_at", "2017-08-03 12:30:23.108621"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$VUN3ziWVMFWqWrks5tkxUOlsbAVY6np1vQ6B/fq3K7LhmZyipLcky"], ["access_token", "abc"], ["created_at", "2017-08-03 12:30:23.113205"], ["updated_at", "2017-08-03 12:30:23.113205"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:R8fsv_t1yVmNLXztQX_X"], ["updated_at", "2017-08-03 12:30:23.114445"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 12:30:23.129169"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 15ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 12:30:23.135920"], ["updated_at", "2017-08-03 12:30:23.135920"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$IZP3sextZzKADL.mXIEOT.8RxDvZY0Xcad80g8DkZV9t0EsR9j5MO"], ["access_token", "abc"], ["created_at", "2017-08-03 12:30:23.140090"], ["updated_at", "2017-08-03 12:30:23.140090"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:N7ZU87eMvi5G-Nx5La6T"], ["updated_at", "2017-08-03 12:30:23.141498"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 12:30:23.144645"], ["last_sign_in_at", "2017-08-03 12:30:23.144645"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 12:30:23.145402"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 12:30:23.147353"], ["kit_access_token", nil], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.7ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 15:25:05.694099"], ["updated_at", "2017-08-03 15:25:05.694099"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.6ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 15:25:19.605777"], ["updated_at", "2017-08-03 15:25:19.605777"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:25:19.692436"], ["updated_at", "2017-08-03 15:25:19.692436"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$TzpW.U3aVGfMTSZtpif7gODlp6j4eEXXH1ozgE4cNJyAl7pmYytKm"], ["access_token", "abc"], ["created_at", "2017-08-03 15:25:19.730573"], ["updated_at", "2017-08-03 15:25:19.730573"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:8rgz7CyVSH46mVfHSfqg"], ["updated_at", "2017-08-03 15:25:19.732073"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 27ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:25:19.779576"], ["updated_at", "2017-08-03 15:25:19.779576"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$IrhrvqJwVtNd/Et0DbKJ9u.xg5EX/wV1YKD3h/uRFtHrq96Oio1wS"], ["access_token", "abc"], ["created_at", "2017-08-03 15:25:19.783604"], ["updated_at", "2017-08-03 15:25:19.783604"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:rrWbUyLaHbbFUj9yHVey"], ["updated_at", "2017-08-03 15:25:19.785095"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
  [1m[35m (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:25:20.287889"], ["updated_at", "2017-08-03 15:25:20.287889"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$Z5aaRc8uU4eKJtmK/aSdIuzr89QLv8eOdq3AC.EXYdO4Lay5m3/oi"], ["access_token", "abc"], ["created_at", "2017-08-03 15:25:20.293986"], ["updated_at", "2017-08-03 15:25:20.293986"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:-xKzCrPpnL3L5bJFzUrb"], ["updated_at", "2017-08-03 15:25:20.295597"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:25:20.324302"], ["updated_at", "2017-08-03 15:25:20.324302"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$nP7vMHmrujteYa47gfMjvO1xK3kgNdvAhDLTdZMZY6HBybbzmnECW"], ["access_token", "abc"], ["created_at", "2017-08-03 15:25:20.328525"], ["updated_at", "2017-08-03 15:25:20.328525"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:ph74JvcStpCR981T5WWN"], ["updated_at", "2017-08-03 15:25:20.329753"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:25:20.335824"], ["updated_at", "2017-08-03 15:25:20.335824"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$9nTub9b/NO7scnHgz1b2deVLMrkJqeDR9libstXEl8w2DHBKLwh4C"], ["access_token", "abc"], ["created_at", "2017-08-03 15:25:20.340138"], ["updated_at", "2017-08-03 15:25:20.340138"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:iGrXskg8mY4gsgPaSk8B"], ["updated_at", "2017-08-03 15:25:20.341477"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 15:25:20.360274"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 18ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:25:20.367048"], ["updated_at", "2017-08-03 15:25:20.367048"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$dMRrjDwOoj0AAX0iMlHzEOlXWHzz9dp/avJwX2a9U3cjuIv2tKJsC"], ["access_token", "abc"], ["created_at", "2017-08-03 15:25:20.371362"], ["updated_at", "2017-08-03 15:25:20.371362"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:VySMWossJwjV6Zcoo4Sr"], ["updated_at", "2017-08-03 15:25:20.372656"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 15:25:20.375770"], ["last_sign_in_at", "2017-08-03 15:25:20.375770"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 15:25:20.376540"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 15:25:20.378273"], ["kit_access_token", nil], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.5ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 15:26:07.119829"], ["updated_at", "2017-08-03 15:26:07.119829"]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:26:07.219110"], ["updated_at", "2017-08-03 15:26:07.219110"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$61y2d8ChgK8rbWW.erT6OukBc3Jwacc6W8MzlzwdwzXPfVexKgrXS"], ["access_token", "abc"], ["created_at", "2017-08-03 15:26:07.271583"], ["updated_at", "2017-08-03 15:26:07.271583"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:1snFvZUYcFeGWKEpcg6X"], ["updated_at", "2017-08-03 15:26:07.274160"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (9.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 13ms (Views: 0.3ms | ActiveRecord: 9.1ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:26:07.303071"], ["updated_at", "2017-08-03 15:26:07.303071"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$KeurvgtTDJC0eL26p59.fe/KVsJi/pgu2Z8xdKcP8k37BJEJalm7G"], ["access_token", "abc"], ["created_at", "2017-08-03 15:26:07.307052"], ["updated_at", "2017-08-03 15:26:07.307052"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:7anAey-Bdsk-JhzuwY_S"], ["updated_at", "2017-08-03 15:26:07.308874"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.7ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:26:07.805290"], ["updated_at", "2017-08-03 15:26:07.805290"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$sFUiNm/dJlV6IMuB.lkY6OAKtGm4KrETZs/5mlAGrw2LY2OZTKKAO"], ["access_token", "abc"], ["created_at", "2017-08-03 15:26:07.810184"], ["updated_at", "2017-08-03 15:26:07.810184"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:m-M1_Fd4CLBiit5Eu5sx"], ["updated_at", "2017-08-03 15:26:07.812075"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:26:07.838291"], ["updated_at", "2017-08-03 15:26:07.838291"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$9FRMFX5nx85nyQTAoClFPeUVnUODjoL/FhWlos/WUUHndCUmEQ2.O"], ["access_token", "abc"], ["created_at", "2017-08-03 15:26:07.842331"], ["updated_at", "2017-08-03 15:26:07.842331"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:1MNUE1Eog4fGvzdv6gUP"], ["updated_at", "2017-08-03 15:26:07.843451"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:26:07.848781"], ["updated_at", "2017-08-03 15:26:07.848781"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$SuH..6b4CNNx.Ulvftjau.pL5UeJI7jIQPi7bm2gh0Rjv56BwcWpK"], ["access_token", "abc"], ["created_at", "2017-08-03 15:26:07.852168"], ["updated_at", "2017-08-03 15:26:07.852168"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:6ZL3wbn81x8vuJEcquf5"], ["updated_at", "2017-08-03 15:26:07.853211"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 15:26:07.868503"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 15ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:26:07.874254"], ["updated_at", "2017-08-03 15:26:07.874254"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$GmSbjk5YmKZ60MFttdn3L.mgAjI16t0.waADgHx1/JPnA5VptyqUi"], ["access_token", "abc"], ["created_at", "2017-08-03 15:26:07.878468"], ["updated_at", "2017-08-03 15:26:07.878468"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:qoP7nAqQ6p-B451q1ETf"], ["updated_at", "2017-08-03 15:26:07.879800"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 15:26:07.882920"], ["last_sign_in_at", "2017-08-03 15:26:07.882920"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 15:26:07.883627"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 15:26:07.885479"], ["kit_access_token", nil], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.8ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 15:27:58.237540"], ["updated_at", "2017-08-03 15:27:58.237540"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:27:58.321163"], ["updated_at", "2017-08-03 15:27:58.321163"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$Nnb04nG3gFIzTKlpjthp..TXuzsriFSPJzhpgAJm2hn6snKck884e"], ["access_token", "abc"], ["created_at", "2017-08-03 15:27:58.356914"], ["updated_at", "2017-08-03 15:27:58.356914"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:JmqRNzCmU91-SMRrNGLC"], ["updated_at", "2017-08-03 15:27:58.359308"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 13ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:27:58.389976"], ["updated_at", "2017-08-03 15:27:58.389976"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$K11YeBnczdvpLkWD6V/8XuUY.SQlh4/o79UpvESAdoZZNHoJeDvhy"], ["access_token", "abc"], ["created_at", "2017-08-03 15:27:58.397046"], ["updated_at", "2017-08-03 15:27:58.397046"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:rCL4QKoaXty82iRfJUvW"], ["updated_at", "2017-08-03 15:27:58.398900"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.9ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:27:58.894502"], ["updated_at", "2017-08-03 15:27:58.894502"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$5KWxjGqLUIu0.YQkj/i3je5p.ZpX/S4N/kqKmVq64PzbMarvqk7GO"], ["access_token", "abc"], ["created_at", "2017-08-03 15:27:58.898693"], ["updated_at", "2017-08-03 15:27:58.898693"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:xxy-7a-TbE-9jvR1JUSb"], ["updated_at", "2017-08-03 15:27:58.899864"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:27:58.924877"], ["updated_at", "2017-08-03 15:27:58.924877"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$ZxgDI6ZzGYwA.uBcFg6sB.Dy3uU7FVZ/JfHxyK9LWnMmEcSbctNmm"], ["access_token", "abc"], ["created_at", "2017-08-03 15:27:58.929551"], ["updated_at", "2017-08-03 15:27:58.929551"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:M6JVTFms6tzyBssGz23y"], ["updated_at", "2017-08-03 15:27:58.930948"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:27:58.936616"], ["updated_at", "2017-08-03 15:27:58.936616"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$L325PtDbT3lWqbS9L0wj4.GVZcGm4vNN9x1sf4nQZcu4mH8RqEqp2"], ["access_token", "abc"], ["created_at", "2017-08-03 15:27:58.941111"], ["updated_at", "2017-08-03 15:27:58.941111"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:4CmayoWU9mqb6XcFpaHi"], ["updated_at", "2017-08-03 15:27:58.943142"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 15:27:58.957252"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 13ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:27:58.963987"], ["updated_at", "2017-08-03 15:27:58.963987"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$/EqZO8G1Ni0Jri9sZ/3kH.fVl6fNUHy08wmMB.sg1c31EjdsUfaXe"], ["access_token", "abc"], ["created_at", "2017-08-03 15:27:58.968131"], ["updated_at", "2017-08-03 15:27:58.968131"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:MzxzKXvLXaHfQzW19j7y"], ["updated_at", "2017-08-03 15:27:58.969334"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 15:27:58.971884"], ["last_sign_in_at", "2017-08-03 15:27:58.971884"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 15:27:58.972455"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 15:27:58.974238"], ["kit_access_token", nil], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 8ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 15:28:40.728169"], ["updated_at", "2017-08-03 15:28:40.728169"]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:28:40.825520"], ["updated_at", "2017-08-03 15:28:40.825520"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$do7kbb4TgWh6lvc0QGcEbOwfSkLvthHUnHvhU12Gt8PrH1q3k/GkW"], ["access_token", "abc"], ["created_at", "2017-08-03 15:28:40.868637"], ["updated_at", "2017-08-03 15:28:40.868637"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:NavzJ2szrtSLx4Wri-Gi"], ["updated_at", "2017-08-03 15:28:40.870246"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 29ms (Views: 0.5ms | ActiveRecord: 0.4ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:28:40.917081"], ["updated_at", "2017-08-03 15:28:40.917081"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$d3uTgwvJiYHAGjhAr9Nud.3Nz3rvDwRrL1uTXGetikJcklaAQu4CK"], ["access_token", "abc"], ["created_at", "2017-08-03 15:28:40.921014"], ["updated_at", "2017-08-03 15:28:40.921014"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:XimaRYkKxYfsC7BPSnJs"], ["updated_at", "2017-08-03 15:28:40.922190"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.7ms | ActiveRecord: 0.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.7ms)
  [1m[35m (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:28:41.423311"], ["updated_at", "2017-08-03 15:28:41.423311"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$w7.4GUxPJ7uBhKkZ/HWw/uuXT1Ng7KhZlpSTB09Tm1irs2YBFSWC."], ["access_token", "abc"], ["created_at", "2017-08-03 15:28:41.429225"], ["updated_at", "2017-08-03 15:28:41.429225"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:U7RMCt_Yf3MuVFwyomfE"], ["updated_at", "2017-08-03 15:28:41.430837"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:28:41.458649"], ["updated_at", "2017-08-03 15:28:41.458649"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$Wu3A36lmNKpThoCU1.hVq.rXCnHxcd45kLgkTY/1uH4/Cc/P5CbxC"], ["access_token", "abc"], ["created_at", "2017-08-03 15:28:41.463343"], ["updated_at", "2017-08-03 15:28:41.463343"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:xxSfdg2Pj2MGMa5kMYBG"], ["updated_at", "2017-08-03 15:28:41.464594"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:28:41.470028"], ["updated_at", "2017-08-03 15:28:41.470028"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$HiSQapoQZSMH/DJHMzhlvew4Svn7tzIbaovKkAWr3pDqtHJIMCiOS"], ["access_token", "abc"], ["created_at", "2017-08-03 15:28:41.473738"], ["updated_at", "2017-08-03 15:28:41.473738"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:-DdbDjTgp8ApsS5zG6Ko"], ["updated_at", "2017-08-03 15:28:41.474817"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 15:28:41.490037"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 15ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:28:41.495903"], ["updated_at", "2017-08-03 15:28:41.495903"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$ivOfSeU5ZRH/jAlsEpE6wOxvnZvUfa0terlVrKQzzBr1Oow6qZJ8i"], ["access_token", "abc"], ["created_at", "2017-08-03 15:28:41.500151"], ["updated_at", "2017-08-03 15:28:41.500151"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:sGRM6sdPuhoKDuMxvssh"], ["updated_at", "2017-08-03 15:28:41.501610"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 15:28:41.504597"], ["last_sign_in_at", "2017-08-03 15:28:41.504597"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 15:28:41.505230"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 15:28:41.507031"], ["kit_access_token", nil], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 15:29:19.274626"], ["updated_at", "2017-08-03 15:29:19.274626"]]
  [1m[35m (1.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:29:19.391943"], ["updated_at", "2017-08-03 15:29:19.391943"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.8ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$9SPYq2jXYqf.B4kRbxvgxeW4D77r3z37UVCMBmZqscL3aPogwqOfq"], ["access_token", "abc"], ["created_at", "2017-08-03 15:29:19.460836"], ["updated_at", "2017-08-03 15:29:19.460836"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:ixa_MFhvywfnxPCujEyr"], ["updated_at", "2017-08-03 15:29:19.464853"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (9.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 15ms (Views: 0.3ms | ActiveRecord: 9.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:29:19.500428"], ["updated_at", "2017-08-03 15:29:19.500428"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$SdgFUk/Qulbu1OkK4NiV4exAh798rpvIUNCdq1XlYw.wE/cgG/pfm"], ["access_token", "abc"], ["created_at", "2017-08-03 15:29:19.504008"], ["updated_at", "2017-08-03 15:29:19.504008"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:FyRzz5AYP7wdEmdcnszA"], ["updated_at", "2017-08-03 15:29:19.505271"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.7ms | ActiveRecord: 1.4ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:29:20.027685"], ["updated_at", "2017-08-03 15:29:20.027685"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$/LbfNBvSeZM1lW3pGCJl0upRygfWROCIRdnOsy0pp3ciXr8RUAize"], ["access_token", "abc"], ["created_at", "2017-08-03 15:29:20.033610"], ["updated_at", "2017-08-03 15:29:20.033610"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:x1BTEYnSwws6Z4TvdWxx"], ["updated_at", "2017-08-03 15:29:20.035549"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:29:20.072602"], ["updated_at", "2017-08-03 15:29:20.072602"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$KwEf9mPRgbAE7jys6BHc8O5J7ZZDxM5OUL3jrH1KpIL8K1EM.SUnC"], ["access_token", "abc"], ["created_at", "2017-08-03 15:29:20.078140"], ["updated_at", "2017-08-03 15:29:20.078140"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:DDzvy84UjsdzjsE4CAaP"], ["updated_at", "2017-08-03 15:29:20.079396"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:29:20.087066"], ["updated_at", "2017-08-03 15:29:20.087066"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$6eku13lJy71HI4c5P9gPbuQkegVTNCpG0MC7V/rB9tmGCtd8S58wC"], ["access_token", "abc"], ["created_at", "2017-08-03 15:29:20.093381"], ["updated_at", "2017-08-03 15:29:20.093381"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:-szFRgXpyteDxfGKUdxy"], ["updated_at", "2017-08-03 15:29:20.095269"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 15:29:20.115137"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 18ms (ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:29:20.121720"], ["updated_at", "2017-08-03 15:29:20.121720"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$kIZOy88zzeZgoziiOQulhO.aGM4OsQyMj8Pb6WFBcIq/0FiZSy7Dm"], ["access_token", "abc"], ["created_at", "2017-08-03 15:29:20.129958"], ["updated_at", "2017-08-03 15:29:20.129958"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:xKJCNfyXd1xkszy9K3cx"], ["updated_at", "2017-08-03 15:29:20.131168"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 15:29:20.133869"], ["last_sign_in_at", "2017-08-03 15:29:20.133869"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 15:29:20.134468"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 15:29:20.136078"], ["kit_access_token", nil], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 15:29:38.308158"], ["updated_at", "2017-08-03 15:29:38.308158"]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:29:38.405663"], ["updated_at", "2017-08-03 15:29:38.405663"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$7irIbCn4P.6PA6fgeqsDHe3/QiJhajGxcnDdtB/VNcgh0/wL3U786"], ["access_token", "abc"], ["created_at", "2017-08-03 15:29:38.447576"], ["updated_at", "2017-08-03 15:29:38.447576"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:3-ZEa9yCKSJzwx-1BfLX"], ["updated_at", "2017-08-03 15:29:38.449246"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (8.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 14ms (Views: 0.3ms | ActiveRecord: 8.3ms)
  [1m[35m (1.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:29:38.485208"], ["updated_at", "2017-08-03 15:29:38.485208"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$rb..qgn.PHHiLWJY2yZNl.HSv8PQ/PS.7se5s.nVwVIM2ADmSL25m"], ["access_token", "abc"], ["created_at", "2017-08-03 15:29:38.489837"], ["updated_at", "2017-08-03 15:29:38.489837"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:oY3f95vPBR8nStget4Gz"], ["updated_at", "2017-08-03 15:29:38.492068"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.2ms)
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:29:38.984674"], ["updated_at", "2017-08-03 15:29:38.984674"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$HcU8F3dUveQ5P51pd6lNWeJJUH6zy/CFv7WNSGlsQw2ctJjUvv2Sa"], ["access_token", "abc"], ["created_at", "2017-08-03 15:29:38.989408"], ["updated_at", "2017-08-03 15:29:38.989408"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:8M8HkL2azbwMViwLMosx"], ["updated_at", "2017-08-03 15:29:38.990920"], ["id", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:29:39.022527"], ["updated_at", "2017-08-03 15:29:39.022527"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$ekZyN1GY1n.DbGKlwueuN.RZyl4Fhbq5IiqEMtsEN4qSyEf3YzQ32"], ["access_token", "abc"], ["created_at", "2017-08-03 15:29:39.026746"], ["updated_at", "2017-08-03 15:29:39.026746"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:KCQi9s7sU7ys4_5GzGxB"], ["updated_at", "2017-08-03 15:29:39.027983"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:29:39.034193"], ["updated_at", "2017-08-03 15:29:39.034193"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$twHkcWH0/SNEgcOX/PlGzeJozYz1yy17kQENe0qB6C9T5tDFe9GNK"], ["access_token", "abc"], ["created_at", "2017-08-03 15:29:39.038545"], ["updated_at", "2017-08-03 15:29:39.038545"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:TsfdNEZxBxgDgRYhjs-s"], ["updated_at", "2017-08-03 15:29:39.039704"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.2ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 15:29:39.055603"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 16ms (ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:29:39.062785"], ["updated_at", "2017-08-03 15:29:39.062785"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$ZbD6V03AXvcRXhXddauMUOSxVsv.KYv7mbh17TWavkcDy6I/aEvPq"], ["access_token", "abc"], ["created_at", "2017-08-03 15:29:39.066443"], ["updated_at", "2017-08-03 15:29:39.066443"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:wXrGcpWUmmpVTV565NQZ"], ["updated_at", "2017-08-03 15:29:39.067576"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 15:29:39.070209"], ["last_sign_in_at", "2017-08-03 15:29:39.070209"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 15:29:39.070754"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 15:29:39.072368"], ["kit_access_token", nil], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 8ms (Views: 0.5ms | ActiveRecord: 0.4ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 15:33:31.611586"], ["updated_at", "2017-08-03 15:33:31.611586"]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:33:31.705332"], ["updated_at", "2017-08-03 15:33:31.705332"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$oX.ULE7EvzkE0NTfQZU5POla2kLbnggkmW.iwolYYU8L9hhWBCHb."], ["access_token", "abc"], ["created_at", "2017-08-03 15:33:31.744654"], ["updated_at", "2017-08-03 15:33:31.744654"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:Fpxt88ThFJK9ntyyEBzP"], ["updated_at", "2017-08-03 15:33:31.746600"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 22ms (Views: 0.3ms | ActiveRecord: 0.7ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:33:31.787233"], ["updated_at", "2017-08-03 15:33:31.787233"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$ifp40iG7Co0lTRqWOjR4AeP3t1nVXrKVCjA3hSwqZdigjQn9HfsVu"], ["access_token", "abc"], ["created_at", "2017-08-03 15:33:31.790962"], ["updated_at", "2017-08-03 15:33:31.790962"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:_1F_w2sd3S_zpcVHdQxk"], ["updated_at", "2017-08-03 15:33:31.792081"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 1.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.6ms)
  [1m[35m (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:33:32.288469"], ["updated_at", "2017-08-03 15:33:32.288469"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$4oFl3IZmEa8OJM5La9.V7OhUVVUMbKYQYFHFkDg9RzVkSeCVrHIwC"], ["access_token", "abc"], ["created_at", "2017-08-03 15:33:32.294431"], ["updated_at", "2017-08-03 15:33:32.294431"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:PiJYc1p42K8xWRQtbXmX"], ["updated_at", "2017-08-03 15:33:32.296329"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:33:32.325828"], ["updated_at", "2017-08-03 15:33:32.325828"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$ijl0GUcEqIWm3yvDILAqX.wgXNqhjrdawLQtr8VDVPAZ2WVPkNc9q"], ["access_token", "abc"], ["created_at", "2017-08-03 15:33:32.330496"], ["updated_at", "2017-08-03 15:33:32.330496"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:EJa6Wo1G1p75KJqavKzB"], ["updated_at", "2017-08-03 15:33:32.332164"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:33:32.337657"], ["updated_at", "2017-08-03 15:33:32.337657"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$MM4EupkE2qca2eSQBkGYduXA5ejlIDZzC5Azq9DhHDL/1pHbY0SI6"], ["access_token", "abc"], ["created_at", "2017-08-03 15:33:32.341625"], ["updated_at", "2017-08-03 15:33:32.341625"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:3CxF4xsgrME6WipR6zxC"], ["updated_at", "2017-08-03 15:33:32.342808"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 15:33:32.358495"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 16ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:33:32.364757"], ["updated_at", "2017-08-03 15:33:32.364757"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$zrKjV2ZlQzInSU7ekMbf1uawAcDZjOLOYfDjyF2Zw97m3l7lcfRWC"], ["access_token", "abc"], ["created_at", "2017-08-03 15:33:32.368447"], ["updated_at", "2017-08-03 15:33:32.368447"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:VgBASmgbRMxAztff2wGX"], ["updated_at", "2017-08-03 15:33:32.369577"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 15:33:32.372445"], ["last_sign_in_at", "2017-08-03 15:33:32.372445"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 15:33:32.373054"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 15:33:32.374948"], ["kit_access_token", nil], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.7ms | ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 15:33:54.882266"], ["updated_at", "2017-08-03 15:33:54.882266"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:33:54.975132"], ["updated_at", "2017-08-03 15:33:54.975132"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (2.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$OZQbgoFu6md2BQOtGbmsh.OEkStjDVr5Eeqo0fWQ2aSDZaKkApqiO"], ["access_token", "abc"], ["created_at", "2017-08-03 15:33:55.028048"], ["updated_at", "2017-08-03 15:33:55.028048"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:ePADX4BgHz2KPk8UU-5y"], ["updated_at", "2017-08-03 15:33:55.031985"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 14ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:33:55.060648"], ["updated_at", "2017-08-03 15:33:55.060648"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$1D4b3wDw1oLh0GZMoGj0beA8BdNSOZ9aIPh/JY0/Xos1vYezyYlNG"], ["access_token", "abc"], ["created_at", "2017-08-03 15:33:55.064476"], ["updated_at", "2017-08-03 15:33:55.064476"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:U4ofRAbWGbWpXMy8L2Vx"], ["updated_at", "2017-08-03 15:33:55.065604"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 1.0ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:33:55.553422"], ["updated_at", "2017-08-03 15:33:55.553422"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$NmY.KqwqF/luVGPNx/78zO3qBL.eI9Ta0XCceMRgouqddcM40Wyha"], ["access_token", "abc"], ["created_at", "2017-08-03 15:33:55.557949"], ["updated_at", "2017-08-03 15:33:55.557949"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:7wraGM2_-jFTouFgzN1p"], ["updated_at", "2017-08-03 15:33:55.559583"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:33:55.588559"], ["updated_at", "2017-08-03 15:33:55.588559"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$5cMlUZR68NPLsOx5yT8wEe1rKcOaQ/Ix1NhGjFBC67XkzE87pstL2"], ["access_token", "abc"], ["created_at", "2017-08-03 15:33:55.592775"], ["updated_at", "2017-08-03 15:33:55.592775"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:ized9AZVYRfxz2bScbBM"], ["updated_at", "2017-08-03 15:33:55.594075"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:33:55.599717"], ["updated_at", "2017-08-03 15:33:55.599717"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$0ca/zYiqocTSYA/P89GQ8ebIYEOgCQ6OCHeL84q4QAJ8od/3gOF42"], ["access_token", "abc"], ["created_at", "2017-08-03 15:33:55.604167"], ["updated_at", "2017-08-03 15:33:55.604167"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:By8f-VWMoF7YffBqtxsj"], ["updated_at", "2017-08-03 15:33:55.605401"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 15:33:55.621187"], ["id", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 15ms (ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:33:55.627415"], ["updated_at", "2017-08-03 15:33:55.627415"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$G09KnDldZcJXPRi002jVrurbdMd0KoJaLEgbF4atUKq5HFlgYcNCm"], ["access_token", "abc"], ["created_at", "2017-08-03 15:33:55.631161"], ["updated_at", "2017-08-03 15:33:55.631161"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:wQByCFLnNtkta82t3VTA"], ["updated_at", "2017-08-03 15:33:55.632344"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 15:33:55.635034"], ["last_sign_in_at", "2017-08-03 15:33:55.635034"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 15:33:55.635597"], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 15:33:55.637711"], ["kit_access_token", nil], ["id", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.7ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 15:41:04.120773"], ["updated_at", "2017-08-03 15:41:04.120773"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 15:41:24.467502"], ["updated_at", "2017-08-03 15:41:24.467502"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 15:41:39.709452"], ["updated_at", "2017-08-03 15:41:39.709452"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "barry@example.com"], ["encrypted_password", "$2a$04$OYtIQXsFR/jwSrfG/ehfEOFFFKSpA5MpS4y3Sv7cewARC/jJjFITu"], ["created_at", "2017-08-03 15:41:39.826094"], ["updated_at", "2017-08-03 15:41:39.826094"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:XrTmxxvmxW9Aj2riDWZZ"], ["updated_at", "2017-08-03 15:41:39.827882"], ["id", 1]]
  [1m[35m (1.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.8ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35m (8.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:41:39.877242"], ["updated_at", "2017-08-03 15:41:39.877242"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:41:39.886852"], ["updated_at", "2017-08-03 15:41:39.886852"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:41:39.893023"], ["updated_at", "2017-08-03 15:41:39.893023"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:41:39.899802"], ["updated_at", "2017-08-03 15:41:39.899802"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:41:39.907445"], ["updated_at", "2017-08-03 15:41:39.907445"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:41:39.914072"], ["updated_at", "2017-08-03 15:41:39.914072"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "barry@example.com"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 15:42:24.087962"], ["updated_at", "2017-08-03 15:42:24.087962"]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$uQYT.kt8dMMXAY/c/e7oTOIxJmY/YSkVIz5EPhW18zjmg1JX5Cwxe"], ["created_at", "2017-08-03 15:42:24.234331"], ["updated_at", "2017-08-03 15:42:24.234331"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:xnA6ttotzxwWCqCJTCoV"], ["updated_at", "2017-08-03 15:42:24.236101"], ["id", 1]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$6pLZ5fHJqzH0OsIcs.5RbuoHwmuomyFmrzNaNqjTmk3pFchQH5f7."], ["created_at", "2017-08-03 15:42:24.241313"], ["updated_at", "2017-08-03 15:42:24.241313"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:rUwwKT882ZT4YupzuK3Y"], ["updated_at", "2017-08-03 15:42:24.242693"], ["id", 2]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:42:24.274034"], ["updated_at", "2017-08-03 15:42:24.274034"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$MgzV8kNDVyO1rFvENvKWIOLLEtIg06JydC2AnNme/VBQhH9WVEWFq"], ["access_token", "abc"], ["created_at", "2017-08-03 15:42:24.278510"], ["updated_at", "2017-08-03 15:42:24.278510"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:9bDH3gh4iFvyfeTCp8YT"], ["updated_at", "2017-08-03 15:42:24.280055"], ["id", 3]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.3ms | ActiveRecord: 0.3ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (2.1ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:42:24.297710"], ["updated_at", "2017-08-03 15:42:24.297710"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$BQiZ8mednCc/M8z/8qLXYunmD88zK.Py.pemVSTUBbFSmbRkrtwjm"], ["access_token", "abc"], ["created_at", "2017-08-03 15:42:24.304421"], ["updated_at", "2017-08-03 15:42:24.304421"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:8vVqw1kGB5giEdENffDa"], ["updated_at", "2017-08-03 15:42:24.305624"], ["id", 3]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.6ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:42:24.813258"], ["updated_at", "2017-08-03 15:42:24.813258"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$ooqzlP7AXU.TCTuFr7.BLudBF12R40cPIFXMJyE6ejQlWK3TlMNzu"], ["access_token", "abc"], ["created_at", "2017-08-03 15:42:24.817809"], ["updated_at", "2017-08-03 15:42:24.817809"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:82NG6uZuHuee3mUxMpaq"], ["updated_at", "2017-08-03 15:42:24.819138"], ["id", 3]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:42:24.848030"], ["updated_at", "2017-08-03 15:42:24.848030"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$fH.JgfQyDQTp1HbPERI3HO8a/3GxX9Wm/KrtBPPmkrDpr6KSmcVzG"], ["access_token", "abc"], ["created_at", "2017-08-03 15:42:24.851763"], ["updated_at", "2017-08-03 15:42:24.851763"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:zvPnvKi_h-dSC5irDbkz"], ["updated_at", "2017-08-03 15:42:24.852887"], ["id", 3]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.0ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:42:24.858491"], ["updated_at", "2017-08-03 15:42:24.858491"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$Appw4m2nAcznlqnpi7SKLOzF.zTStjf0WX9n8E1.n0d6qlfA9Afau"], ["access_token", "abc"], ["created_at", "2017-08-03 15:42:24.862943"], ["updated_at", "2017-08-03 15:42:24.862943"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:DCzXH-wWynvyzzxa1wPM"], ["updated_at", "2017-08-03 15:42:24.864104"], ["id", 3]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 15:42:24.879456"], ["id", 3]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 15ms (ActiveRecord: 0.4ms)
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:42:24.886105"], ["updated_at", "2017-08-03 15:42:24.886105"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$iAM5TDtsxT/y.pUl/MjlNOlrjbLpqESYNkb2a4BM8MU6mwbhnn4Ue"], ["access_token", "abc"], ["created_at", "2017-08-03 15:42:24.889827"], ["updated_at", "2017-08-03 15:42:24.889827"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:riMJss66Qri4Ny3yNekp"], ["updated_at", "2017-08-03 15:42:24.890961"], ["id", 3]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 15:42:24.894676"], ["last_sign_in_at", "2017-08-03 15:42:24.894676"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 15:42:24.895259"], ["id", 3]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 15:42:24.896977"], ["kit_access_token", nil], ["id", 3]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 15:43:18.685676"], ["updated_at", "2017-08-03 15:43:18.685676"]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$vmzdHhysH/63zPvhokrXe.qTAjq2My0mxl.RawD0i6Bx99G9ix3l6"], ["created_at", "2017-08-03 15:43:18.833432"], ["updated_at", "2017-08-03 15:43:18.833432"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:es76UXVyjbuhGqabbXgM"], ["updated_at", "2017-08-03 15:43:18.835271"], ["id", 1]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$zUH7ONYKrevtPbyu4wt73ew5k.TVNr4PYG41lKGQWwz3/49W/5o8q"], ["created_at", "2017-08-03 15:43:18.840820"], ["updated_at", "2017-08-03 15:43:18.840820"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:pgEnBurd_xK5e5JXjDnK"], ["updated_at", "2017-08-03 15:43:18.841953"], ["id", 2]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$nHj.SS15wfRnNzOO5s3yq.FnWe9VztgOwf4P5CRU7OFO2WLrxWXCO"], ["created_at", "2017-08-03 15:43:18.848488"], ["updated_at", "2017-08-03 15:43:18.848488"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:3t5F2pK-1J_CKLzHHaaf"], ["updated_at", "2017-08-03 15:43:18.849879"], ["id", 3]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$zJowEyM6LXgb4BeE/ioPeOsHdwi66UfoRjeNG5LFAvZMDpBIJsKk2"], ["created_at", "2017-08-03 15:43:18.854992"], ["updated_at", "2017-08-03 15:43:18.854992"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:EUaEL3p_y5yknCjsuZAb"], ["updated_at", "2017-08-03 15:43:18.856361"], ["id", 4]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:43:18.892562"], ["updated_at", "2017-08-03 15:43:18.892562"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$PU2HHbqRPmiHqV6g3EaiMu4bWCC/kYDRqr7.PCycLveS8CcO78tN2"], ["access_token", "abc"], ["created_at", "2017-08-03 15:43:18.896531"], ["updated_at", "2017-08-03 15:43:18.896531"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:3uy_EReT85QD1Xs4-xpr"], ["updated_at", "2017-08-03 15:43:18.897649"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.3ms | ActiveRecord: 0.3ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:43:18.914496"], ["updated_at", "2017-08-03 15:43:18.914496"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$8C5eMnWmgoyC3AWYvqtaJOQJ2be2MQPcdBL9HXWx2OQPRY.flPrbm"], ["access_token", "abc"], ["created_at", "2017-08-03 15:43:18.918511"], ["updated_at", "2017-08-03 15:43:18.918511"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:xcqtbTdETexiz6XV5kyD"], ["updated_at", "2017-08-03 15:43:18.919739"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 1.0ms | ActiveRecord: 1.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.7ms | ActiveRecord: 1.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 0.7ms)
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:43:19.431956"], ["updated_at", "2017-08-03 15:43:19.431956"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$EY4pig9oXWGhHqfwk5ahLOsGdA5SHm16iN7lHoG0CeVNV8ibpP9de"], ["access_token", "abc"], ["created_at", "2017-08-03 15:43:19.436349"], ["updated_at", "2017-08-03 15:43:19.436349"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:yTsxVXNkJc6pxU3RbVXJ"], ["updated_at", "2017-08-03 15:43:19.437937"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:43:19.465463"], ["updated_at", "2017-08-03 15:43:19.465463"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$bcO8OfUUyNVk2qfw8iDMY.6JDpKC0WtMiMVXI60/kmTX28lKb8ZNa"], ["access_token", "abc"], ["created_at", "2017-08-03 15:43:19.469540"], ["updated_at", "2017-08-03 15:43:19.469540"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:SxdRzWaokM2hGB-eHkVq"], ["updated_at", "2017-08-03 15:43:19.470956"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:43:19.476650"], ["updated_at", "2017-08-03 15:43:19.476650"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$H4YTPYvAaxGxO.sPN4.LH.68oelFGd9V7X2YIAEIEOZIVWnxnG0oK"], ["access_token", "abc"], ["created_at", "2017-08-03 15:43:19.480145"], ["updated_at", "2017-08-03 15:43:19.480145"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:NTWTNHsfm7N6PyqvLaw1"], ["updated_at", "2017-08-03 15:43:19.481642"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 15:43:19.497343"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 15ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:43:19.503053"], ["updated_at", "2017-08-03 15:43:19.503053"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$n3JPBQRxEkuFzcW353UrDuMsyKsg5s.5cm6nMfGydPTkQhV3uMAte"], ["access_token", "abc"], ["created_at", "2017-08-03 15:43:19.507191"], ["updated_at", "2017-08-03 15:43:19.507191"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:2djHPgJ9HTrzgM-m81fK"], ["updated_at", "2017-08-03 15:43:19.508483"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 15:43:19.511457"], ["last_sign_in_at", "2017-08-03 15:43:19.511457"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 15:43:19.512273"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 15:43:19.514594"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.6ms | ActiveRecord: 0.7ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 15:44:01.860391"], ["updated_at", "2017-08-03 15:44:01.860391"]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.6ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$8W0QMtvHCv8YPdcPjrdGhuney2/gsPBP8F1/Fz7VJ6MRryVaqntvC"], ["created_at", "2017-08-03 15:44:02.014696"], ["updated_at", "2017-08-03 15:44:02.014696"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:43iZXQohJ7HudmA5Fc4h"], ["updated_at", "2017-08-03 15:44:02.016921"], ["id", 1]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$wTKTzzJsPfKpox5m6GELue3C08P.FWF3dx7OBbQqMhB8HCEF4zWI2"], ["created_at", "2017-08-03 15:44:02.022049"], ["updated_at", "2017-08-03 15:44:02.022049"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:hVQwpRtzaB6sKezQxM1k"], ["updated_at", "2017-08-03 15:44:02.023230"], ["id", 2]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$R8EbLftzsk.WsilN24prBONb1.ohpoq1sXty5JvBE2F7TpvG6t7yW"], ["created_at", "2017-08-03 15:44:02.029427"], ["updated_at", "2017-08-03 15:44:02.029427"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:_znke-eNk7wNNcykWP45"], ["updated_at", "2017-08-03 15:44:02.030660"], ["id", 3]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$M5Shfrm/FxnoMp6hFYqGje8t5DzY8NF7Q8PfUCmZmh5uMXDQ2DsfC"], ["created_at", "2017-08-03 15:44:02.035589"], ["updated_at", "2017-08-03 15:44:02.035589"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:UdkZ4wicJvKE_SWpshMV"], ["updated_at", "2017-08-03 15:44:02.036780"], ["id", 4]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" LIMIT ?[0m  [["LIMIT", 11]]
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" LIMIT ?[0m  [["LIMIT", 11]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" LIMIT ?[0m  [["LIMIT", 11]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:59:39.112997"], ["updated_at", "2017-08-03 15:59:39.112997"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$fHViKpvHFQy223qkvt2rHunucABSD7iyXhJyNj2UbeNc7AqwBuoKu"], ["access_token", "abc"], ["created_at", "2017-08-03 15:59:39.119909"], ["updated_at", "2017-08-03 15:59:39.119909"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:9sb5gKzHynqeYWMTMsRh"], ["updated_at", "2017-08-03 15:59:39.121230"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:59:39.143833"], ["updated_at", "2017-08-03 15:59:39.143833"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$JPV0MsphH.9vpfNeJo.rs.AzUnsTLfo.N.XAFr0g/UpmpdeC9UdSa"], ["access_token", "abc"], ["created_at", "2017-08-03 15:59:39.147792"], ["updated_at", "2017-08-03 15:59:39.147792"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:hGcww5EwAshaXJMDYXcT"], ["updated_at", "2017-08-03 15:59:39.148988"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.3ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
  [1m[35m (1.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:59:39.679582"], ["updated_at", "2017-08-03 15:59:39.679582"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$qATPAWYHrCcDYiKOQWMrVeLnjgtEA4YGb8lUBSGdeic8eml5lTBo6"], ["access_token", "abc"], ["created_at", "2017-08-03 15:59:39.686305"], ["updated_at", "2017-08-03 15:59:39.686305"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:T1e4eQucXu2e7birmkgY"], ["updated_at", "2017-08-03 15:59:39.688611"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:59:39.710910"], ["updated_at", "2017-08-03 15:59:39.710910"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$umunMK4OZQqchahdV8fD8.4M4LNfpWgMCrYuF0K3eeGegalzMIlhu"], ["access_token", "abc"], ["created_at", "2017-08-03 15:59:39.714854"], ["updated_at", "2017-08-03 15:59:39.714854"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:5koc39oskytG5Yp31qFX"], ["updated_at", "2017-08-03 15:59:39.716083"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:59:39.721991"], ["updated_at", "2017-08-03 15:59:39.721991"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$4YDBi9CeBBFLV3n/55iIReJG9PA2IiJ2rWvPsrAHaGxQwbXrAG64e"], ["access_token", "abc"], ["created_at", "2017-08-03 15:59:39.725755"], ["updated_at", "2017-08-03 15:59:39.725755"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:hs4Q4-DxRso4zh8Lwx6q"], ["updated_at", "2017-08-03 15:59:39.726920"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 15:59:39.743800"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 17ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 15:59:39.749781"], ["updated_at", "2017-08-03 15:59:39.749781"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$sG/.kze5GZ5ObtVgzswKZ.TiXUIFLELtXZHtJhJAhWfROt5xY1VZy"], ["access_token", "abc"], ["created_at", "2017-08-03 15:59:39.753703"], ["updated_at", "2017-08-03 15:59:39.753703"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:ytrHy9CSEXdQQh89P3Ax"], ["updated_at", "2017-08-03 15:59:39.755135"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 15:59:39.758312"], ["last_sign_in_at", "2017-08-03 15:59:39.758312"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 15:59:39.758970"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 15:59:39.760765"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.7ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 16:00:01.523998"], ["updated_at", "2017-08-03 16:00:01.523998"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$T6v62aprb8GWTa0tSqA11.N2Slg1SjhAkNuSz3P3cMSYSYj1OxXV6"], ["created_at", "2017-08-03 16:00:01.656983"], ["updated_at", "2017-08-03 16:00:01.656983"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:w_JYTZBFzt5crykWt376"], ["updated_at", "2017-08-03 16:00:01.658804"], ["id", 1]]
  [1m[35m (3.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$yWKYr2Ts0CqA6jVoLaMLJOzNhQDuULsS.Sq1S2J62laf876xtmgu6"], ["created_at", "2017-08-03 16:00:01.666563"], ["updated_at", "2017-08-03 16:00:01.666563"]]
  [1m[35mSQL (0.5ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:zfrZbFyiN2ZySi3FLG8P"], ["updated_at", "2017-08-03 16:00:01.670847"], ["id", 2]]
  [1m[35m (1.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:00:01.701024"], ["updated_at", "2017-08-03 16:00:01.701024"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$AewYIotxqcVSl4LmQBZy9.EWZLQaMXJN6Tm.sihBsuSG3rqtMGZTC"], ["access_token", "abc"], ["created_at", "2017-08-03 16:00:01.705016"], ["updated_at", "2017-08-03 16:00:01.705016"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:Lj26X5usjEeRzy3dqzco"], ["updated_at", "2017-08-03 16:00:01.706174"], ["id", 3]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:00:01.725950"], ["updated_at", "2017-08-03 16:00:01.725950"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$dYqfTlfsWCYz0nHflA4EquWqI/dyeVLc1kBzWOdjL9tAHPClXFpQO"], ["access_token", "abc"], ["created_at", "2017-08-03 16:00:01.729769"], ["updated_at", "2017-08-03 16:00:01.729769"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:Nj27x6hLd94Wqem6Y2cA"], ["updated_at", "2017-08-03 16:00:01.731349"], ["id", 3]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 1.0ms | ActiveRecord: 1.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.7ms | ActiveRecord: 3.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.7ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:00:02.231030"], ["updated_at", "2017-08-03 16:00:02.231030"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$XNJvr619.WJ1HYEtUUzCe.DXfk2G9z.FHiLmOPfZ91RFW3x2Tf7lW"], ["access_token", "abc"], ["created_at", "2017-08-03 16:00:02.236236"], ["updated_at", "2017-08-03 16:00:02.236236"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:Ccr2TeRJMRRiQmMp1H1_"], ["updated_at", "2017-08-03 16:00:02.237876"], ["id", 3]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:00:02.266124"], ["updated_at", "2017-08-03 16:00:02.266124"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$iA4ZMYylq/7ttVqYLrd3VemjqFv8ud0oXUohsSp3mmaV0jxay0l9G"], ["access_token", "abc"], ["created_at", "2017-08-03 16:00:02.270994"], ["updated_at", "2017-08-03 16:00:02.270994"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:JzxgJVcJN5k6Ck1R3hn7"], ["updated_at", "2017-08-03 16:00:02.272292"], ["id", 3]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.0ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:00:02.277572"], ["updated_at", "2017-08-03 16:00:02.277572"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$JednlElZLijr6NpTF7r1DusNs1drFAFHx2lILT1ewBFtOi2UC7uxe"], ["access_token", "abc"], ["created_at", "2017-08-03 16:00:02.281023"], ["updated_at", "2017-08-03 16:00:02.281023"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:uuGy77U8eGMWYCHjsPfz"], ["updated_at", "2017-08-03 16:00:02.282066"], ["id", 3]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 16:00:02.297918"], ["id", 3]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 16ms (ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:00:02.304814"], ["updated_at", "2017-08-03 16:00:02.304814"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$CfsXxKtzAlfi3/2IZGApd.Mxxd7kQhxdYwEIEHPbBitAqOiN5V2V2"], ["access_token", "abc"], ["created_at", "2017-08-03 16:00:02.308334"], ["updated_at", "2017-08-03 16:00:02.308334"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:tiPT6z7xmViBsdhHqqTF"], ["updated_at", "2017-08-03 16:00:02.309434"], ["id", 3]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 16:00:02.312074"], ["last_sign_in_at", "2017-08-03 16:00:02.312074"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 16:00:02.312644"], ["id", 3]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 16:00:02.314439"], ["kit_access_token", nil], ["id", 3]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.7ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 16:03:00.431287"], ["updated_at", "2017-08-03 16:03:00.431287"]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$wIclk/oW.OfqKIHws8jGq.zAdwxngIBSWfkjTO7ekKXrP7WBfS5da"], ["created_at", "2017-08-03 16:03:00.562800"], ["updated_at", "2017-08-03 16:03:00.562800"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:VuJ_KyBFsshUxXjy6yVw"], ["updated_at", "2017-08-03 16:03:00.564567"], ["id", 1]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$4QCd7DJeXCKslVan9trSXOHlsyRMwHzaEQRRu6Hm9sgGAe/qfqot6"], ["created_at", "2017-08-03 16:03:00.569754"], ["updated_at", "2017-08-03 16:03:00.569754"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:gy4hALDQCEkkNTDvDSH9"], ["updated_at", "2017-08-03 16:03:00.570922"], ["id", 2]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$RgQBvhTxllQkI0/z4AhnW.EQ/lC5vzBVm/8iYi/sfKfjG5.8eq2.6"], ["created_at", "2017-08-03 16:03:00.584406"], ["updated_at", "2017-08-03 16:03:00.584406"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:N-d4jFpKCx3nAqjJ7pF8"], ["updated_at", "2017-08-03 16:03:00.588346"], ["id", 3]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$g/I3zs6qytAyINHTCY6Vcu7BX4mM5kkNMGTS0bBNk2/yYTOlDIVUq"], ["created_at", "2017-08-03 16:03:00.594539"], ["updated_at", "2017-08-03 16:03:00.594539"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:sjq5KZ8WGa72kgTmjwf5"], ["updated_at", "2017-08-03 16:03:00.596156"], ["id", 4]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:03:00.632780"], ["updated_at", "2017-08-03 16:03:00.632780"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$pZWotDTiVy/0SBxGAIM.p.WJk8lgnnzuep.Nxn4S55fn8umYRStTW"], ["access_token", "abc"], ["created_at", "2017-08-03 16:03:00.637941"], ["updated_at", "2017-08-03 16:03:00.637941"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:QhJs_oHozdx69DPytoXH"], ["updated_at", "2017-08-03 16:03:00.640114"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:03:00.659281"], ["updated_at", "2017-08-03 16:03:00.659281"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$b3duw3R3pRscCznEo4tu.eCp8q9GtR/.0AIOd/vr.dtrRNUQ7Zvqe"], ["access_token", "abc"], ["created_at", "2017-08-03 16:03:00.663147"], ["updated_at", "2017-08-03 16:03:00.663147"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:bD12zVzofJ7UQMCH9XLw"], ["updated_at", "2017-08-03 16:03:00.664332"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.3ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
  [1m[35m (1.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:03:01.162989"], ["updated_at", "2017-08-03 16:03:01.162989"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$SX.4LUaPAtoMZTK/VPBJc.bIHn3SCX7ytmnjdytedqcmfwv3ABJf."], ["access_token", "abc"], ["created_at", "2017-08-03 16:03:01.169132"], ["updated_at", "2017-08-03 16:03:01.169132"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:QykzgHvxvCbEgLTFKDPS"], ["updated_at", "2017-08-03 16:03:01.171056"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:03:01.198049"], ["updated_at", "2017-08-03 16:03:01.198049"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$mwjFUEdZVJZw2mjoSQyED.i033adnwrdU3o3K1fE/wUDBP6O2gw.2"], ["access_token", "abc"], ["created_at", "2017-08-03 16:03:01.202645"], ["updated_at", "2017-08-03 16:03:01.202645"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:og6Fh8JmkzUxT1tSqAZQ"], ["updated_at", "2017-08-03 16:03:01.204963"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:03:01.210962"], ["updated_at", "2017-08-03 16:03:01.210962"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$NdpH2KNSs/Z2YrpxY.Gf3eHL.69ArKSRZGFXrLgbM0NyUutY9.96i"], ["access_token", "abc"], ["created_at", "2017-08-03 16:03:01.215097"], ["updated_at", "2017-08-03 16:03:01.215097"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:zUbxkyjfQTvhx94Quhs6"], ["updated_at", "2017-08-03 16:03:01.216313"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.2ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 16:03:01.230621"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 13ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:03:01.237627"], ["updated_at", "2017-08-03 16:03:01.237627"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$O0gAeR1nkwPAsnktwLeMced5lMkeEGFAH3J/8qnFv7NjXXS1pGo1S"], ["access_token", "abc"], ["created_at", "2017-08-03 16:03:01.241792"], ["updated_at", "2017-08-03 16:03:01.241792"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:NQbpTxWsgiDUFc6-D7LF"], ["updated_at", "2017-08-03 16:03:01.243169"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 16:03:01.246086"], ["last_sign_in_at", "2017-08-03 16:03:01.246086"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 16:03:01.246693"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 16:03:01.248409"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 8ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 16:08:53.151490"], ["updated_at", "2017-08-03 16:08:53.151490"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$BxKWp1XoqC4CMGnWsr5W9OG.My0KpPGLkHyPO.VZhFc3TFWi5pu/u"], ["created_at", "2017-08-03 16:08:53.299066"], ["updated_at", "2017-08-03 16:08:53.299066"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:7rsnzf3FsA-T_iLVaof-"], ["updated_at", "2017-08-03 16:08:53.304219"], ["id", 1]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$NUL1TeJnrE7Ti30vVJbbzOPBnNLG/cu4FwzCnxFyyESqaBfRbv/va"], ["created_at", "2017-08-03 16:08:53.309074"], ["updated_at", "2017-08-03 16:08:53.309074"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:fWzppe2eRxepjke5chb6"], ["updated_at", "2017-08-03 16:08:53.310173"], ["id", 2]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$.nbOb8YPp8TPlzKE1e04r.EGefFE3wcHMdmlr9/UdoUh2zILwzX/."], ["created_at", "2017-08-03 16:08:53.317523"], ["updated_at", "2017-08-03 16:08:53.317523"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:qe-9n_GFy8UJWpuyy666"], ["updated_at", "2017-08-03 16:08:53.320192"], ["id", 3]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$Efe1ztYBx7M3PHNk7xkWAu0lmue5B0XYCAjvKluEfWjal3fhxodMq"], ["created_at", "2017-08-03 16:08:53.324598"], ["updated_at", "2017-08-03 16:08:53.324598"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:2ak_-sUF7fcSNyY64Qy2"], ["updated_at", "2017-08-03 16:08:53.325739"], ["id", 4]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:08:53.362765"], ["updated_at", "2017-08-03 16:08:53.362765"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$ybla2xnQiwJLs6O07/w2O.ohL.2ZAZAhHaiEMgfG970bfcmcyQXsy"], ["access_token", "abc"], ["created_at", "2017-08-03 16:08:53.367387"], ["updated_at", "2017-08-03 16:08:53.367387"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:FySxrYK8RNxnxHcwaktf"], ["updated_at", "2017-08-03 16:08:53.369182"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:08:53.386621"], ["updated_at", "2017-08-03 16:08:53.386621"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$1VoFFz6sgMYM1yArpvaOWOomIKLkUT/t5E/wSruu0GAmUd7w6l95S"], ["access_token", "abc"], ["created_at", "2017-08-03 16:08:53.390701"], ["updated_at", "2017-08-03 16:08:53.390701"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:3xU7zsB4_wtYPHLWpUov"], ["updated_at", "2017-08-03 16:08:53.391918"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.7ms | ActiveRecord: 1.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.4ms | ActiveRecord: 1.3ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:08:53.930502"], ["updated_at", "2017-08-03 16:08:53.930502"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$0qQEw6TAkYPEXieubPTjLepY0eKYYjlW19ugxPQT0fDcjutic.JLK"], ["access_token", "abc"], ["created_at", "2017-08-03 16:08:53.936358"], ["updated_at", "2017-08-03 16:08:53.936358"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:1s7_BUCG4Aw5LyyY7YEn"], ["updated_at", "2017-08-03 16:08:53.937949"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:08:53.967546"], ["updated_at", "2017-08-03 16:08:53.967546"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$pY33ODrAqEtUbXTfydtZ5.QG7oLlPMQb6tS9xmaSot7EtxE/19u9e"], ["access_token", "abc"], ["created_at", "2017-08-03 16:08:53.972013"], ["updated_at", "2017-08-03 16:08:53.972013"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:vEAaByESzCjz-HFpzRws"], ["updated_at", "2017-08-03 16:08:53.973157"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:08:53.978598"], ["updated_at", "2017-08-03 16:08:53.978598"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$K7WiBBS1yJ46ptbWArsaxOC3wMYCdz2oOabnhJoCwUehYZu67Qv4a"], ["access_token", "abc"], ["created_at", "2017-08-03 16:08:53.983308"], ["updated_at", "2017-08-03 16:08:53.983308"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:qs6BTrUbAtFWGmzwPShd"], ["updated_at", "2017-08-03 16:08:53.985175"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 16:08:54.001149"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 15ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:08:54.007908"], ["updated_at", "2017-08-03 16:08:54.007908"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$pRzIY1DbgZg1AGMy4h/n5ORTBcpFmPnVhUzwBLKASBH13nuOi.sVe"], ["access_token", "abc"], ["created_at", "2017-08-03 16:08:54.011983"], ["updated_at", "2017-08-03 16:08:54.011983"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:z_EHNoGzoNeB6J5owkdL"], ["updated_at", "2017-08-03 16:08:54.013184"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 16:08:54.016630"], ["last_sign_in_at", "2017-08-03 16:08:54.016630"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 16:08:54.017314"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 16:08:54.019405"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.6ms | ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 16:09:58.560807"], ["updated_at", "2017-08-03 16:09:58.560807"]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$qxxXIemWGtiD2sXsVBSWCOSGSEUKfAsnHCV.WWQRWBqtuOTRyWgYW"], ["created_at", "2017-08-03 16:09:58.703364"], ["updated_at", "2017-08-03 16:09:58.703364"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:PLppeBkMkY8HyjmrEGys"], ["updated_at", "2017-08-03 16:09:58.705644"], ["id", 1]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.9ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (1.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$LbtuqKNqIoqzN0VFNnklw.5MLjLxd7z6UMwA8Y9LzKeDQ7WmquVB6"], ["created_at", "2017-08-03 16:09:58.717177"], ["updated_at", "2017-08-03 16:09:58.717177"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:ChAeyazzcsZZc6vxKgvy"], ["updated_at", "2017-08-03 16:09:58.723647"], ["id", 2]]
  [1m[35m (1.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (1.4ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$NAD8xbeHbSNpP5lhPJ1/muo27a0wE5glI4Lgx4T0SszzU6ie8Fqt2"], ["created_at", "2017-08-03 16:09:58.738304"], ["updated_at", "2017-08-03 16:09:58.738304"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:nHRdoLS_T1oWfHE8ar43"], ["updated_at", "2017-08-03 16:09:58.740496"], ["id", 3]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$pUVFPqAzL0AVhCz8u0hIBOCnIB2XEAHIIOeVIIq8G1iBX6IG.2yzW"], ["created_at", "2017-08-03 16:09:58.745208"], ["updated_at", "2017-08-03 16:09:58.745208"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:VoxznhTb_EdgJ4CnksZP"], ["updated_at", "2017-08-03 16:09:58.746578"], ["id", 4]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:09:58.764138"], ["updated_at", "2017-08-03 16:09:58.764138"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$nPrhh0rBQgxVnBpOS5uI7.zEr1xno2wdcfb4RPcQTqZ.clhbbtud6"], ["access_token", "abc"], ["created_at", "2017-08-03 16:09:58.768098"], ["updated_at", "2017-08-03 16:09:58.768098"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:deQ4WbQAQyRgH2BYoLJv"], ["updated_at", "2017-08-03 16:09:58.769352"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:09:58.788408"], ["updated_at", "2017-08-03 16:09:58.788408"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$hMVc/tHyox1vJtUfEvf1V.FcC3OP.PmjmZ3/hj2eJg4.RrzUlzTzi"], ["access_token", "abc"], ["created_at", "2017-08-03 16:09:58.795199"], ["updated_at", "2017-08-03 16:09:58.795199"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:sPin9i3kyM5KENg7igdr"], ["updated_at", "2017-08-03 16:09:58.796677"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:09:59.311048"], ["updated_at", "2017-08-03 16:09:59.311048"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$bbdvFaJ1cQ7.zgzgkoEuYOL0ycwlYfRr3aAvdPsvGEYls2kdss2Jy"], ["access_token", "abc"], ["created_at", "2017-08-03 16:09:59.315546"], ["updated_at", "2017-08-03 16:09:59.315546"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:eT4XyXfDJp5fnfy-9oVB"], ["updated_at", "2017-08-03 16:09:59.316951"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:09:59.343891"], ["updated_at", "2017-08-03 16:09:59.343891"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$eWn70s3gVBjHShTUj43VC.F3oQmR0ookQDww9kWzmikW/6867CqD2"], ["access_token", "abc"], ["created_at", "2017-08-03 16:09:59.348088"], ["updated_at", "2017-08-03 16:09:59.348088"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:Hk5g9qKEWmMEZyFX4zu7"], ["updated_at", "2017-08-03 16:09:59.349308"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.0ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:09:59.354805"], ["updated_at", "2017-08-03 16:09:59.354805"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$Rok1OXc2pHxu04CKsViAO.l/TFYyiCO7XCrI08k63hMEv0GP1T2Sm"], ["access_token", "abc"], ["created_at", "2017-08-03 16:09:59.358649"], ["updated_at", "2017-08-03 16:09:59.358649"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:rf9tQWBn--JJJHSSkJDm"], ["updated_at", "2017-08-03 16:09:59.359828"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 16:09:59.374775"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 14ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:09:59.381794"], ["updated_at", "2017-08-03 16:09:59.381794"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$/kfur7UIlGxrLDljyjNfD.MWF1CVTGFkAmAl8S1lOCcUH46iZsbrK"], ["access_token", "abc"], ["created_at", "2017-08-03 16:09:59.386650"], ["updated_at", "2017-08-03 16:09:59.386650"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:6gzyycF22hyz64zRJQ5E"], ["updated_at", "2017-08-03 16:09:59.387882"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 16:09:59.390797"], ["last_sign_in_at", "2017-08-03 16:09:59.390797"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 16:09:59.391586"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 16:09:59.393389"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 16:13:17.203932"], ["updated_at", "2017-08-03 16:13:17.203932"]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.1ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (2.6ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.6ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$H2nB/Swa97W9hNU9iCV9fOzRbmQ3UKXFmDUIoRshtfoikGD5/HHJ6"], ["created_at", "2017-08-03 16:13:17.352855"], ["updated_at", "2017-08-03 16:13:17.352855"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:_GdKThVDTQKv3L4A2oLy"], ["updated_at", "2017-08-03 16:13:17.356949"], ["id", 1]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$SMlWsBVbskO98CF4NKqao.ggCd2s/oWirHnGLFHtUUesGtOE0BJe2"], ["created_at", "2017-08-03 16:13:17.362360"], ["updated_at", "2017-08-03 16:13:17.362360"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:JozhLApNkjn_XouSyQtp"], ["updated_at", "2017-08-03 16:13:17.363821"], ["id", 2]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (1.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$PnUavJYFxQTTsCO8K2EfY.A3YiPukh1Bf8.NqUh5OHnbv3Xli8Z4K"], ["created_at", "2017-08-03 16:13:17.373731"], ["updated_at", "2017-08-03 16:13:17.373731"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:YNjhkFsurgz9D2MJXyix"], ["updated_at", "2017-08-03 16:13:17.375141"], ["id", 3]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$FA6xJzCcgNB4..ncC5jtBewUgztE.OIgQSBR7R.OU6PogWvUF3iM2"], ["created_at", "2017-08-03 16:13:17.379289"], ["updated_at", "2017-08-03 16:13:17.379289"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:WYtcu-SoKSoW8sdds4y7"], ["updated_at", "2017-08-03 16:13:17.380811"], ["id", 4]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:13:17.398362"], ["updated_at", "2017-08-03 16:13:17.398362"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$gXGEs7Sxi5arNDVvIJh00uAJhkkqBez7th2JlVEkQZhqFv0nMq/46"], ["access_token", "abc"], ["created_at", "2017-08-03 16:13:17.403111"], ["updated_at", "2017-08-03 16:13:17.403111"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:8bYmPMm4RsKfx__Fy1PN"], ["updated_at", "2017-08-03 16:13:17.404383"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:13:17.420250"], ["updated_at", "2017-08-03 16:13:17.420250"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$iT49CaHG5SS2I0sj/h67xuferWHkSZtYH4N89z4.fs2zU7X4uFOSK"], ["access_token", "abc"], ["created_at", "2017-08-03 16:13:17.423969"], ["updated_at", "2017-08-03 16:13:17.423969"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:Cqw63g9M2HyAoyCyf_yQ"], ["updated_at", "2017-08-03 16:13:17.425220"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.5ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 0.9ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:13:17.947436"], ["updated_at", "2017-08-03 16:13:17.947436"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$yPMdmO1kfPzJ3skfVyQ06OECbi08yfmX/Dv9Xb5uvUC/q303vx/sq"], ["access_token", "abc"], ["created_at", "2017-08-03 16:13:17.954305"], ["updated_at", "2017-08-03 16:13:17.954305"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:6SGaFC2oFp91Z88w-yjC"], ["updated_at", "2017-08-03 16:13:17.956602"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:13:17.984743"], ["updated_at", "2017-08-03 16:13:17.984743"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$Exwyrqa1Hw90LoZzLTa5mORT/MuRnTp6rceU3jP7JyWeSxUrHD2IG"], ["access_token", "abc"], ["created_at", "2017-08-03 16:13:17.988520"], ["updated_at", "2017-08-03 16:13:17.988520"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:Jcv6nCTHJC_eYo_psMgz"], ["updated_at", "2017-08-03 16:13:17.990358"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.0ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:13:17.995443"], ["updated_at", "2017-08-03 16:13:17.995443"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$R5PG0L2JYcDdSXDpdem2FOGu/fu7XAhRLMNUKPIHCnceIOTmd2H9q"], ["access_token", "abc"], ["created_at", "2017-08-03 16:13:17.999653"], ["updated_at", "2017-08-03 16:13:17.999653"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:qYz6R3yLG_SittxkWwLR"], ["updated_at", "2017-08-03 16:13:18.001136"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 16:13:18.016915"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 15ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:13:18.023918"], ["updated_at", "2017-08-03 16:13:18.023918"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$YeVh6pxqB.k4dyF.l9xCbO35tCJ55ugzI2lOP3wvo02d9g1ybkYVC"], ["access_token", "abc"], ["created_at", "2017-08-03 16:13:18.028345"], ["updated_at", "2017-08-03 16:13:18.028345"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:nW7xFBrxbdWGPvdpL2FR"], ["updated_at", "2017-08-03 16:13:18.029706"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 16:13:18.033074"], ["last_sign_in_at", "2017-08-03 16:13:18.033074"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 16:13:18.033669"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 16:13:18.035357"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 16:13:44.504399"], ["updated_at", "2017-08-03 16:13:44.504399"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (4.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$8DC6RwdX5M2vNFvfooqoBePomfmcmTwwjQx1N.OOCF7KbhOfR0qmC"], ["created_at", "2017-08-03 16:13:44.689684"], ["updated_at", "2017-08-03 16:13:44.689684"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:kqtuBUsDTYWBaE19BTPn"], ["updated_at", "2017-08-03 16:13:44.691599"], ["id", 1]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$8uBLAJ7eikFvwsj0EFOmBeENsX/1xsD1PH0vNpsxXUDk/l6RuIS26"], ["created_at", "2017-08-03 16:13:44.697497"], ["updated_at", "2017-08-03 16:13:44.697497"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:GP3cd6RBp3KruvwYbQTz"], ["updated_at", "2017-08-03 16:13:44.698737"], ["id", 2]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$uK2iTyzm1bKEmZVp5jfUhOn0YO0prGI4HOZv.ZW2jSHkJc2T3gSKm"], ["created_at", "2017-08-03 16:13:44.705645"], ["updated_at", "2017-08-03 16:13:44.705645"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:7_jDauZtRyz2jHJoxCNi"], ["updated_at", "2017-08-03 16:13:44.706948"], ["id", 3]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$E6WO5KD5wcEVGexrWtE0GebKI8UOCP/b9nZEoQnS.PFyoghufKUMW"], ["created_at", "2017-08-03 16:13:44.711346"], ["updated_at", "2017-08-03 16:13:44.711346"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:wNP8afhdv26xVbGjzT4q"], ["updated_at", "2017-08-03 16:13:44.712947"], ["id", 4]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:13:44.729857"], ["updated_at", "2017-08-03 16:13:44.729857"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$DbK9zcU0wNnblZ8Z5KDiD.I4/l7zZolWTi9.1aZG9waJxKfRgZmKq"], ["access_token", "abc"], ["created_at", "2017-08-03 16:13:44.734363"], ["updated_at", "2017-08-03 16:13:44.734363"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:1q9aQx6bknkiWcoeFdL5"], ["updated_at", "2017-08-03 16:13:44.736005"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:13:44.753039"], ["updated_at", "2017-08-03 16:13:44.753039"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$56ZweIB72DS3yscE4NlyRefGdKtE11FXEvsnDJ8/2.xERCtoWh1yS"], ["access_token", "abc"], ["created_at", "2017-08-03 16:13:44.758742"], ["updated_at", "2017-08-03 16:13:44.758742"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:2ZR4M53hfGEvrVx4EQhJ"], ["updated_at", "2017-08-03 16:13:44.759912"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.5ms | ActiveRecord: 0.5ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
  [1m[35m (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:13:45.273833"], ["updated_at", "2017-08-03 16:13:45.273833"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$nUTwSShw8btblZOLbLsnWet1yumL9hX3iNX5zV4veAto0AM/5TjG2"], ["access_token", "abc"], ["created_at", "2017-08-03 16:13:45.278081"], ["updated_at", "2017-08-03 16:13:45.278081"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:LM8fpE1FwL92p1KGvuFc"], ["updated_at", "2017-08-03 16:13:45.279493"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:13:45.308359"], ["updated_at", "2017-08-03 16:13:45.308359"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$i09KlIwa7YMKA5m1bfpWU.orSyM2IjIoaiDbD.6FW.94ckfPl7HHG"], ["access_token", "abc"], ["created_at", "2017-08-03 16:13:45.312093"], ["updated_at", "2017-08-03 16:13:45.312093"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:c3ADecYCnvGsVq1k8TU_"], ["updated_at", "2017-08-03 16:13:45.313390"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.0ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:13:45.319375"], ["updated_at", "2017-08-03 16:13:45.319375"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$Ru6ercexpkLJnHarXpdnKeAk6QoObPxULDuJF5XgC/DVJ/Qrsl2ea"], ["access_token", "abc"], ["created_at", "2017-08-03 16:13:45.323254"], ["updated_at", "2017-08-03 16:13:45.323254"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:xUqwR52yHW5xEEu8a6n9"], ["updated_at", "2017-08-03 16:13:45.324439"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 16:13:45.339267"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 15ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:13:45.346249"], ["updated_at", "2017-08-03 16:13:45.346249"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$EVARrL/LTiBQKb6D9/Q.a.WsXgcRKIqPaz.uXL8acnOxSwIFMgzIy"], ["access_token", "abc"], ["created_at", "2017-08-03 16:13:45.350131"], ["updated_at", "2017-08-03 16:13:45.350131"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:WH4oxsZhBbByLRHQSo7Y"], ["updated_at", "2017-08-03 16:13:45.351305"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 16:13:45.354865"], ["last_sign_in_at", "2017-08-03 16:13:45.354865"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 16:13:45.355469"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 16:13:45.357202"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.7ms | ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 16:13:58.012548"], ["updated_at", "2017-08-03 16:13:58.012548"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.3ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$tz/moOgFOjqoBt8FYsAvzuLonh1OxsLlQkDeSxjyb5n0HLa2JmUVa"], ["created_at", "2017-08-03 16:13:58.205131"], ["updated_at", "2017-08-03 16:13:58.205131"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:fixudsmhU5yZXE_oCgvJ"], ["updated_at", "2017-08-03 16:13:58.206991"], ["id", 1]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$zO8maIqnNWYon76DzKhLmu5upokFBtrrdPITW.uW7FRLdizcui2sy"], ["created_at", "2017-08-03 16:13:58.211967"], ["updated_at", "2017-08-03 16:13:58.211967"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:czFBGQp8o6VY9SzZKrRv"], ["updated_at", "2017-08-03 16:13:58.213276"], ["id", 2]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$MQxfVoPqyERnfyy3rzQ2Z.oYfffYFiYUkJekm9daeELodtVWZXoWi"], ["created_at", "2017-08-03 16:13:58.220140"], ["updated_at", "2017-08-03 16:13:58.220140"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:H3PCnNgYH1udJugpP6DP"], ["updated_at", "2017-08-03 16:13:58.224450"], ["id", 3]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$C5S70i0EGe2NymM0.gXfMeufbBU/hGc6hylvbw2g75UWfpxd6Or82"], ["created_at", "2017-08-03 16:13:58.229464"], ["updated_at", "2017-08-03 16:13:58.229464"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:Zz7mtCukxU8TbMQk18LV"], ["updated_at", "2017-08-03 16:13:58.231302"], ["id", 4]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:13:58.248086"], ["updated_at", "2017-08-03 16:13:58.248086"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$DZZiMrYGG/OlMKSiuwIUK.o/fmXEY7tnfjOzn5Swr6qj5YyXkiIVy"], ["access_token", "abc"], ["created_at", "2017-08-03 16:13:58.252109"], ["updated_at", "2017-08-03 16:13:58.252109"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:a3qn8we-hjMaLocr-5k3"], ["updated_at", "2017-08-03 16:13:58.253634"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.3ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:13:58.268487"], ["updated_at", "2017-08-03 16:13:58.268487"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$WK6ZTbc1cnLhpvUKNwXaqO.ntGD4cRKkkBV5/jxyriRZTwrUiAMhW"], ["access_token", "abc"], ["created_at", "2017-08-03 16:13:58.273921"], ["updated_at", "2017-08-03 16:13:58.273921"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:quuUVyFhfXP5egsyS7nB"], ["updated_at", "2017-08-03 16:13:58.275457"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
  [1m[35m (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:13:58.784273"], ["updated_at", "2017-08-03 16:13:58.784273"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$xNrHBGqemvBRP7QdvX5QN.0wHLEZ5vyBaY5XoUYmbcaP9yq2Wu5J."], ["access_token", "abc"], ["created_at", "2017-08-03 16:13:58.789802"], ["updated_at", "2017-08-03 16:13:58.789802"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:jHsiH4s3V8zR2i12Bxqo"], ["updated_at", "2017-08-03 16:13:58.791252"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:13:58.818302"], ["updated_at", "2017-08-03 16:13:58.818302"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$Y7wxz6/2zWkoZjfgpYYaKeggPIBTV6.r0KFtopDDZuJ2Qo3Vz10f."], ["access_token", "abc"], ["created_at", "2017-08-03 16:13:58.822488"], ["updated_at", "2017-08-03 16:13:58.822488"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:DvstCUXRMf-5knw_EgtR"], ["updated_at", "2017-08-03 16:13:58.823762"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:13:58.828996"], ["updated_at", "2017-08-03 16:13:58.828996"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$m3x8PDYQBJbGyD2UIRXEr.rs5yTTNmNwMAtj0wgpkH6eveaGom/uW"], ["access_token", "abc"], ["created_at", "2017-08-03 16:13:58.833549"], ["updated_at", "2017-08-03 16:13:58.833549"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:rJNwK7L_L-F3UDcP_Q7Z"], ["updated_at", "2017-08-03 16:13:58.834938"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 16:13:58.849662"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 14ms (ActiveRecord: 0.4ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:13:58.856671"], ["updated_at", "2017-08-03 16:13:58.856671"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$hQ0ULWZK06NXVhoT4PvRT..PyOLb6Zpt3tA8GR4R2OnNPQzA/m3CS"], ["access_token", "abc"], ["created_at", "2017-08-03 16:13:58.860713"], ["updated_at", "2017-08-03 16:13:58.860713"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:7ANBNG7saZj-i5vKeCG-"], ["updated_at", "2017-08-03 16:13:58.861903"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 16:13:58.864802"], ["last_sign_in_at", "2017-08-03 16:13:58.864802"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 16:13:58.865423"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 16:13:58.867116"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 8ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 16:14:14.951425"], ["updated_at", "2017-08-03 16:14:14.951425"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.1ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.5ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$88rQY01a56PZ3smoiC11y.PsnrfeByUXNMGxnjcAEDqb0C3fdn2iK"], ["created_at", "2017-08-03 16:14:15.136097"], ["updated_at", "2017-08-03 16:14:15.136097"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:vMw-ftowkqgB1_Ck_DB4"], ["updated_at", "2017-08-03 16:14:15.138045"], ["id", 1]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$ppE32d2sLu6DH5vfLG5ik.VLRNf.BlDgBozMMhAQh9Drt/Nrx2awe"], ["created_at", "2017-08-03 16:14:15.143443"], ["updated_at", "2017-08-03 16:14:15.143443"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:geMdT4xvs22MSxNsuMiX"], ["updated_at", "2017-08-03 16:14:15.144710"], ["id", 2]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$uBDb6kZW/mKH3DCwfr1/LeZvkdZerqwHwInt7Z9qrRRnkp99WZa2S"], ["created_at", "2017-08-03 16:14:15.151452"], ["updated_at", "2017-08-03 16:14:15.151452"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:y_ZZhJXgDN5CkfJqxhqA"], ["updated_at", "2017-08-03 16:14:15.152808"], ["id", 3]]
  [1m[35m (5.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$FUWDVTwpl.mXSTEhONFm2.tFssawNgFl/R5cGu5r5O1kaA1ymQ.K2"], ["created_at", "2017-08-03 16:14:15.163405"], ["updated_at", "2017-08-03 16:14:15.163405"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:Cotbc3SE8rA6UZhshjdj"], ["updated_at", "2017-08-03 16:14:15.165062"], ["id", 4]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:14:15.182227"], ["updated_at", "2017-08-03 16:14:15.182227"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$FjGVo2B5kTd2jscPqj2Cq.Bhna0bjzGv./hXBVuB5WvS83KA9Bb5."], ["access_token", "abc"], ["created_at", "2017-08-03 16:14:15.186768"], ["updated_at", "2017-08-03 16:14:15.186768"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:PG9qV51uQEBqZb4Uy1-C"], ["updated_at", "2017-08-03 16:14:15.188231"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:14:15.202379"], ["updated_at", "2017-08-03 16:14:15.202379"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$c05f27BGW02u50Dw728xZewB6z8izDWuq3C5uaaU.F.A/uHIlV5Mu"], ["access_token", "abc"], ["created_at", "2017-08-03 16:14:15.207430"], ["updated_at", "2017-08-03 16:14:15.207430"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:GtaGo6xxBX7LsDY6P1EW"], ["updated_at", "2017-08-03 16:14:15.210432"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.7ms | ActiveRecord: 1.4ms)
  [1m[35m (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:14:15.726424"], ["updated_at", "2017-08-03 16:14:15.726424"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$wQy1vohibdEly7sAUX2VY.Rb2pLY97MIiigXD2anM5PkfM0y3eAcO"], ["access_token", "abc"], ["created_at", "2017-08-03 16:14:15.731857"], ["updated_at", "2017-08-03 16:14:15.731857"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:wn6EMNZDpWyJcTdyTo9i"], ["updated_at", "2017-08-03 16:14:15.733671"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:14:15.763193"], ["updated_at", "2017-08-03 16:14:15.763193"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$BzGxkBmRm4yBSnveUPNcvuZ0lb2eZ6n25XbpfKEq2Y0gBAL//M24a"], ["access_token", "abc"], ["created_at", "2017-08-03 16:14:15.767091"], ["updated_at", "2017-08-03 16:14:15.767091"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:RyGHqAoBij_61PR3euRo"], ["updated_at", "2017-08-03 16:14:15.768282"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.0ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:14:15.773613"], ["updated_at", "2017-08-03 16:14:15.773613"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$Jj4869BQwP825DxUxv6XPOMcDBusFHkEHhs38.a/pnf5fhnxe5V5m"], ["access_token", "abc"], ["created_at", "2017-08-03 16:14:15.777182"], ["updated_at", "2017-08-03 16:14:15.777182"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:qerX8x_TMhaEZ8anuA8X"], ["updated_at", "2017-08-03 16:14:15.778267"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 16:14:15.794470"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 16ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:14:15.800218"], ["updated_at", "2017-08-03 16:14:15.800218"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$w/csGry4xovkUdokGEC8f.cewdMTt3Ia7IXoG/hla5OZHXwmD6x.C"], ["access_token", "abc"], ["created_at", "2017-08-03 16:14:15.803699"], ["updated_at", "2017-08-03 16:14:15.803699"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:yPycz3bxjaysVVAswh8J"], ["updated_at", "2017-08-03 16:14:15.805171"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 16:14:15.808550"], ["last_sign_in_at", "2017-08-03 16:14:15.808550"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 16:14:15.809408"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 16:14:15.811310"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.6ms | ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 16:14:35.575129"], ["updated_at", "2017-08-03 16:14:35.575129"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$VMm4paHMjr.wjo2G/xjgKuT1apMuco3FXsRD50AU6mFOZij.fhAb6"], ["created_at", "2017-08-03 16:14:35.749239"], ["updated_at", "2017-08-03 16:14:35.749239"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:F3mQ81U17UjB_sxfz2ny"], ["updated_at", "2017-08-03 16:14:35.753782"], ["id", 1]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$9YnlqI2P7cWO3tGI55OmD.VHgBxcaAE3g/0TqlB08vOsN2heccyo6"], ["created_at", "2017-08-03 16:14:35.762792"], ["updated_at", "2017-08-03 16:14:35.762792"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:vDdUFDzHyk5VevwtV9AA"], ["updated_at", "2017-08-03 16:14:35.764081"], ["id", 2]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$W5iB3sTxadeUNakpXuU3LOo38kMwdySNkNrjo0NEJvo83uoaXxcoG"], ["created_at", "2017-08-03 16:14:35.770766"], ["updated_at", "2017-08-03 16:14:35.770766"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:Pxsweojii5AYUUxsBucf"], ["updated_at", "2017-08-03 16:14:35.771965"], ["id", 3]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$7SL29TN6YXgRxk8isre23uubaui6zE5X9sv/.Djw7LTptNzQRdOKO"], ["created_at", "2017-08-03 16:14:35.777162"], ["updated_at", "2017-08-03 16:14:35.777162"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:zRJykE5jygxazwP5SGT1"], ["updated_at", "2017-08-03 16:14:35.778874"], ["id", 4]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (3.0ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:14:35.798827"], ["updated_at", "2017-08-03 16:14:35.798827"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$Za2oJcKtpYLU.xNfw7QlJeQmduP0Ip5ucGWa6soaS4CAHxIQQlyBG"], ["access_token", "abc"], ["created_at", "2017-08-03 16:14:35.803439"], ["updated_at", "2017-08-03 16:14:35.803439"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:yhifJxh8yE8N51yZApry"], ["updated_at", "2017-08-03 16:14:35.804809"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:14:35.820809"], ["updated_at", "2017-08-03 16:14:35.820809"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$Q7dpj42sUuMDZHXHJhpEGOwPZld48mS.bRSL1NIvjB0J9N5NEBB0y"], ["access_token", "abc"], ["created_at", "2017-08-03 16:14:35.825258"], ["updated_at", "2017-08-03 16:14:35.825258"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:HiD2DzFas1namVBjaw9V"], ["updated_at", "2017-08-03 16:14:35.826754"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 1.5ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.9ms)
  [1m[35m (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:14:36.350447"], ["updated_at", "2017-08-03 16:14:36.350447"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$4LB87dExGPOKwV5Clora9eOpaY76AJ6e6F5b6N5hsgKMhzCfu4u.W"], ["access_token", "abc"], ["created_at", "2017-08-03 16:14:36.355881"], ["updated_at", "2017-08-03 16:14:36.355881"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:hQsQASTAGzFsucs_8Hz1"], ["updated_at", "2017-08-03 16:14:36.357568"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:14:36.387367"], ["updated_at", "2017-08-03 16:14:36.387367"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$v70PxcIHwpWaxmv6SdBJaOzCQCSaMHy6wjCq.l3bBLchgXUUWH8kq"], ["access_token", "abc"], ["created_at", "2017-08-03 16:14:36.392162"], ["updated_at", "2017-08-03 16:14:36.392162"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:r_KEK72DNTxx-vJ--ps2"], ["updated_at", "2017-08-03 16:14:36.393482"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.0ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:14:36.398572"], ["updated_at", "2017-08-03 16:14:36.398572"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$8U6YkpsBNhsULowcfY8L3e91wjx2fXxAJgV5eUwMYSYJxvsQfg/9a"], ["access_token", "abc"], ["created_at", "2017-08-03 16:14:36.402753"], ["updated_at", "2017-08-03 16:14:36.402753"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:Y6yCex5jHmihUgUyNN9R"], ["updated_at", "2017-08-03 16:14:36.403868"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 16:14:36.421349"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 18ms (ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:14:36.428355"], ["updated_at", "2017-08-03 16:14:36.428355"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$OMsX0GJ9lUzOgFI78IUIkeXWmS.Jee1ZPEbroZ.PvtaeQfe42YcqC"], ["access_token", "abc"], ["created_at", "2017-08-03 16:14:36.432003"], ["updated_at", "2017-08-03 16:14:36.432003"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:wo-juaXQAzYUTbG2Nsbi"], ["updated_at", "2017-08-03 16:14:36.433154"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 16:14:36.436061"], ["last_sign_in_at", "2017-08-03 16:14:36.436061"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 16:14:36.436679"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 16:14:36.438818"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.6ms | ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 16:15:41.701122"], ["updated_at", "2017-08-03 16:15:41.701122"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$tTpL.LYM1fJOAOiOaOBJQOfTgzGTh6ev/hUi7awgcYbFApFLhN6fS"], ["created_at", "2017-08-03 16:15:41.903877"], ["updated_at", "2017-08-03 16:15:41.903877"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:H8fuzhgxqC_5qKyrKP7z"], ["updated_at", "2017-08-03 16:15:41.905743"], ["id", 1]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$mkcN9yxXD8P7GtlvnFzOx.6lXkV00I1Xbmif4JjYEizTqTAWdgXHy"], ["created_at", "2017-08-03 16:15:41.911286"], ["updated_at", "2017-08-03 16:15:41.911286"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:vvx3usSqyy5Vh1bk6iD8"], ["updated_at", "2017-08-03 16:15:41.912523"], ["id", 2]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$OYuOf4GxQorJYtzQyvz5p.Mr0XLP.aOtUMmYq26S.DMHNawStaPti"], ["created_at", "2017-08-03 16:15:41.919926"], ["updated_at", "2017-08-03 16:15:41.919926"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:EfeExi1L74fRXk4K8MhS"], ["updated_at", "2017-08-03 16:15:41.921655"], ["id", 3]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (2.6ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$PALD..s9IZ7ujqZ5SROdvu89gBi9nnJdf0m2dY8mq.5q9dw/RA71i"], ["created_at", "2017-08-03 16:15:41.929288"], ["updated_at", "2017-08-03 16:15:41.929288"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:vmzmEYzUt8T1Jv_VMh67"], ["updated_at", "2017-08-03 16:15:41.930606"], ["id", 4]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:15:41.952152"], ["updated_at", "2017-08-03 16:15:41.952152"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$SfErNNfjsySSvcu2gwZYSOz6weHUlYcgDwVIu1um1qW15m8JpBMb."], ["access_token", "abc"], ["created_at", "2017-08-03 16:15:41.956902"], ["updated_at", "2017-08-03 16:15:41.956902"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:zdrDzR5-tQyrfuuKLJQP"], ["updated_at", "2017-08-03 16:15:41.958099"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:15:41.974441"], ["updated_at", "2017-08-03 16:15:41.974441"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$yG1k.9K5GrEjgB/70gl2eu1xSNVoHcht1CC5up/IsO9TTYI6GE872"], ["access_token", "abc"], ["created_at", "2017-08-03 16:15:41.978959"], ["updated_at", "2017-08-03 16:15:41.978959"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:CB3GyhLpoQCSFHr2bry1"], ["updated_at", "2017-08-03 16:15:41.980243"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 13ms (Views: 1.1ms | ActiveRecord: 2.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.8ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 1.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 1.3ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:15:42.646583"], ["updated_at", "2017-08-03 16:15:42.646583"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$CAODYzXYTruW9e4hA.vzY.GlY9jvjNliOxyhH9OwU/8z1uDRisKhO"], ["access_token", "abc"], ["created_at", "2017-08-03 16:15:42.652579"], ["updated_at", "2017-08-03 16:15:42.652579"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:gfXLQb3-8azZvyzQdDyi"], ["updated_at", "2017-08-03 16:15:42.658684"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:15:42.693297"], ["updated_at", "2017-08-03 16:15:42.693297"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$sUQAs.mlb9nv/DJ8sQOUQuWud7awAK6Ai.z9JE3hq4Hjzq8U1IcHm"], ["access_token", "abc"], ["created_at", "2017-08-03 16:15:42.697407"], ["updated_at", "2017-08-03 16:15:42.697407"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:yXrkF85_a79jwWyksEqu"], ["updated_at", "2017-08-03 16:15:42.698633"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.0ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:15:42.703826"], ["updated_at", "2017-08-03 16:15:42.703826"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$yIpNHReO8BjGYZU3v45eH.rPEh1OlRkYXTYSkUeYxQr2noVVIApT2"], ["access_token", "abc"], ["created_at", "2017-08-03 16:15:42.707960"], ["updated_at", "2017-08-03 16:15:42.707960"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:Tt2zXLh68bFaFfachAJd"], ["updated_at", "2017-08-03 16:15:42.709313"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 16:15:42.725257"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 16ms (ActiveRecord: 1.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:15:42.732519"], ["updated_at", "2017-08-03 16:15:42.732519"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$K4Mah3nei5K9evia/6hXnufXen4PXdFkgW8C3bJNyO2jdMFF8aXmC"], ["access_token", "abc"], ["created_at", "2017-08-03 16:15:42.737418"], ["updated_at", "2017-08-03 16:15:42.737418"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:7yfQ18YRQsdGgG4pxQe2"], ["updated_at", "2017-08-03 16:15:42.738638"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 16:15:42.741579"], ["last_sign_in_at", "2017-08-03 16:15:42.741579"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 16:15:42.742183"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 16:15:42.744300"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 16:16:03.301186"], ["updated_at", "2017-08-03 16:16:03.301186"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$v4dBsx3PQUc1EBP7C2IOiuE6DJ2ZbFaPDbb6pmuT4JCUuTOYDIRTO"], ["created_at", "2017-08-03 16:16:03.494117"], ["updated_at", "2017-08-03 16:16:03.494117"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:rV1FQjHUn2TUJxVVUxhr"], ["updated_at", "2017-08-03 16:16:03.496150"], ["id", 1]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$7fPvUR3RYE0GvEAI6bZ9vehe8IOaw8bOd.bOqgNYhrluMzugSZ1c2"], ["created_at", "2017-08-03 16:16:03.501377"], ["updated_at", "2017-08-03 16:16:03.501377"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:QNvy-mKDsMsyXFfxiwQ7"], ["updated_at", "2017-08-03 16:16:03.502948"], ["id", 2]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$QdiexBs8dYuBha20kV1jfurU712t8OBG1mIJxrTYPENTblz5D.Td2"], ["created_at", "2017-08-03 16:16:03.510140"], ["updated_at", "2017-08-03 16:16:03.510140"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:tVo-yMYLv--NYuqSgmVo"], ["updated_at", "2017-08-03 16:16:03.511495"], ["id", 3]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$jS5w6W6MMe5trcoUkcg8kO9Du3I.Z3DL01n6xHJGjboeiaTkGk602"], ["created_at", "2017-08-03 16:16:03.516352"], ["updated_at", "2017-08-03 16:16:03.516352"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:fs7rXaJ19qJR_jkYhjg8"], ["updated_at", "2017-08-03 16:16:03.517870"], ["id", 4]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:16:03.536064"], ["updated_at", "2017-08-03 16:16:03.536064"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$03BVmWUofENj2Y0xPqeh1OpmoqseW93JMlGP.mQWM7LEepPh4/e5C"], ["access_token", "abc"], ["created_at", "2017-08-03 16:16:03.540353"], ["updated_at", "2017-08-03 16:16:03.540353"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:a_fL3swHfQs6QMQs3bbu"], ["updated_at", "2017-08-03 16:16:03.541727"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.3ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:16:03.559282"], ["updated_at", "2017-08-03 16:16:03.559282"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$L26Rqs/2Cd7MoznSuuaq6OYbIxZlgYb7MAY/7XR8Ff1QG6lk/yj8G"], ["access_token", "abc"], ["created_at", "2017-08-03 16:16:03.563494"], ["updated_at", "2017-08-03 16:16:03.563494"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:xZxuKcQJEoEoDCRCw54B"], ["updated_at", "2017-08-03 16:16:03.564796"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 1.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 12ms (Views: 0.8ms | ActiveRecord: 2.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
  [1m[35m (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:16:04.180683"], ["updated_at", "2017-08-03 16:16:04.180683"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$6d/r5noNwxuG5YKQ39LUQO3yRXkAzlnQrWBrg488sIXgnn9bZXwZS"], ["access_token", "abc"], ["created_at", "2017-08-03 16:16:04.185639"], ["updated_at", "2017-08-03 16:16:04.185639"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:gSe_WGYo5RbrWN_K1Kap"], ["updated_at", "2017-08-03 16:16:04.187191"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:16:04.217271"], ["updated_at", "2017-08-03 16:16:04.217271"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$ATNSqE5JuVLXQdkze5Fafe2RN4EXrvDpA.2pJQphVq2xsEc6LLdyG"], ["access_token", "abc"], ["created_at", "2017-08-03 16:16:04.221642"], ["updated_at", "2017-08-03 16:16:04.221642"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:8N58Unzv_LzoywCPYxiZ"], ["updated_at", "2017-08-03 16:16:04.222780"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:16:04.228580"], ["updated_at", "2017-08-03 16:16:04.228580"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$S5pZsm0f2aR99UyHixObOeP52G5yYBYIyUPb.aoUPIewITW84MgUG"], ["access_token", "abc"], ["created_at", "2017-08-03 16:16:04.232824"], ["updated_at", "2017-08-03 16:16:04.232824"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:SBDrsxy2WxdxkmLmyoNn"], ["updated_at", "2017-08-03 16:16:04.234037"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 16:16:04.248598"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 14ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:16:04.255327"], ["updated_at", "2017-08-03 16:16:04.255327"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$y19sW9PGDQYxrNG2UDzkNOZeCc9t7MOCd7vwczm3qYHR7u67JH0h."], ["access_token", "abc"], ["created_at", "2017-08-03 16:16:04.259297"], ["updated_at", "2017-08-03 16:16:04.259297"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:v5U_SSog5k-vj46dfn5L"], ["updated_at", "2017-08-03 16:16:04.260492"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 16:16:04.263534"], ["last_sign_in_at", "2017-08-03 16:16:04.263534"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 16:16:04.264221"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 16:16:04.265894"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-03 16:18:35.254358"], ["updated_at", "2017-08-03 16:18:35.254358"]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$lGIHUoU60UWvXl9AgtGeXuUzUWMjuplaKw5wwNEIQNtVweKuVPNpG"], ["created_at", "2017-08-03 16:18:35.449564"], ["updated_at", "2017-08-03 16:18:35.449564"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:F86nPfZY16fq7Ttzyz3y"], ["updated_at", "2017-08-03 16:18:35.451159"], ["id", 1]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$t2r8i3XNjvs.FWU6SNrJYuEL0zeNmgqYpSYA1oKzLD8lIHRUGvrFK"], ["created_at", "2017-08-03 16:18:35.457743"], ["updated_at", "2017-08-03 16:18:35.457743"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:htX4cJBQaxrLAQPNTYZ9"], ["updated_at", "2017-08-03 16:18:35.459273"], ["id", 2]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$N.oDumZ12ONDVY5nmU4BmuWDJf0JR0hBED59FB8ru2J/hkSGxdYdW"], ["created_at", "2017-08-03 16:18:35.465907"], ["updated_at", "2017-08-03 16:18:35.465907"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:w9oiVoxzvtMuZQiMAxqd"], ["updated_at", "2017-08-03 16:18:35.467068"], ["id", 3]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$HkJyZZlS8VNjehfLG1rYl.RpSTK9Hv4naIvVt5nOk7IvAUjfsuFaS"], ["created_at", "2017-08-03 16:18:35.471227"], ["updated_at", "2017-08-03 16:18:35.471227"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:XsZtwCxCNj5xY88fBM2V"], ["updated_at", "2017-08-03 16:18:35.472866"], ["id", 4]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.7ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:18:35.494342"], ["updated_at", "2017-08-03 16:18:35.494342"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$z2flkKMh/2EVz1pW3FUSt.W.R5eTWcB6xlkKcOTCO7WbQdragzup2"], ["access_token", "abc"], ["created_at", "2017-08-03 16:18:35.498962"], ["updated_at", "2017-08-03 16:18:35.498962"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:dQN8gFZ87gt1XX17ksvt"], ["updated_at", "2017-08-03 16:18:35.500370"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:18:35.516676"], ["updated_at", "2017-08-03 16:18:35.516676"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$Z4Ki691CHfglUaWoBldWOOUEqHO2LsZ6/B7/gzLaUdi1qaODGvVUu"], ["access_token", "abc"], ["created_at", "2017-08-03 16:18:35.520868"], ["updated_at", "2017-08-03 16:18:35.520868"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:ZQ-srK5ffadRqcR3mTr1"], ["updated_at", "2017-08-03 16:18:35.522621"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
  [1m[35m (1.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:18:36.063979"], ["updated_at", "2017-08-03 16:18:36.063979"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$Bw80pujSR9Nt26.Dg2tCbeB4GpejDlKjhXU2ec4tinqM7Ox2OOLTe"], ["access_token", "abc"], ["created_at", "2017-08-03 16:18:36.069829"], ["updated_at", "2017-08-03 16:18:36.069829"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:zGDy4ux1maeTfXdApmSs"], ["updated_at", "2017-08-03 16:18:36.071927"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:18:36.101663"], ["updated_at", "2017-08-03 16:18:36.101663"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$ZBoDV0daaxbwE7njsAsl7ue/rQXGF2VFSxSmpyXNG3InH/eovel36"], ["access_token", "abc"], ["created_at", "2017-08-03 16:18:36.106348"], ["updated_at", "2017-08-03 16:18:36.106348"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:1mx9KiHjVjPo6dgzf_29"], ["updated_at", "2017-08-03 16:18:36.107845"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:18:36.113354"], ["updated_at", "2017-08-03 16:18:36.113354"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$EGA7DcS.XNJ8y0EAwYUm9OuRoeIi/zgXbRXPCzsU2Gh.XjIel/YmS"], ["access_token", "abc"], ["created_at", "2017-08-03 16:18:36.117074"], ["updated_at", "2017-08-03 16:18:36.117074"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:xy6v1iyMPoS5kEGJ6zSy"], ["updated_at", "2017-08-03 16:18:36.118204"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-03 16:18:36.133841"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 16ms (ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-03 16:18:36.140900"], ["updated_at", "2017-08-03 16:18:36.140900"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$CN3d270pwF/8AbWlF48lseMRc1JnhdyYEf42adxjJUe.pnTZNkfSW"], ["access_token", "abc"], ["created_at", "2017-08-03 16:18:36.145420"], ["updated_at", "2017-08-03 16:18:36.145420"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:WyBQZurENkUvRwcJ46BE"], ["updated_at", "2017-08-03 16:18:36.146713"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-03 16:18:36.149950"], ["last_sign_in_at", "2017-08-03 16:18:36.149950"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-03 16:18:36.150622"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-03 16:18:36.152289"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.5ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 17:32:04.729494"], ["updated_at", "2017-08-05 17:32:04.729494"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.5ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$Dudp5eV9V6dHg23sm/V7xuKhMASUleNi/unnJBaY5fUt2XtgaNxUS"], ["created_at", "2017-08-05 17:32:04.929889"], ["updated_at", "2017-08-05 17:32:04.929889"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:p2xGNKcmh4iQFf-8z2-s"], ["updated_at", "2017-08-05 17:32:04.931534"], ["id", 1]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$AgXBW2qapBWv1YKaboKSZ.CvSehwSAotCCQtA0yJ1MMGhZgjU8GDi"], ["created_at", "2017-08-05 17:32:04.936677"], ["updated_at", "2017-08-05 17:32:04.936677"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:E6B1XWZwpiTcPAn3QuoF"], ["updated_at", "2017-08-05 17:32:04.937938"], ["id", 2]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$5AfdQpG6ttpPwKdKyyQzDOXEQJ7498Zfl0ssQFiILPnGEzzR6MrIC"], ["created_at", "2017-08-05 17:32:04.944976"], ["updated_at", "2017-08-05 17:32:04.944976"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:AHEyTzEfyuemyQqyFB-R"], ["updated_at", "2017-08-05 17:32:04.946219"], ["id", 3]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$ZTWjBrBqIImLvE.W3cNO5e9xAUbxbhKEQB3bRuyLRMJ2bXmIj6Ivq"], ["created_at", "2017-08-05 17:32:04.950600"], ["updated_at", "2017-08-05 17:32:04.950600"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:464c_nvPxhuMtqnigGA7"], ["updated_at", "2017-08-05 17:32:04.951847"], ["id", 4]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.7ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:32:04.977281"], ["updated_at", "2017-08-05 17:32:04.977281"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$pqgAfCdAonBJz7.YFY9muO0Ti1AQ41ofCCTsM4miDLM5emqO9qPgi"], ["access_token", "abc"], ["created_at", "2017-08-05 17:32:04.981588"], ["updated_at", "2017-08-05 17:32:04.981588"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:YjsqAKQLx-vvjh87TE1a"], ["updated_at", "2017-08-05 17:32:04.982865"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:32:04.999150"], ["updated_at", "2017-08-05 17:32:04.999150"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$ApmrzoqS4IuQXjB12wtCZuDzEWWfV9JoMHpCZHFhQqi6PqM5jhjCq"], ["access_token", "abc"], ["created_at", "2017-08-05 17:32:05.003239"], ["updated_at", "2017-08-05 17:32:05.003239"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:MJoj1MeLkHkWhwrBovrB"], ["updated_at", "2017-08-05 17:32:05.004706"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.7ms | ActiveRecord: 1.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.9ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:32:05.527496"], ["updated_at", "2017-08-05 17:32:05.527496"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$pXR1AlI/ewfzzUhi6UwTXeEd8kVQ5UPXRN19hgWPevRQLV9HGriK."], ["access_token", "abc"], ["created_at", "2017-08-05 17:32:05.532829"], ["updated_at", "2017-08-05 17:32:05.532829"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:DAGhtgpPmCtzUmWyaAQe"], ["updated_at", "2017-08-05 17:32:05.535056"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:32:05.561331"], ["updated_at", "2017-08-05 17:32:05.561331"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$RhLELNbL2ydHULg45S1Wfuk4KYm1RHc09WOJzi3S3ysIS9vOqSTt2"], ["access_token", "abc"], ["created_at", "2017-08-05 17:32:05.565138"], ["updated_at", "2017-08-05 17:32:05.565138"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:3WJPQzzxjeS-9KzYu8Gb"], ["updated_at", "2017-08-05 17:32:05.566310"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:32:05.571816"], ["updated_at", "2017-08-05 17:32:05.571816"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$pLt4MU3aH5AizP.v/kX6quD/.phrq0ZR6HcoEdhP7VMw9fWZx4r3K"], ["access_token", "abc"], ["created_at", "2017-08-05 17:32:05.576647"], ["updated_at", "2017-08-05 17:32:05.576647"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:6N_HHCTB5uc5Mx15HggH"], ["updated_at", "2017-08-05 17:32:05.578119"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 17:32:05.592343"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 14ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:32:05.598136"], ["updated_at", "2017-08-05 17:32:05.598136"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$Z5twLIPOYF5SIQawgpM95eH88pkX2S8gvqMj/eDxgHbDJwKNsV.xC"], ["access_token", "abc"], ["created_at", "2017-08-05 17:32:05.602028"], ["updated_at", "2017-08-05 17:32:05.602028"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:SJJcH-25ZazasXGF6Ssr"], ["updated_at", "2017-08-05 17:32:05.603317"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 17:32:05.606078"], ["last_sign_in_at", "2017-08-05 17:32:05.606078"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 17:32:05.606665"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 17:32:05.608829"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.6ms | ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 17:33:17.247373"], ["updated_at", "2017-08-05 17:33:17.247373"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$1XiJtdZHj.g3R7pcGvkv8OGsseW1X6zDsymOIaH6kVHaZNTFIgcgW"], ["created_at", "2017-08-05 17:33:17.453922"], ["updated_at", "2017-08-05 17:33:17.453922"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:nEFiri19CBgSg3ssKZdj"], ["updated_at", "2017-08-05 17:33:17.455673"], ["id", 1]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$wxYafrJzP.8PQ1y7a9j3YOVgEFv84eLt3vtb.8Mai4jkAgGhgp.Hy"], ["created_at", "2017-08-05 17:33:17.460852"], ["updated_at", "2017-08-05 17:33:17.460852"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:KR-eeyq6fchjZr7qDSCi"], ["updated_at", "2017-08-05 17:33:17.462029"], ["id", 2]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (1.4ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$BuSjv0ngnbf.1rtGx4zEJOiV09e1I4ZNE9TNgydShB2/DdRBPIPY2"], ["created_at", "2017-08-05 17:33:17.470281"], ["updated_at", "2017-08-05 17:33:17.470281"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:LUmFZqf48Y3w5xNCqoLj"], ["updated_at", "2017-08-05 17:33:17.471827"], ["id", 3]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$awXOgFgnIPPj7fJd81yb6.royXx47fIW/KsVt1SC9VGT5rJcP4Op6"], ["created_at", "2017-08-05 17:33:17.476526"], ["updated_at", "2017-08-05 17:33:17.476526"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:2HWs58QfoRqz5i1N-xj6"], ["updated_at", "2017-08-05 17:33:17.480138"], ["id", 4]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:33:17.500987"], ["updated_at", "2017-08-05 17:33:17.500987"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$v3G9LHiTTMy8xTckEuKRc.9Jny3JlEvXvEHWWfR6Uf0.Rembc3G7G"], ["access_token", "abc"], ["created_at", "2017-08-05 17:33:17.505185"], ["updated_at", "2017-08-05 17:33:17.505185"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:Dn3giC2R_51jrykW_Tq9"], ["updated_at", "2017-08-05 17:33:17.506496"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:33:17.522190"], ["updated_at", "2017-08-05 17:33:17.522190"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$yB7wByzktlfmp1eVUd8N9ueFEwCb7WZgHwAJFtFS8jSUxbf3s5BPC"], ["access_token", "abc"], ["created_at", "2017-08-05 17:33:17.525991"], ["updated_at", "2017-08-05 17:33:17.525991"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:wh8g7PEiJn-w4qKMznSR"], ["updated_at", "2017-08-05 17:33:17.528130"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.9ms | ActiveRecord: 1.5ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.5ms | ActiveRecord: 0.7ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:33:18.033409"], ["updated_at", "2017-08-05 17:33:18.033409"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$T/KwdjeR1JcIyMgVvkBvqOAeMHQiYAW7MPN2vJf4ndbN55W.eLcze"], ["access_token", "abc"], ["created_at", "2017-08-05 17:33:18.038726"], ["updated_at", "2017-08-05 17:33:18.038726"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:ucEAMpyEAbnZVQvx2ei4"], ["updated_at", "2017-08-05 17:33:18.040473"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:33:18.069209"], ["updated_at", "2017-08-05 17:33:18.069209"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$FmUGXMqCX5vvQf.JpR3yuO8UryPCa4hnBczEegOERcIt3A1VphNyi"], ["access_token", "abc"], ["created_at", "2017-08-05 17:33:18.073426"], ["updated_at", "2017-08-05 17:33:18.073426"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:KGryKuZ3syKkqkyYLuW1"], ["updated_at", "2017-08-05 17:33:18.074834"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:33:18.080993"], ["updated_at", "2017-08-05 17:33:18.080993"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$izEGcx/GRCz1fa79H7OFZe6/YkbhwejRvL2xo2zUl2gGucvHejtoC"], ["access_token", "abc"], ["created_at", "2017-08-05 17:33:18.085577"], ["updated_at", "2017-08-05 17:33:18.085577"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:iTfBicqDRXi-TYzHqmeR"], ["updated_at", "2017-08-05 17:33:18.087339"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 17:33:18.102566"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 15ms (ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:33:18.109770"], ["updated_at", "2017-08-05 17:33:18.109770"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$IAbg8QE5NRFEjzVfNn9jMO510JCG7fHXZJ.679d2L90U2Oiqg442m"], ["access_token", "abc"], ["created_at", "2017-08-05 17:33:18.113650"], ["updated_at", "2017-08-05 17:33:18.113650"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:iqhP3sL_TXs3FB6rMKWa"], ["updated_at", "2017-08-05 17:33:18.114892"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 17:33:18.118148"], ["last_sign_in_at", "2017-08-05 17:33:18.118148"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 17:33:18.118844"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 17:33:18.121163"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.7ms | ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 17:33:35.264716"], ["updated_at", "2017-08-05 17:33:35.264716"]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$sjxaL7VlCRmdfSYlasEhFea9OtkSRngHBC4p.0k.yU1ICGfENIOw."], ["created_at", "2017-08-05 17:33:35.464094"], ["updated_at", "2017-08-05 17:33:35.464094"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:xiG-bFj5rcRa5ZptbScp"], ["updated_at", "2017-08-05 17:33:35.465647"], ["id", 1]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$DjnQbTSYjAwssnl9yE2qUe/ErAOnvEPR.PFQRMYXu2d4hIHXybSky"], ["created_at", "2017-08-05 17:33:35.470288"], ["updated_at", "2017-08-05 17:33:35.470288"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:TYXvQMbK8yaEG8wNumFD"], ["updated_at", "2017-08-05 17:33:35.471423"], ["id", 2]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$v2CswPuIWcLldzAWZG72hOVAFirWY9CmbyRiFWGqa3IbRwf9C8jPy"], ["created_at", "2017-08-05 17:33:35.478546"], ["updated_at", "2017-08-05 17:33:35.478546"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:oaxpkKE2mcHxSzRqC1h1"], ["updated_at", "2017-08-05 17:33:35.479816"], ["id", 3]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$Lix.t271iKAuh8XTAO91t.dM0sfCCXKw/01E.WGVwQSbL5AuuX/HO"], ["created_at", "2017-08-05 17:33:35.483780"], ["updated_at", "2017-08-05 17:33:35.483780"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:FwrQvx4Wrxax6ikBsf-g"], ["updated_at", "2017-08-05 17:33:35.485117"], ["id", 4]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:33:35.544104"], ["updated_at", "2017-08-05 17:33:35.544104"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$IkDLmkikSGybOHIt0UpAiuFYzs1dBmbqhom1NJ6w2JMGqo0V9TFue"], ["access_token", "abc"], ["created_at", "2017-08-05 17:33:35.548332"], ["updated_at", "2017-08-05 17:33:35.548332"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:qFPnEFFznbmzMtyrKu81"], ["updated_at", "2017-08-05 17:33:35.549702"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:33:35.572206"], ["updated_at", "2017-08-05 17:33:35.572206"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$59tix2qQApbqcSHL8s60HeI1RHQPx0JPQvEEImgn5lTzUwGcOAJL6"], ["access_token", "abc"], ["created_at", "2017-08-05 17:33:35.575973"], ["updated_at", "2017-08-05 17:33:35.575973"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:uexx5x3CPjcFU9vfvGME"], ["updated_at", "2017-08-05 17:33:35.577376"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 1.0ms | ActiveRecord: 1.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 1.0ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.8ms | ActiveRecord: 2.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.7ms | ActiveRecord: 1.0ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:33:36.095888"], ["updated_at", "2017-08-05 17:33:36.095888"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$e5ONi.Cf5gRDX64/.Ep89ugFjBGvtNx4OlBaOPEOsj2LWW67lIOUS"], ["access_token", "abc"], ["created_at", "2017-08-05 17:33:36.102113"], ["updated_at", "2017-08-05 17:33:36.102113"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:xd8oJE8Bnki-CWixRHsM"], ["updated_at", "2017-08-05 17:33:36.103956"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:33:36.123570"], ["updated_at", "2017-08-05 17:33:36.123570"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$rf7aEMtF25IaeITj8zCxP.c7cPSfJlh9uTSB87gM6JUobZv8BU.sq"], ["access_token", "abc"], ["created_at", "2017-08-05 17:33:36.127527"], ["updated_at", "2017-08-05 17:33:36.127527"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:TVbGBmoFVgH8J7sqRqgE"], ["updated_at", "2017-08-05 17:33:36.129065"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:33:36.135294"], ["updated_at", "2017-08-05 17:33:36.135294"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$mdGNuWB6Q.VgY3HUFtuLvu4qnEf7GOdkBcfjm/ibj3o6qWPDFf1pS"], ["access_token", "abc"], ["created_at", "2017-08-05 17:33:36.139279"], ["updated_at", "2017-08-05 17:33:36.139279"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:pb4n_NESp_dufSHv7-3W"], ["updated_at", "2017-08-05 17:33:36.140565"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 17:33:36.156835"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 17ms (ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:33:36.164278"], ["updated_at", "2017-08-05 17:33:36.164278"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$8goMMokY0QLovI0bKHGEWutaHL8OQBj8/4WUZUE357kHKtzhHRRmC"], ["access_token", "abc"], ["created_at", "2017-08-05 17:33:36.167973"], ["updated_at", "2017-08-05 17:33:36.167973"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:8NaGHw2LM122ppv9RrNy"], ["updated_at", "2017-08-05 17:33:36.169130"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 17:33:36.171700"], ["last_sign_in_at", "2017-08-05 17:33:36.171700"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 17:33:36.172280"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 17:33:36.174298"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 17:36:19.966319"], ["updated_at", "2017-08-05 17:36:19.966319"]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 17:36:38.847354"], ["updated_at", "2017-08-05 17:36:38.847354"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.1ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$lJ7SQP83fYLIKRJrQszsveioYi5P2ItsiCfWRCUjTgtC7FspKP5Kq"], ["created_at", "2017-08-05 17:36:39.037913"], ["updated_at", "2017-08-05 17:36:39.037913"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:fVe7WJ9yuXEcBB3zJppZ"], ["updated_at", "2017-08-05 17:36:39.039587"], ["id", 1]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$Y.olLWKbOdTklNSqmgdO1ef1wE7jyzhhPJ92AIzUayhGEJVdXEJZ6"], ["created_at", "2017-08-05 17:36:39.044751"], ["updated_at", "2017-08-05 17:36:39.044751"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:sfgaJ82xneuS_es8vDgS"], ["updated_at", "2017-08-05 17:36:39.046066"], ["id", 2]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.7ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$b8X./h.u.lktAF6UghQAQeSsnlaLqojojKsEthP/EP9iSWdvNh1Ki"], ["created_at", "2017-08-05 17:36:39.052839"], ["updated_at", "2017-08-05 17:36:39.052839"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:KLAtGcE1UbcEeYVhm6Wx"], ["updated_at", "2017-08-05 17:36:39.054041"], ["id", 3]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$JMkfvTs5y8GNr5KIkK/.d.1d/JQLUCICyHzlZ5YFkL7QlibVvRK8K"], ["created_at", "2017-08-05 17:36:39.058283"], ["updated_at", "2017-08-05 17:36:39.058283"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:kPeAE9k9_CV3N-GLoAsP"], ["updated_at", "2017-08-05 17:36:39.059399"], ["id", 4]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:36:39.141427"], ["updated_at", "2017-08-05 17:36:39.141427"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$x2sJvxwaiAVH2/mQeM7kDOsUoz6oPKxDXeiiK8KMcrnYUXDSqL7CW"], ["access_token", "abc"], ["created_at", "2017-08-05 17:36:39.148161"], ["updated_at", "2017-08-05 17:36:39.148161"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:NMMmsk8F8jszKmuwrNQ-"], ["updated_at", "2017-08-05 17:36:39.149420"], ["id", 5]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.3ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (2.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:36:39.197522"], ["updated_at", "2017-08-05 17:36:39.197522"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$2AvubEIC6RCm/t9c9CDGS.H3WPVrs.FwoYw9pJESgd2KlSkzrEBPu"], ["access_token", "abc"], ["created_at", "2017-08-05 17:36:39.204944"], ["updated_at", "2017-08-05 17:36:39.204944"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:hBUoGsSviKmXCusExV1d"], ["updated_at", "2017-08-05 17:36:39.208452"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.7ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:36:39.729231"], ["updated_at", "2017-08-05 17:36:39.729231"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$QIwcuvjdeWlUnKnHQZ12L.PRv1xQiUoKymZUhzHYLe65d1WUBt.9C"], ["access_token", "abc"], ["created_at", "2017-08-05 17:36:39.733817"], ["updated_at", "2017-08-05 17:36:39.733817"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:u1uNyM4MP1Yz1Wcmz9Tw"], ["updated_at", "2017-08-05 17:36:39.735747"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:36:39.755724"], ["updated_at", "2017-08-05 17:36:39.755724"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$HI4UTWA0LpIqTsi9SM1F8O4LKjyeUhNQUbhIgm0RCzIW0kTWmzDcG"], ["access_token", "abc"], ["created_at", "2017-08-05 17:36:39.759493"], ["updated_at", "2017-08-05 17:36:39.759493"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:yUyJAG9iH3XvD_LtCBYj"], ["updated_at", "2017-08-05 17:36:39.760793"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:36:39.768218"], ["updated_at", "2017-08-05 17:36:39.768218"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$0xNJFvL4dVeSSAdWF/lpleZbMM9NlZW68xdcwuapUZ6.JEmn9Q1ve"], ["access_token", "abc"], ["created_at", "2017-08-05 17:36:39.773673"], ["updated_at", "2017-08-05 17:36:39.773673"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:_eZa5fVzrQB5GJKxeysC"], ["updated_at", "2017-08-05 17:36:39.775412"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 17:36:39.793354"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 17ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:36:39.799036"], ["updated_at", "2017-08-05 17:36:39.799036"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.7ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$147.fWQ/wyhP/WbkAiaureL4pziaibt2GaIq0qlX7ARDZlqtjvxgK"], ["access_token", "abc"], ["created_at", "2017-08-05 17:36:39.808166"], ["updated_at", "2017-08-05 17:36:39.808166"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:6mNQjhVFcR7xyo4yJnkB"], ["updated_at", "2017-08-05 17:36:39.811554"], ["id", 5]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 17:36:39.817876"], ["last_sign_in_at", "2017-08-05 17:36:39.817876"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 17:36:39.819273"], ["id", 5]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 17:36:39.824961"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 17ms (Views: 0.7ms | ActiveRecord: 1.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 17:37:14.614751"], ["updated_at", "2017-08-05 17:37:14.614751"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.3ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.7ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$tMkpm2bvXm8p34um37RI9ubKCoIPvwQ9ei8VvMi9r21lIS2wrNE8C"], ["created_at", "2017-08-05 17:37:57.303533"], ["updated_at", "2017-08-05 17:37:57.303533"], ["kit_access_token", "something"]]
  [1m[35mSQL (1.4ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:Bswn3__NZaGBbxo8L-Cv"], ["updated_at", "2017-08-05 17:37:57.317787"], ["id", 1]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$yCMOup02ZaHItX.lL2sIk.wcDLOhbJaTss9RX4xVKlh0iLgjFUT2a"], ["created_at", "2017-08-05 17:37:57.371900"], ["updated_at", "2017-08-05 17:37:57.371900"]]
  [1m[35mSQL (0.5ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:txoW-sAwRka8r-1suegm"], ["updated_at", "2017-08-05 17:37:57.382492"], ["id", 2]]
  [1m[35m (1.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (1.1ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$5Z8biF6JB1TKKwFAQYSchOtQTacUWg03mLEbuw2JHmCkcY79ZF832"], ["created_at", "2017-08-05 17:37:57.414981"], ["updated_at", "2017-08-05 17:37:57.414981"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:py5Sm7yyuz7oMR17Nhbf"], ["updated_at", "2017-08-05 17:37:57.433487"], ["id", 3]]
  [1m[35m (1.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.7ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.9ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$IcHU5QXYnBgkah/GQSDiJuKLFJI84rQ5BCsQfdZBAi/BX09ehUIYa"], ["created_at", "2017-08-05 17:37:57.461568"], ["updated_at", "2017-08-05 17:37:57.461568"]]
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:YjyZF9ySgKwzvbCR_ddW"], ["updated_at", "2017-08-05 17:37:57.477977"], ["id", 4]]
  [1m[35m (1.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (1.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:37:57.598553"], ["updated_at", "2017-08-05 17:37:57.598553"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (2.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$V5dDrlMDh01yNU9cFhjZ8OBSVX8OLsEJziMgt.woT15Xcpdm7ut16"], ["access_token", "abc"], ["created_at", "2017-08-05 17:37:57.619684"], ["updated_at", "2017-08-05 17:37:57.619684"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:6UycxoncYFFxMai-cVBo"], ["updated_at", "2017-08-05 17:37:57.649574"], ["id", 5]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 14ms (Views: 0.9ms | ActiveRecord: 0.7ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (1.5ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:37:57.700544"], ["updated_at", "2017-08-05 17:37:57.700544"]]
  [1m[35m (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (1.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$/IpfAnJLyCdQohYzMrHSueT/1dFYihtJF.QRwarCfLI.Bl1YA1vYG"], ["access_token", "abc"], ["created_at", "2017-08-05 17:37:57.729977"], ["updated_at", "2017-08-05 17:37:57.729977"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:FwTJT9C6RnGetewuvcQq"], ["updated_at", "2017-08-05 17:37:57.756382"], ["id", 5]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 10ms (Views: 1.0ms | ActiveRecord: 1.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.4ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 17ms (Views: 1.5ms | ActiveRecord: 2.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 14ms (Views: 2.1ms | ActiveRecord: 2.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 11ms (Views: 1.0ms | ActiveRecord: 1.5ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 12ms (Views: 1.2ms | ActiveRecord: 1.6ms)
  [1m[35m (1.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:37:58.408082"], ["updated_at", "2017-08-05 17:37:58.408082"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (1.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$FzAPFugYzoCLrb/uIHHsb.iPPV1mDDzcGNHoSIKAY.wydTRUyMQFO"], ["access_token", "abc"], ["created_at", "2017-08-05 17:37:58.441055"], ["updated_at", "2017-08-05 17:37:58.441055"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:NJGycFb25sEy3rESMAiC"], ["updated_at", "2017-08-05 17:37:58.455223"], ["id", 5]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.8ms | ActiveRecord: 0.4ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:37:58.510780"], ["updated_at", "2017-08-05 17:37:58.510780"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (2.0ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$Kcx/qa1aGUsWn1Eu51TEteRxhpLC8U7Fzy6AIa.sA/zl4yOEoxV4e"], ["access_token", "abc"], ["created_at", "2017-08-05 17:37:58.537506"], ["updated_at", "2017-08-05 17:37:58.537506"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:bVavCuq-sjbfJSL5YDuM"], ["updated_at", "2017-08-05 17:37:58.562642"], ["id", 5]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.8ms | ActiveRecord: 0.3ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:37:58.596984"], ["updated_at", "2017-08-05 17:37:58.596984"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$KOZvMmakuOWyk6Ss2n/vHu18DhB3H2lPTXF8YvjidG1LHGlejqThy"], ["access_token", "abc"], ["created_at", "2017-08-05 17:37:58.616688"], ["updated_at", "2017-08-05 17:37:58.616688"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (1.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:zYvMRJVgcDoq7Ee_9Ei4"], ["updated_at", "2017-08-05 17:37:58.638611"], ["id", 5]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.5ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 17:37:58.701362"], ["id", 5]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 51ms (ActiveRecord: 2.2ms)
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:37:58.737059"], ["updated_at", "2017-08-05 17:37:58.737059"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$b5/pZKkNfwuRrStnYSYE1u0WXc1T5o85MItjIOvao5ZfD90ZSW5Nm"], ["access_token", "abc"], ["created_at", "2017-08-05 17:37:58.753605"], ["updated_at", "2017-08-05 17:37:58.753605"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:3TtdF6c8eHemnCfLkmnx"], ["updated_at", "2017-08-05 17:37:58.768355"], ["id", 5]]
  [1m[35m (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 17:37:58.805466"], ["last_sign_in_at", "2017-08-05 17:37:58.805466"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 17:37:58.808540"], ["id", 5]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 17:37:58.826518"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 51ms (Views: 3.4ms | ActiveRecord: 2.8ms)
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 17:39:13.978520"], ["updated_at", "2017-08-05 17:39:13.978520"]]
  [1m[35m (1.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.5ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$3Qo6IBThIQaqMrwB570bUO.Key2aLBab3QvUqb6.UMdtFhUV6PUca"], ["created_at", "2017-08-05 17:39:14.142316"], ["updated_at", "2017-08-05 17:39:14.142316"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:bus2LoeoWbVzyfQxy4QZ"], ["updated_at", "2017-08-05 17:39:14.143973"], ["id", 1]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$qzHSeSyvTso6fBdOzd/2uOVtCPhb3I.mFPxWlEwAdrdXSosrj/D5G"], ["created_at", "2017-08-05 17:39:14.148915"], ["updated_at", "2017-08-05 17:39:14.148915"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:Tfn_WQz1jzZUPhMGSsbt"], ["updated_at", "2017-08-05 17:39:14.150130"], ["id", 2]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$21RlMSw.RH7XYfoNl7ShaeuG8F28DMof1.qFdskFchypitR9aO.HW"], ["created_at", "2017-08-05 17:39:14.157688"], ["updated_at", "2017-08-05 17:39:14.157688"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:U8qGT2ZDohrCJscVgERY"], ["updated_at", "2017-08-05 17:39:14.158912"], ["id", 3]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$KT4FPHDgLlfuVW8iCAMf7OjV2fLcYSnsiqyzBL9B5tYiyzvYVp8M2"], ["created_at", "2017-08-05 17:39:14.162937"], ["updated_at", "2017-08-05 17:39:14.162937"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:gUKztWaPjPS-YX9sKesC"], ["updated_at", "2017-08-05 17:39:14.164278"], ["id", 4]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:39:14.250485"], ["updated_at", "2017-08-05 17:39:14.250485"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$l7tD.dwhqrAyqkA/omfLxeIrfG.Y4BZE0.wSU5BKfsSlnDj4sKe2y"], ["access_token", "abc"], ["created_at", "2017-08-05 17:39:14.260546"], ["updated_at", "2017-08-05 17:39:14.260546"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:Sn5prDmun3TzG73gUHy5"], ["updated_at", "2017-08-05 17:39:14.264204"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:39:14.288549"], ["updated_at", "2017-08-05 17:39:14.288549"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$61oG6PyXCfxNuiMYo.gWcOaRtWuQpZ9bSVZlOCenRZlSUayNgG7Se"], ["access_token", "abc"], ["created_at", "2017-08-05 17:39:14.292771"], ["updated_at", "2017-08-05 17:39:14.292771"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:waFNGQ6khGhaDkYCx4sA"], ["updated_at", "2017-08-05 17:39:14.294064"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 1.0ms)
  [1m[35m (1.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:39:14.842974"], ["updated_at", "2017-08-05 17:39:14.842974"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$ZquHcdcFQz/kTB5GvxVLTeA2H4fBeR5U.rE6tJV/5ARpDx1oMI/eC"], ["access_token", "abc"], ["created_at", "2017-08-05 17:39:14.848150"], ["updated_at", "2017-08-05 17:39:14.848150"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:o6QQE5e9G9tcMmw8WxNW"], ["updated_at", "2017-08-05 17:39:14.849704"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:39:14.870420"], ["updated_at", "2017-08-05 17:39:14.870420"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$7KNSYmwHjn5nlQFp3b/Wj.UzvQpT39rGMF0kkr8zR/vbTJ7jAp72S"], ["access_token", "abc"], ["created_at", "2017-08-05 17:39:14.874812"], ["updated_at", "2017-08-05 17:39:14.874812"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:u6PTssnYsShqdsddYQVQ"], ["updated_at", "2017-08-05 17:39:14.876081"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:39:14.881164"], ["updated_at", "2017-08-05 17:39:14.881164"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$tBLWu1N5pEC1lltcr6ousuwwsY9I93uDpkcHEsWW.2unvA8dK/Ahm"], ["access_token", "abc"], ["created_at", "2017-08-05 17:39:14.884940"], ["updated_at", "2017-08-05 17:39:14.884940"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:7w1PMVU8SGBF7Fdf36bP"], ["updated_at", "2017-08-05 17:39:14.887974"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 17:39:14.912253"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 26ms (ActiveRecord: 1.5ms)
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:39:14.928345"], ["updated_at", "2017-08-05 17:39:14.928345"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$Sge1JX75rXKbvu7w3B0fQ.DQfePWii9mpRgFuh/JrAsqutui/6KgK"], ["access_token", "abc"], ["created_at", "2017-08-05 17:39:14.934743"], ["updated_at", "2017-08-05 17:39:14.934743"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:GyhX13T99dSzczePHxsW"], ["updated_at", "2017-08-05 17:39:14.936284"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 17:39:14.940314"], ["last_sign_in_at", "2017-08-05 17:39:14.940314"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 17:39:14.941181"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 17:39:14.943619"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 13ms (Views: 0.6ms | ActiveRecord: 0.8ms)
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (1.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 17:44:40.384216"], ["updated_at", "2017-08-05 17:44:40.384216"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$bW0V4CQmNTq5shHghv8ZSOdxEoReIFMiKP4XZCn..tXwnfgSil75G"], ["created_at", "2017-08-05 17:44:40.531224"], ["updated_at", "2017-08-05 17:44:40.531224"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:cZdBRRpRroc-Wxy93z7N"], ["updated_at", "2017-08-05 17:44:40.535444"], ["id", 1]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$Wvzi09BpmPv/SXp2Jt0Gs.jKzJE2wREZ1LGIRgS7ZGZUioNYe9t0C"], ["created_at", "2017-08-05 17:44:40.541473"], ["updated_at", "2017-08-05 17:44:40.541473"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:8FFKdesFKEsurJHAyRaL"], ["updated_at", "2017-08-05 17:44:40.542666"], ["id", 2]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$pRHwGNHNODuNomvhRHK49OTyp.4a.9o9f1uW0OehLI3zd0Sohx6X2"], ["created_at", "2017-08-05 17:44:40.551793"], ["updated_at", "2017-08-05 17:44:40.551793"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:S_ZeUnMgFJuKv4XHjzCZ"], ["updated_at", "2017-08-05 17:44:40.552943"], ["id", 3]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$i71.jfxmERFPxFmcKpwBTeJcOhSTCqjfzpUbb15OHQoQ1oafyDvCm"], ["created_at", "2017-08-05 17:44:40.557112"], ["updated_at", "2017-08-05 17:44:40.557112"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:qCddfxLjRzVvBtP3Gx9f"], ["updated_at", "2017-08-05 17:44:40.558178"], ["id", 4]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:44:42.171719"], ["updated_at", "2017-08-05 17:44:42.171719"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$iq4IBcOXa4K78kwkdymMd.mYPVVHnaSw5/xZzfxd42aXmoiSWy5I6"], ["access_token", "abc"], ["created_at", "2017-08-05 17:44:42.175776"], ["updated_at", "2017-08-05 17:44:42.175776"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:_DeSJ6y316Z4yEwM9gkQ"], ["updated_at", "2017-08-05 17:44:42.177252"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:44:42.193763"], ["updated_at", "2017-08-05 17:44:42.193763"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$7A7GP0f8Jo6UVJywsaU6e.sbyIfgbsr3M0QtnANzJ93PcUDxxLLbK"], ["access_token", "abc"], ["created_at", "2017-08-05 17:44:42.199463"], ["updated_at", "2017-08-05 17:44:42.199463"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:VzvRPmsw7sXKykLxiRbB"], ["updated_at", "2017-08-05 17:44:42.200495"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (1.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.8ms | ActiveRecord: 2.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 1.2ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:44:42.731957"], ["updated_at", "2017-08-05 17:44:42.731957"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$hW75QD4L5ZFBUpQW0R.5V.bU8RpFNl/E7Zz.c8HWkmx.Vu8c6a5g2"], ["access_token", "abc"], ["created_at", "2017-08-05 17:44:42.736610"], ["updated_at", "2017-08-05 17:44:42.736610"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:mEk3vwnsup4y7mmaDweT"], ["updated_at", "2017-08-05 17:44:42.738011"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:44:42.760782"], ["updated_at", "2017-08-05 17:44:42.760782"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$1ZeMGIAO/y1FkaereNj7WuL0qjSemAzmJwHu3DH/qYH0hfYlt3Z0G"], ["access_token", "abc"], ["created_at", "2017-08-05 17:44:42.765293"], ["updated_at", "2017-08-05 17:44:42.765293"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:sHqY8KDM4pUUn2M8g5Vk"], ["updated_at", "2017-08-05 17:44:42.766663"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:44:42.772481"], ["updated_at", "2017-08-05 17:44:42.772481"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$3y6gwx6TKnKUvIPYYBp.Cu6NFDoCjxhBrDaRCBKMntEoSuVP.lGaq"], ["access_token", "abc"], ["created_at", "2017-08-05 17:44:42.776972"], ["updated_at", "2017-08-05 17:44:42.776972"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:RQdzX3xGY7FNqhzNX5Ff"], ["updated_at", "2017-08-05 17:44:42.778412"], ["id", 5]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 17:44:42.798343"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 19ms (ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:44:42.805126"], ["updated_at", "2017-08-05 17:44:42.805126"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$shtXHu4Yt15/B/qoyT5Z4evBrSTDu9dsgsbtwXesbphBmqkBZwsLe"], ["access_token", "abc"], ["created_at", "2017-08-05 17:44:42.808976"], ["updated_at", "2017-08-05 17:44:42.808976"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:de4vMqgZKcLX35qfTnYt"], ["updated_at", "2017-08-05 17:44:42.810183"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 17:44:42.813136"], ["last_sign_in_at", "2017-08-05 17:44:42.813136"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 17:44:42.813765"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 17:44:42.815491"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.7ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 17:51:43.522917"], ["updated_at", "2017-08-05 17:51:43.522917"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.4ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$7.ay9RiCOAeV9OyYftglr.RHMH7aJDBZrUH9GwyjTxIR6MjnQVO7u"], ["created_at", "2017-08-05 17:51:43.677625"], ["updated_at", "2017-08-05 17:51:43.677625"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:tr-xFyijw7zt-Eupvt4g"], ["updated_at", "2017-08-05 17:51:43.682355"], ["id", 1]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$V8RZXXFloaRZBrLhg3ut2ujfUsoAL0.SRieWvGYCKE1o78OScGyiG"], ["created_at", "2017-08-05 17:51:43.690462"], ["updated_at", "2017-08-05 17:51:43.690462"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:48mWxHd3zdqEMuyhyT2L"], ["updated_at", "2017-08-05 17:51:43.694260"], ["id", 2]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$49z5TF9NaXXeMyYRe.Nio.6GTREaqoGTwboA.Epm3EIXLqI7c3uH6"], ["created_at", "2017-08-05 17:51:43.701259"], ["updated_at", "2017-08-05 17:51:43.701259"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:imtdYSes3M14p4zKmjPv"], ["updated_at", "2017-08-05 17:51:43.702529"], ["id", 3]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$QrVa/xH2JcYVR4NhT4K0ZuMLbcdBN4ALvkU3LQ7i7QK46AzfnBlte"], ["created_at", "2017-08-05 17:51:43.707376"], ["updated_at", "2017-08-05 17:51:43.707376"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:r9SWkAcz9JskBGJLHiJ8"], ["updated_at", "2017-08-05 17:51:43.709321"], ["id", 4]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:51:45.711184"], ["updated_at", "2017-08-05 17:51:45.711184"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$TnUnXhBB5P9VYdvIwispPOQHkuROaT3yuyQ4nMDN.zKxxMiNEgXsy"], ["access_token", "abc"], ["created_at", "2017-08-05 17:51:45.715819"], ["updated_at", "2017-08-05 17:51:45.715819"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:WpHBzNBHf_QweKfzyTG_"], ["updated_at", "2017-08-05 17:51:45.717190"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:51:45.737430"], ["updated_at", "2017-08-05 17:51:45.737430"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$rmmcPmtSiTM3N/28W3FHduk67RCHtaIShtmDy49vcWp.dCQAY/ihS"], ["access_token", "abc"], ["created_at", "2017-08-05 17:51:45.741996"], ["updated_at", "2017-08-05 17:51:45.741996"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:779BpUH3BS8PaqrZGGdX"], ["updated_at", "2017-08-05 17:51:45.743229"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:51:46.274735"], ["updated_at", "2017-08-05 17:51:46.274735"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$B3gLzfTbCQ9vUxxbMZKVjO9U.6r93bsq8wb4bMT7BJRQwvrsOXtU6"], ["access_token", "abc"], ["created_at", "2017-08-05 17:51:46.279535"], ["updated_at", "2017-08-05 17:51:46.279535"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:E1v3Mxec4WpHQmLLvyBJ"], ["updated_at", "2017-08-05 17:51:46.281028"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:51:46.304407"], ["updated_at", "2017-08-05 17:51:46.304407"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$.Vr5/05/mN.OmPLoFvQjdemGbt0E3WYNVEQRS3czznkhxErSFHc7C"], ["access_token", "abc"], ["created_at", "2017-08-05 17:51:46.308575"], ["updated_at", "2017-08-05 17:51:46.308575"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:y6Bmu-5GogAViEa1nqka"], ["updated_at", "2017-08-05 17:51:46.309969"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:51:46.315993"], ["updated_at", "2017-08-05 17:51:46.315993"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$.9dr/.P6X6zVkm8IhKVxLOizDWggIZefrKKuQyn6UlCuX8Gug5pvm"], ["access_token", "abc"], ["created_at", "2017-08-05 17:51:46.319891"], ["updated_at", "2017-08-05 17:51:46.319891"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:s2DcdbUMxoMeJZocTGNE"], ["updated_at", "2017-08-05 17:51:46.321075"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 17:51:46.337692"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 16ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:51:46.344363"], ["updated_at", "2017-08-05 17:51:46.344363"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$3KKstS0t4Hms46yIgzI9.O69eHNS/LU/pshd.MwLbdOKYke0nWeiu"], ["access_token", "abc"], ["created_at", "2017-08-05 17:51:46.348144"], ["updated_at", "2017-08-05 17:51:46.348144"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:o5zo_fdFMs5WyKGEcc_6"], ["updated_at", "2017-08-05 17:51:46.349749"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 17:51:46.353022"], ["last_sign_in_at", "2017-08-05 17:51:46.353022"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 17:51:46.353676"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 17:51:46.355622"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 17:54:13.771013"], ["updated_at", "2017-08-05 17:54:13.771013"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.3ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$MqRj5nHmwZnsJKMISPCbT.vCtWcPzFHRgAqenE21qnAAyUfArAtgG"], ["created_at", "2017-08-05 17:54:13.912640"], ["updated_at", "2017-08-05 17:54:13.912640"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:xszj9xq8oqwxXz8-NB12"], ["updated_at", "2017-08-05 17:54:13.914848"], ["id", 1]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$iebJtvbAXtjDNPHOyEBJNOTLcjoG9gslCWs88EU1rPICL3tgfg502"], ["created_at", "2017-08-05 17:54:13.920159"], ["updated_at", "2017-08-05 17:54:13.920159"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:7W2_oUqiFfTb-sRtgHtc"], ["updated_at", "2017-08-05 17:54:13.921402"], ["id", 2]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$hXblIorBzw4uWjwOnGDiheYTcu4dN1CMuQp.vSS/3nauF81JRR.YO"], ["created_at", "2017-08-05 17:54:13.930493"], ["updated_at", "2017-08-05 17:54:13.930493"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:-eV4diSExpAjETmuz9GN"], ["updated_at", "2017-08-05 17:54:13.931657"], ["id", 3]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$w116nJ6SB92YQCNWSJyhLugOEoJP7/xHzm/6CAn8.jF0iSDaXfcuq"], ["created_at", "2017-08-05 17:54:13.936311"], ["updated_at", "2017-08-05 17:54:13.936311"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:LtZJDK-Wv3LpJ3cLq78u"], ["updated_at", "2017-08-05 17:54:13.937534"], ["id", 4]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:54:15.159689"], ["updated_at", "2017-08-05 17:54:15.159689"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$hCR.7JiTP6eumwcYF4Cpoe3DemNbYlbBYNtUL1svRzcwbASpGubwO"], ["access_token", "abc"], ["created_at", "2017-08-05 17:54:15.163919"], ["updated_at", "2017-08-05 17:54:15.163919"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:N8RQW1Tc9TCvV_sxx-iF"], ["updated_at", "2017-08-05 17:54:15.165066"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:54:15.184645"], ["updated_at", "2017-08-05 17:54:15.184645"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$KhY5dqS6i7ZiezN0ephX3.k757oAWAsv4iYVnQhJgZF5GliXppV0S"], ["access_token", "abc"], ["created_at", "2017-08-05 17:54:15.188433"], ["updated_at", "2017-08-05 17:54:15.188433"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:HsSQHZQz8SsPDBPmZv47"], ["updated_at", "2017-08-05 17:54:15.189554"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.6ms | ActiveRecord: 1.3ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 1.5ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:54:15.758218"], ["updated_at", "2017-08-05 17:54:15.758218"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$MD4po7bQnu4CTjZ2gwbZGudC3R1LKWuO8JUfz0//UfNhAEVfu073S"], ["access_token", "abc"], ["created_at", "2017-08-05 17:54:15.762950"], ["updated_at", "2017-08-05 17:54:15.762950"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:RrU8XoXnvQHyz4iMzeGx"], ["updated_at", "2017-08-05 17:54:15.764334"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:54:15.786174"], ["updated_at", "2017-08-05 17:54:15.786174"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$zTxJIq5FPqc1GfUWsSumE.veIhseasvqVSl1N3QTtmySMAPq7CKS6"], ["access_token", "abc"], ["created_at", "2017-08-05 17:54:15.789985"], ["updated_at", "2017-08-05 17:54:15.789985"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:5NpEjE8BMoxSyHtL9wvZ"], ["updated_at", "2017-08-05 17:54:15.791207"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:54:15.796998"], ["updated_at", "2017-08-05 17:54:15.796998"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$wt.3nkca3flNWtvSFBRDGOdWEQHTOOL5g1dwMP9jMPrskV/vkrYsW"], ["access_token", "abc"], ["created_at", "2017-08-05 17:54:15.800991"], ["updated_at", "2017-08-05 17:54:15.800991"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:qUZnYEeWUyz3Nooj2gvW"], ["updated_at", "2017-08-05 17:54:15.802278"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.2ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 17:54:15.819568"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 17ms (ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:54:15.826476"], ["updated_at", "2017-08-05 17:54:15.826476"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$M5z2awWDSiI8fI95daRrwuDDgtIZDFkeySg7uQq6CIILybCf5SPMS"], ["access_token", "abc"], ["created_at", "2017-08-05 17:54:15.831143"], ["updated_at", "2017-08-05 17:54:15.831143"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:GJhuSvdtijwaA7yjiJ2c"], ["updated_at", "2017-08-05 17:54:15.832360"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 17:54:15.835264"], ["last_sign_in_at", "2017-08-05 17:54:15.835264"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 17:54:15.835888"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 17:54:15.837496"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 17:54:59.901208"], ["updated_at", "2017-08-05 17:54:59.901208"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.1ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$3ODPTVApXwzx6u5We.AvQuhe6/Je3a2w5RSFo1YcSkf6Cda0A0viO"], ["created_at", "2017-08-05 17:55:00.043299"], ["updated_at", "2017-08-05 17:55:00.043299"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:u83q5Fv9E1Yes7Hy3ZC-"], ["updated_at", "2017-08-05 17:55:00.049471"], ["id", 1]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$an2eO1D8Qrm/oGUfy9YNrOH.H1uzK9XgA/yYJqjDcg4jKwBf34uCG"], ["created_at", "2017-08-05 17:55:00.059751"], ["updated_at", "2017-08-05 17:55:00.059751"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:FpnyPQMRDz-TynNnvWYr"], ["updated_at", "2017-08-05 17:55:00.061896"], ["id", 2]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.7ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$JPreqMX5wlCcWvMxELvlYuO0QdS4OqYs439WMGMu4M3Yd011QafYu"], ["created_at", "2017-08-05 17:55:00.070572"], ["updated_at", "2017-08-05 17:55:00.070572"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:E4MAgx4djNTdXB6dB3_7"], ["updated_at", "2017-08-05 17:55:00.071930"], ["id", 3]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$3T.unHht7X564r9AWz92cumSC6lPmfitND9BHh8Q1afI3wdJGBqky"], ["created_at", "2017-08-05 17:55:00.076317"], ["updated_at", "2017-08-05 17:55:00.076317"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:YQVGqAx9dbE4j2vzkRGc"], ["updated_at", "2017-08-05 17:55:00.077480"], ["id", 4]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:55:01.441992"], ["updated_at", "2017-08-05 17:55:01.441992"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$P87qRcQhVYU3cBt6hnjpluZ0grVikTu3EMm2ETzH8KehgZi550wna"], ["access_token", "abc"], ["created_at", "2017-08-05 17:55:01.446345"], ["updated_at", "2017-08-05 17:55:01.446345"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:wH8oEaLXH5Xi3M8B1qQs"], ["updated_at", "2017-08-05 17:55:01.448373"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:55:01.465657"], ["updated_at", "2017-08-05 17:55:01.465657"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$RJyUhsox6NT2fw8Ij0.zEOGEAYHGjyBi2xmPdrxfkNkIKh4Z06meS"], ["access_token", "abc"], ["created_at", "2017-08-05 17:55:01.469746"], ["updated_at", "2017-08-05 17:55:01.469746"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:2LNmbXAwy-gYSrx_Ei6m"], ["updated_at", "2017-08-05 17:55:01.470970"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.5ms | ActiveRecord: 1.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 0.7ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:55:02.010105"], ["updated_at", "2017-08-05 17:55:02.010105"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$x.jI2Ti4i8JNaF3ahKs4muUedc0o84sEDBbMzQE58PBiYYfijAzAC"], ["access_token", "abc"], ["created_at", "2017-08-05 17:55:02.015514"], ["updated_at", "2017-08-05 17:55:02.015514"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:xQ_hfX6xVHecsduj3ac5"], ["updated_at", "2017-08-05 17:55:02.017159"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:55:02.037395"], ["updated_at", "2017-08-05 17:55:02.037395"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$bWp7tJ4xPDErHdt8yw7ib.SexkL5yFV3ZwQj6lupSvJb8Us5Npvj."], ["access_token", "abc"], ["created_at", "2017-08-05 17:55:02.041386"], ["updated_at", "2017-08-05 17:55:02.041386"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:XefxXyCLYfc_8BNRzaWt"], ["updated_at", "2017-08-05 17:55:02.042620"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:55:02.049521"], ["updated_at", "2017-08-05 17:55:02.049521"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$KlHo6u4XpbjmYWk.rz.pDetzwMBlnkO59wmw5rQGUhhC7DFJmvCh."], ["access_token", "abc"], ["created_at", "2017-08-05 17:55:02.053625"], ["updated_at", "2017-08-05 17:55:02.053625"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:RFjxaFpkginofya7dW2R"], ["updated_at", "2017-08-05 17:55:02.054823"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 17:55:02.071633"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 17ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:55:02.077628"], ["updated_at", "2017-08-05 17:55:02.077628"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$qQ2iDgD5MiCBRseGyEK4ZOwOrGIsVpeJ.zyFdmUXs5T9.QD0e./hy"], ["access_token", "abc"], ["created_at", "2017-08-05 17:55:02.081468"], ["updated_at", "2017-08-05 17:55:02.081468"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:AuXrd2cwcvGd67eA4K1T"], ["updated_at", "2017-08-05 17:55:02.082699"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 17:55:02.085785"], ["last_sign_in_at", "2017-08-05 17:55:02.085785"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 17:55:02.086741"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 17:55:02.088449"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.7ms | ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 17:56:18.390029"], ["updated_at", "2017-08-05 17:56:18.390029"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.1ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.6ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$ErD2V9w60BS1rrGeeYb88emq0gANmLXHPUTrpd5uQHQxvNe47VcJu"], ["created_at", "2017-08-05 17:56:18.541529"], ["updated_at", "2017-08-05 17:56:18.541529"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:DW86VHqVHbCJjhDyfuUF"], ["updated_at", "2017-08-05 17:56:18.544561"], ["id", 1]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$N3t63H4CHZNkJm5ZCzqBYu9LKjrWJlqJZvjFiZFbVpGRfzzLVbP5m"], ["created_at", "2017-08-05 17:56:18.554436"], ["updated_at", "2017-08-05 17:56:18.554436"]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:ysGRhtVSaCYfK_yjuvbp"], ["updated_at", "2017-08-05 17:56:18.555842"], ["id", 2]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.7ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$xu2AHuFkQ9WrEW.vjD7VFukOLFWmVg88uZbmCj0cE.H.lhSewVIAe"], ["created_at", "2017-08-05 17:56:18.564573"], ["updated_at", "2017-08-05 17:56:18.564573"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:sd_E6QSZsKhXTjxhe-hz"], ["updated_at", "2017-08-05 17:56:18.565820"], ["id", 3]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$9yG/hX50O0QyiaTYllcVBu2Cacm5qmYCdS5grV.ePpv85L3jG.FVW"], ["created_at", "2017-08-05 17:56:18.569984"], ["updated_at", "2017-08-05 17:56:18.569984"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:jkL_4qsNJK7jcE2eu6ra"], ["updated_at", "2017-08-05 17:56:18.571158"], ["id", 4]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:56:18.610871"], ["updated_at", "2017-08-05 17:56:18.610871"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$Ll7/gNN4AcOeeFWYQuE0XeuRCevjqqHbZIm724DSw72bSYrMwTXP6"], ["access_token", "abc"], ["created_at", "2017-08-05 17:56:18.615228"], ["updated_at", "2017-08-05 17:56:18.615228"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:2QiBi7-DTji6243xa3tj"], ["updated_at", "2017-08-05 17:56:18.616546"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:56:18.634319"], ["updated_at", "2017-08-05 17:56:18.634319"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$R4E6G5FIgXsu2Lzv/.sDz.q9ZgU3Ax3EHoH7hJqtwXu.3lsvlMILi"], ["access_token", "abc"], ["created_at", "2017-08-05 17:56:18.638226"], ["updated_at", "2017-08-05 17:56:18.638226"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:Xh7dhqw_mFmX8aqTneqh"], ["updated_at", "2017-08-05 17:56:18.639399"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.3ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.5ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 1.3ms)
  [1m[35m (1.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:56:19.188740"], ["updated_at", "2017-08-05 17:56:19.188740"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$NpVYQAVotlS7CjEQIhNbgu02N8dcrWZp1dn5fbv2kPh9zDYg9w9g6"], ["access_token", "abc"], ["created_at", "2017-08-05 17:56:19.193472"], ["updated_at", "2017-08-05 17:56:19.193472"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:BHC8m4o23B3j2eHhv1Co"], ["updated_at", "2017-08-05 17:56:19.194763"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:56:19.215475"], ["updated_at", "2017-08-05 17:56:19.215475"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$EQMmdbyv5ENdvRxz7dHZfeHFc8th/5cYcZJBzT2XzJxB4922iCRU."], ["access_token", "abc"], ["created_at", "2017-08-05 17:56:19.219537"], ["updated_at", "2017-08-05 17:56:19.219537"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:_X1xrC2Cc4yTZN1yc2yC"], ["updated_at", "2017-08-05 17:56:19.220888"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:56:19.226660"], ["updated_at", "2017-08-05 17:56:19.226660"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$NcuNnHN1fV/A3Og0O6WtFOMg6WszET2B8lz5hzQkJ0Ej4UA9.dLYa"], ["access_token", "abc"], ["created_at", "2017-08-05 17:56:19.230890"], ["updated_at", "2017-08-05 17:56:19.230890"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:7NvwUShTNGKsb_XX72V8"], ["updated_at", "2017-08-05 17:56:19.232428"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 17:56:19.249513"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 17ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 17:56:19.256282"], ["updated_at", "2017-08-05 17:56:19.256282"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$0NIjMZWfvDRrP1dYH02.KepGAeZ82FplNQ6WUswUg74/GKQnJuhQW"], ["access_token", "abc"], ["created_at", "2017-08-05 17:56:19.260665"], ["updated_at", "2017-08-05 17:56:19.260665"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:qo2DnT17HUc-QyKyTNea"], ["updated_at", "2017-08-05 17:56:19.261959"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 17:56:19.265370"], ["last_sign_in_at", "2017-08-05 17:56:19.265370"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 17:56:19.266087"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 17:56:19.267772"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.9ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 18:04:54.207551"], ["updated_at", "2017-08-05 18:04:54.207551"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (1.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$eVWBqdZWuP45D4xsVLFpGOiVHHeC/VsvuyjzKuJ/e6jhqP.kVb5N2"], ["created_at", "2017-08-05 18:04:54.368065"], ["updated_at", "2017-08-05 18:04:54.368065"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:K4BP99pbzqML8vp8FmF3"], ["updated_at", "2017-08-05 18:04:54.377181"], ["id", 1]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$.EFotr06KBfM1WPiKKw2pO6vyo41fvZm5.i.QVxlLGr8U9kX6FGcO"], ["created_at", "2017-08-05 18:04:54.388910"], ["updated_at", "2017-08-05 18:04:54.388910"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:CiMuKBJzQFiJFn8cZTaX"], ["updated_at", "2017-08-05 18:04:54.391331"], ["id", 2]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$pUTxZcl6O3nBUHQjkszg3OZMKhgibJIBq/Lv4f8rEQUxBtJ2P0ChS"], ["created_at", "2017-08-05 18:04:54.404639"], ["updated_at", "2017-08-05 18:04:54.404639"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:ZkDcQqunFi2bjnPtf9S6"], ["updated_at", "2017-08-05 18:04:54.406377"], ["id", 3]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$T3YxpmcbU5GJSC3kaYGTquEfmy3pvYWWgRDJ3XEyAJBMg/EmRD/7K"], ["created_at", "2017-08-05 18:04:54.410529"], ["updated_at", "2017-08-05 18:04:54.410529"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:Bacen8myrB_XYQ5oKnWF"], ["updated_at", "2017-08-05 18:04:54.411660"], ["id", 4]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:04:54.468150"], ["updated_at", "2017-08-05 18:04:54.468150"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$gVWGeLTPAyABGcml/WDWgO/hmA.EmyAWeZUaq/l0aRqTwYrZlgu0K"], ["access_token", "abc"], ["created_at", "2017-08-05 18:04:54.475459"], ["updated_at", "2017-08-05 18:04:54.475459"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:2MKcxt-5mKyQyVzSAW6z"], ["updated_at", "2017-08-05 18:04:54.477320"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:04:54.496449"], ["updated_at", "2017-08-05 18:04:54.496449"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$O00c7WwLUNsi8OberuT9Hep1flGcGtccCnyN3c2O1/kzD6KvH4IcK"], ["access_token", "abc"], ["created_at", "2017-08-05 18:04:54.500726"], ["updated_at", "2017-08-05 18:04:54.500726"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:95xT6_ZhF7DrhEymup1-"], ["updated_at", "2017-08-05 18:04:54.503963"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.9ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:04:55.072429"], ["updated_at", "2017-08-05 18:04:55.072429"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$aCL1Fj6baUhmY/1T8bLP6u/x4V/rqoqlMKWTmP8oCImw0GcrWJoIC"], ["access_token", "abc"], ["created_at", "2017-08-05 18:04:55.076785"], ["updated_at", "2017-08-05 18:04:55.076785"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:L7GX9aK8xyXyAucojzMH"], ["updated_at", "2017-08-05 18:04:55.078003"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:04:55.100474"], ["updated_at", "2017-08-05 18:04:55.100474"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$RvoVEGPb/F3BIGzt.9vtO.IUQlvveEM1hd03sEedR7UwiOWh5B55m"], ["access_token", "abc"], ["created_at", "2017-08-05 18:04:55.106083"], ["updated_at", "2017-08-05 18:04:55.106083"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:vVYsC9Dm2FUhNKU-6D-9"], ["updated_at", "2017-08-05 18:04:55.107618"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:04:55.116341"], ["updated_at", "2017-08-05 18:04:55.116341"]]
  [1m[35m (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$3j30xvihmbwirrXA1gj7yutfrUsMS5/qbN38nzXAWTg5Jaaxelj/K"], ["access_token", "abc"], ["created_at", "2017-08-05 18:04:55.124087"], ["updated_at", "2017-08-05 18:04:55.124087"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:APeyPh5Ef4-ewHe-5r9a"], ["updated_at", "2017-08-05 18:04:55.125593"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 18:04:55.154074"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 31ms (ActiveRecord: 1.2ms)
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:04:55.172354"], ["updated_at", "2017-08-05 18:04:55.172354"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$.zMjXSY1wE840d96mYaACO5IgN8YAbczVgCiAtCOd3J7rMGIfumWy"], ["access_token", "abc"], ["created_at", "2017-08-05 18:04:55.180731"], ["updated_at", "2017-08-05 18:04:55.180731"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:cHEbWREuy6KTsWeRUzhq"], ["updated_at", "2017-08-05 18:04:55.182493"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 18:04:55.188421"], ["last_sign_in_at", "2017-08-05 18:04:55.188421"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 18:04:55.189187"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 18:04:55.193282"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 17ms (Views: 1.4ms | ActiveRecord: 1.2ms)
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (1.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 18:08:09.425140"], ["updated_at", "2017-08-05 18:08:09.425140"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.4ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$UfvNCpgQLY/EHqZQA0L4Uuz0hkVNXgYWvgvkjesdcjhVHCEreb6dW"], ["created_at", "2017-08-05 18:08:09.565527"], ["updated_at", "2017-08-05 18:08:09.565527"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:v5TjaTFkuAHfH-wkNezx"], ["updated_at", "2017-08-05 18:08:09.567251"], ["id", 1]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$QhFfEyRrFc7tYX0XtqpzP.mUTzjkoBukOaPwIxofN4nHL.WsykWYu"], ["created_at", "2017-08-05 18:08:09.572292"], ["updated_at", "2017-08-05 18:08:09.572292"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:SGsAko8C_tknN3bAsADE"], ["updated_at", "2017-08-05 18:08:09.573574"], ["id", 2]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$H0WS1qstQUJ85pvuZr23t../LPlFPF4SJvmBKUTQLCtkQP0RWhnrO"], ["created_at", "2017-08-05 18:08:09.582585"], ["updated_at", "2017-08-05 18:08:09.582585"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:bbviWjxMErfh7nYUTfu1"], ["updated_at", "2017-08-05 18:08:09.584847"], ["id", 3]]
  [1m[35m (1.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$s0umaFJHQSUiZnoNhQWNkOa.TiwnzjK86g7VsSmWeZL8AifeptVMa"], ["created_at", "2017-08-05 18:08:09.593257"], ["updated_at", "2017-08-05 18:08:09.593257"]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:BSzunH-Bbu3ayvpYG23z"], ["updated_at", "2017-08-05 18:08:09.595004"], ["id", 4]]
  [1m[35m (1.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:08:09.661249"], ["updated_at", "2017-08-05 18:08:09.661249"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$A.a.mx0iqFJNbaR.DVd1auQvzwy2FYCMlHw68N.cNkBLtDkicWazu"], ["access_token", "abc"], ["created_at", "2017-08-05 18:08:09.666581"], ["updated_at", "2017-08-05 18:08:09.666581"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:xkxmszZSxjQa_Xotf7o6"], ["updated_at", "2017-08-05 18:08:09.667801"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:08:09.690840"], ["updated_at", "2017-08-05 18:08:09.690840"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$4EoFM0vMhM1enYizw24RDe6FPJGT00Zi65l4.wXTdXMUCXv2HPsZa"], ["access_token", "abc"], ["created_at", "2017-08-05 18:08:09.695081"], ["updated_at", "2017-08-05 18:08:09.695081"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:dgHsrMUqzSZditFtZ1p4"], ["updated_at", "2017-08-05 18:08:09.696256"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 0.7ms)
  [1m[35m (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:08:10.235472"], ["updated_at", "2017-08-05 18:08:10.235472"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$lfYxMD5QbnYoa74NfUxlGO3pJIx4Cho5MaSfcK0pAXOz5.6M3X8Aa"], ["access_token", "abc"], ["created_at", "2017-08-05 18:08:10.239528"], ["updated_at", "2017-08-05 18:08:10.239528"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:E4jJcsYcMfgxXQXnzWyN"], ["updated_at", "2017-08-05 18:08:10.240720"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:08:10.265174"], ["updated_at", "2017-08-05 18:08:10.265174"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$dDE3tmT7vG2ZAn6d7KkQ5Of2Y/DW9/oIGWkuOh09zdYRsyXqEXScq"], ["access_token", "abc"], ["created_at", "2017-08-05 18:08:10.269199"], ["updated_at", "2017-08-05 18:08:10.269199"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:FgJxau25kiGPfkxox3KT"], ["updated_at", "2017-08-05 18:08:10.270312"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.0ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:08:10.275755"], ["updated_at", "2017-08-05 18:08:10.275755"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$9Fdbt8xMmzleTlRStbwfJuBRiQ.zqAwUdDlfl0R2VOc.Okw..VAtG"], ["access_token", "abc"], ["created_at", "2017-08-05 18:08:10.279721"], ["updated_at", "2017-08-05 18:08:10.279721"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:zyUi1LyBxJ-2hr7qXb7g"], ["updated_at", "2017-08-05 18:08:10.281351"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.2ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 18:08:10.297682"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 16ms (ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:08:10.304540"], ["updated_at", "2017-08-05 18:08:10.304540"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$apxwMZg8D/WaUJPgIHSVIuH3UR5ubi5WcAeDF6zASERkh6pF8RuC6"], ["access_token", "abc"], ["created_at", "2017-08-05 18:08:10.308680"], ["updated_at", "2017-08-05 18:08:10.308680"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:kuRW5nx_gArEzkEr6cyx"], ["updated_at", "2017-08-05 18:08:10.309909"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 18:08:10.312859"], ["last_sign_in_at", "2017-08-05 18:08:10.312859"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 18:08:10.313537"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 18:08:10.315185"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 8ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 18:08:45.120244"], ["updated_at", "2017-08-05 18:08:45.120244"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$h0Eljr8ikLcn0WrLgDhq/.S7so/uDvJsxxwPF.mQgadSiFcE1DbFa"], ["created_at", "2017-08-05 18:08:45.266792"], ["updated_at", "2017-08-05 18:08:45.266792"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:6dAR_RXJUjiLiG2wvkWx"], ["updated_at", "2017-08-05 18:08:45.268706"], ["id", 1]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$Hd5ZAE5Osx2xPvGHeyjkI.aCRvsCxu7pOgKem3EA0xi.h3CZ/0wQO"], ["created_at", "2017-08-05 18:08:45.274322"], ["updated_at", "2017-08-05 18:08:45.274322"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:RGWeFDU9dkrVxvt4edRy"], ["updated_at", "2017-08-05 18:08:45.275669"], ["id", 2]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.7ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$d8CbR/MRLsUQejJvTgGvP.Y6tMbq.mWLI7j3Nvhufd11ocCdNg24e"], ["created_at", "2017-08-05 18:08:45.282547"], ["updated_at", "2017-08-05 18:08:45.282547"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:s4MNt-QssQ5je3DFaMh5"], ["updated_at", "2017-08-05 18:08:45.283744"], ["id", 3]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$M7k8Gi4430oXbdgA9lK4jOaFcz.BDIdWlbzEC8kklT8SNohvKsIhu"], ["created_at", "2017-08-05 18:08:45.288193"], ["updated_at", "2017-08-05 18:08:45.288193"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:FEC5XtvhdEWmuxCEh53x"], ["updated_at", "2017-08-05 18:08:45.289446"], ["id", 4]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:08:45.375291"], ["updated_at", "2017-08-05 18:08:45.375291"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$JgI.VyXQwYgbLG4cLKj7ounnjrXZwRN.o2gRC17iGn1dFe8XZ.Q5m"], ["access_token", "abc"], ["created_at", "2017-08-05 18:08:45.379528"], ["updated_at", "2017-08-05 18:08:45.379528"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:ceTyzQASYEkm6yKxytiL"], ["updated_at", "2017-08-05 18:08:45.380768"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:08:45.397498"], ["updated_at", "2017-08-05 18:08:45.397498"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$4ImtH9F6KLf2rzOv3bHldeKilxpG2MsJION6.WErmQNxeQvIaglMO"], ["access_token", "abc"], ["created_at", "2017-08-05 18:08:45.407862"], ["updated_at", "2017-08-05 18:08:45.407862"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:yU48Q2T_rCsxxHsxXEa4"], ["updated_at", "2017-08-05 18:08:45.409139"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 1.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.7ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.8ms | ActiveRecord: 1.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.1ms)
  [1m[35m (1.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:08:45.992589"], ["updated_at", "2017-08-05 18:08:45.992589"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$STiellkDeWPVjlmkgoIVdeiLK58l.iiYEn2znOxxmPE0MwEDqTGJK"], ["access_token", "abc"], ["created_at", "2017-08-05 18:08:45.997374"], ["updated_at", "2017-08-05 18:08:45.997374"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:4_tMgGT4JAPQmdPfuM9v"], ["updated_at", "2017-08-05 18:08:45.998662"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:08:46.020485"], ["updated_at", "2017-08-05 18:08:46.020485"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$hW9I2Y6yw/SjUvTQ1prmmu7uljMkU7nZ9JzJcG0ss8XVVOgHmxkzC"], ["access_token", "abc"], ["created_at", "2017-08-05 18:08:46.024843"], ["updated_at", "2017-08-05 18:08:46.024843"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:XQkMRdNJ3eHM-Jz6cC_4"], ["updated_at", "2017-08-05 18:08:46.026216"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:08:46.032041"], ["updated_at", "2017-08-05 18:08:46.032041"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$Eyclum8a8zbt0YTpvw4.Y.hvxZvfg8DG9CeL/5iyl0Y0U3T20UdQa"], ["access_token", "abc"], ["created_at", "2017-08-05 18:08:46.036651"], ["updated_at", "2017-08-05 18:08:46.036651"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:Z5ygxgBuFR-WUJrXfFu7"], ["updated_at", "2017-08-05 18:08:46.038134"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 18:08:46.055085"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 17ms (ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:08:46.062187"], ["updated_at", "2017-08-05 18:08:46.062187"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$j0JH/RtgfTuI7kBbVhLU7uMRn3DCwLV/RGE3y8cly9iBZdVT0jsr2"], ["access_token", "abc"], ["created_at", "2017-08-05 18:08:46.066306"], ["updated_at", "2017-08-05 18:08:46.066306"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:miTVt_sopzaWofTfzQvb"], ["updated_at", "2017-08-05 18:08:46.067486"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 18:08:46.070578"], ["last_sign_in_at", "2017-08-05 18:08:46.070578"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 18:08:46.071214"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 18:08:46.072878"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.6ms | ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 18:10:45.910892"], ["updated_at", "2017-08-05 18:10:45.910892"]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$q4g94PSY8ZFtcO1xbzpXC./XCDMofQ1qbJ1QT10YDkfQs6t4sUmUC"], ["created_at", "2017-08-05 18:10:46.053106"], ["updated_at", "2017-08-05 18:10:46.053106"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:FRTFyZE3cA1EghekwNmN"], ["updated_at", "2017-08-05 18:10:46.056200"], ["id", 1]]
  [1m[35m (1.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$IofDF8ioK47vtKKSTWWL2OMcU6WzIg/H3ceS8/HZHS/pRk0u7Kz9G"], ["created_at", "2017-08-05 18:10:46.063233"], ["updated_at", "2017-08-05 18:10:46.063233"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:FZwMLwKFeyaGTsmxszw1"], ["updated_at", "2017-08-05 18:10:46.064596"], ["id", 2]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$FIYFQdI0uyqWnFco5rfJMeAHVhT0dOhfxHrN26eMtB7bWN/DxkEhO"], ["created_at", "2017-08-05 18:10:46.073838"], ["updated_at", "2017-08-05 18:10:46.073838"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:2Jb1t1cadVN8xciw2yML"], ["updated_at", "2017-08-05 18:10:46.075096"], ["id", 3]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$l6AUli6sbg7l3fwTuIccdOZAV3IZV7wLDa1rFgzh.ecluAaR8YJBK"], ["created_at", "2017-08-05 18:10:46.079924"], ["updated_at", "2017-08-05 18:10:46.079924"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:tqbvCzxcJW59MuFaXp_C"], ["updated_at", "2017-08-05 18:10:46.081133"], ["id", 4]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:10:46.121108"], ["updated_at", "2017-08-05 18:10:46.121108"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$xsmBTp8y0ayMEraPn3qA0edJD6BbLrQhsZkBrYpTlfMYTBm/vl34a"], ["access_token", "abc"], ["created_at", "2017-08-05 18:10:46.125196"], ["updated_at", "2017-08-05 18:10:46.125196"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:2jCHwGpLaDHsMu6rpuBF"], ["updated_at", "2017-08-05 18:10:46.126613"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:10:46.145523"], ["updated_at", "2017-08-05 18:10:46.145523"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$27ed44Y9YpbgRGraBi//HOLinM9yDvI/HnMY3vfd9PQOOElmI1wfS"], ["access_token", "abc"], ["created_at", "2017-08-05 18:10:46.149790"], ["updated_at", "2017-08-05 18:10:46.149790"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:-pA1rCiw-s85LgM1gHsm"], ["updated_at", "2017-08-05 18:10:46.150871"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 11ms (Views: 0.6ms | ActiveRecord: 2.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 16ms (Views: 0.6ms | ActiveRecord: 2.5ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.5ms | ActiveRecord: 2.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.7ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:10:46.910866"], ["updated_at", "2017-08-05 18:10:46.910866"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$3U3BXCnjfoxIokoG1J0m0u/iRoIIyfbvnggjFeKG7bWIt92kFtVMq"], ["access_token", "abc"], ["created_at", "2017-08-05 18:10:46.916351"], ["updated_at", "2017-08-05 18:10:46.916351"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:XvLyngspWiXJvUJpSsxh"], ["updated_at", "2017-08-05 18:10:46.918008"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:10:46.927540"], ["updated_at", "2017-08-05 18:10:46.927540"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$Md/GHB0xZ4csbuh.BI5QReaKFLFxk5gt2ZX5exl1LoTrVRuohT4.S"], ["access_token", "abc"], ["created_at", "2017-08-05 18:10:46.931992"], ["updated_at", "2017-08-05 18:10:46.931992"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:ynxZn6mMHznyQRsvQ5kx"], ["updated_at", "2017-08-05 18:10:46.933431"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.0ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:10:46.938859"], ["updated_at", "2017-08-05 18:10:46.938859"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$N5H/uXPZuPmGevVHiOiZ1OOuPKXRmC7iCtBz6j9ckHson9kBM3Gty"], ["access_token", "abc"], ["created_at", "2017-08-05 18:10:46.942444"], ["updated_at", "2017-08-05 18:10:46.942444"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:C5Jf9xwzFq8rt1BDgxDW"], ["updated_at", "2017-08-05 18:10:46.943562"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 18:10:46.960576"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 17ms (ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:10:46.967367"], ["updated_at", "2017-08-05 18:10:46.967367"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$DNo73tPecVBQqAackaBMTOPrnSVnJne75TeW2rX5gsknT5VY31d5m"], ["access_token", "abc"], ["created_at", "2017-08-05 18:10:46.972229"], ["updated_at", "2017-08-05 18:10:46.972229"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:C_q_aMsh-BX32u3aEY7D"], ["updated_at", "2017-08-05 18:10:46.974069"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 18:10:46.977601"], ["last_sign_in_at", "2017-08-05 18:10:46.977601"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 18:10:46.978215"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 18:10:46.979819"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 8ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 18:11:58.774538"], ["updated_at", "2017-08-05 18:11:58.774538"]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.3ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$vlspRFDCSV1XwCbmQFH6NeNRmQZdgOqoxsdA5YTIP1abqMqUHYKky"], ["created_at", "2017-08-05 18:11:58.928511"], ["updated_at", "2017-08-05 18:11:58.928511"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:yL2xdtPsTNTnn_6K3oVX"], ["updated_at", "2017-08-05 18:11:58.931003"], ["id", 1]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$D78dx5mNBdAgBT4cv9kUwe5rziWui91YYYL5shD9Tyn4xnRrOOaiu"], ["created_at", "2017-08-05 18:11:58.937510"], ["updated_at", "2017-08-05 18:11:58.937510"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:M4m6uzD962WaKg1D6V65"], ["updated_at", "2017-08-05 18:11:58.938802"], ["id", 2]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$sSejKanvR2n588KYMmIglO6oT/uYNuwpi7awmZWyRbD/rHFewyQG6"], ["created_at", "2017-08-05 18:11:58.948712"], ["updated_at", "2017-08-05 18:11:58.948712"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:Hs3YymizznLyXazy3JXt"], ["updated_at", "2017-08-05 18:11:58.950672"], ["id", 3]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$EAxpE8NIZ/gkiZQR6UD/IOhyncuBRX0DpIJzrbUI3K9NbgZaUwd32"], ["created_at", "2017-08-05 18:11:58.955158"], ["updated_at", "2017-08-05 18:11:58.955158"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:d7LSCeyZxdBVW7v_PGi5"], ["updated_at", "2017-08-05 18:11:58.956382"], ["id", 4]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:11:58.987639"], ["updated_at", "2017-08-05 18:11:58.987639"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$IT2QfC/KYQLielqiM98k3.e2QTCukJMC385buAivIHdO/qGlSD73S"], ["access_token", "abc"], ["created_at", "2017-08-05 18:11:58.991699"], ["updated_at", "2017-08-05 18:11:58.991699"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:-VxPyrtuxVBp-KXLyeBu"], ["updated_at", "2017-08-05 18:11:58.992961"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.4ms | ActiveRecord: 0.5ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:11:59.014527"], ["updated_at", "2017-08-05 18:11:59.014527"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$Oou9m1iKm/Fx3lgoZUEPheBq4r1zELdBYK/hbaHRxsK.0YBSmUPYm"], ["access_token", "abc"], ["created_at", "2017-08-05 18:11:59.020428"], ["updated_at", "2017-08-05 18:11:59.020428"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:daEF9TsAYC5_R85zRqUk"], ["updated_at", "2017-08-05 18:11:59.022073"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.8ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 1.2ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.6ms | ActiveRecord: 2.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 1.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
  [1m[35m (1.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:11:59.723687"], ["updated_at", "2017-08-05 18:11:59.723687"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$GNSOvhegujM2UBpGxYWrv.GDVeXC3fPLj7BLNH0VpFd9yZZY4Qgfu"], ["access_token", "abc"], ["created_at", "2017-08-05 18:11:59.728014"], ["updated_at", "2017-08-05 18:11:59.728014"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:BuoTr7skcZ3aqd8BMskN"], ["updated_at", "2017-08-05 18:11:59.729291"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:11:59.748375"], ["updated_at", "2017-08-05 18:11:59.748375"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$zF8ZuMRyKh6pq1Oc6Hu6T.4B1o7thKheULQqU/KCMFEcV0vGhQu2K"], ["access_token", "abc"], ["created_at", "2017-08-05 18:11:59.755265"], ["updated_at", "2017-08-05 18:11:59.755265"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:_DWK51D53wo4R-SkLUCb"], ["updated_at", "2017-08-05 18:11:59.756788"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:11:59.763803"], ["updated_at", "2017-08-05 18:11:59.763803"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$bjgvK56g1z38cMLWxQWIx.oIH.0gpXCo8Snnyx/mfdi0cS3SfKCqC"], ["access_token", "abc"], ["created_at", "2017-08-05 18:11:59.768700"], ["updated_at", "2017-08-05 18:11:59.768700"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:n48fsWyaTUbMEs33mpkd"], ["updated_at", "2017-08-05 18:11:59.770149"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.2ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 18:11:59.786855"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 16ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:11:59.792985"], ["updated_at", "2017-08-05 18:11:59.792985"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$w4soFXwRkLXz57G2cl5cjORk63VgNJ9fg94dZ/uV8O0nOUv45X8VO"], ["access_token", "abc"], ["created_at", "2017-08-05 18:11:59.797093"], ["updated_at", "2017-08-05 18:11:59.797093"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:mczcgu44ZotcsHq_H513"], ["updated_at", "2017-08-05 18:11:59.798364"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 18:11:59.801711"], ["last_sign_in_at", "2017-08-05 18:11:59.801711"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 18:11:59.802678"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 18:11:59.804579"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 18:13:43.058719"], ["updated_at", "2017-08-05 18:13:43.058719"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.1ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.6ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$tQOXn1KbmRg8AtrEd3QVTug87dzVGeShIP.T6QLYxkKd1W52N68Ai"], ["created_at", "2017-08-05 18:13:43.215642"], ["updated_at", "2017-08-05 18:13:43.215642"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:h3jy6un51MqoYWSFhvEa"], ["updated_at", "2017-08-05 18:13:43.219362"], ["id", 1]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$lUjxxaiE/2Q8HAkwN3Y5BuiTWgV0k1uDejjbdCxVjuXSZYVg6pJ6S"], ["created_at", "2017-08-05 18:13:43.227837"], ["updated_at", "2017-08-05 18:13:43.227837"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:bkYR9kManmN35C9GNuUz"], ["updated_at", "2017-08-05 18:13:43.229434"], ["id", 2]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$INr4ANA6GJsMYXhr8fLnr.aSeJeubSbWB8pOx0vpUy529IX6bkara"], ["created_at", "2017-08-05 18:13:43.236548"], ["updated_at", "2017-08-05 18:13:43.236548"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:xEpLXBBtfkdJPDGUZoY9"], ["updated_at", "2017-08-05 18:13:43.237872"], ["id", 3]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$N9SAMa12WAjOmOOX8oTZY.58NJjiu6j29/gqS8iJGfkT/304EFb7e"], ["created_at", "2017-08-05 18:13:43.242187"], ["updated_at", "2017-08-05 18:13:43.242187"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:F_znNr2hjoYx9yCwkexN"], ["updated_at", "2017-08-05 18:13:43.243321"], ["id", 4]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:13:43.312580"], ["updated_at", "2017-08-05 18:13:43.312580"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$dUO/yNPGL3HFW8Xr8ZBshugCHQhD6YzleBBGAU9NXo202s.lZ3pDq"], ["access_token", "abc"], ["created_at", "2017-08-05 18:13:43.316852"], ["updated_at", "2017-08-05 18:13:43.316852"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:V74sN3FmjeNNZJXZQkyv"], ["updated_at", "2017-08-05 18:13:43.318434"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:13:43.341451"], ["updated_at", "2017-08-05 18:13:43.341451"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$DTbW4Zy.B7fZ75wzP5SWYuOExme9JMhY2HBusVBSDNPGRA5/v0Fdq"], ["access_token", "abc"], ["created_at", "2017-08-05 18:13:43.345932"], ["updated_at", "2017-08-05 18:13:43.345932"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:fxVpabNyysWfy6TqaAbW"], ["updated_at", "2017-08-05 18:13:43.347812"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.5ms | ActiveRecord: 1.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.4ms | ActiveRecord: 1.4ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:13:43.906570"], ["updated_at", "2017-08-05 18:13:43.906570"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$YrDQKqIsHk7H3BcCd.pou.ypQHSaRkdOZVDonQzmCjSvt3kjvOF7m"], ["access_token", "abc"], ["created_at", "2017-08-05 18:13:43.910787"], ["updated_at", "2017-08-05 18:13:43.910787"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:5xsV-Re9iT2JQWfyf13s"], ["updated_at", "2017-08-05 18:13:43.911971"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:13:43.920074"], ["updated_at", "2017-08-05 18:13:43.920074"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$7NKQ5mVkewRoWsu0feRw4exuUZw0aNcd8xo0gkcWIEVlGJIn8cFzO"], ["access_token", "abc"], ["created_at", "2017-08-05 18:13:43.924623"], ["updated_at", "2017-08-05 18:13:43.924623"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:Uz8oC_4h5BrmVi-gZqMN"], ["updated_at", "2017-08-05 18:13:43.926010"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:13:43.933182"], ["updated_at", "2017-08-05 18:13:43.933182"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$Kose1UaYeOrOTaZ5z6dqeO5SkZW/vOrBSdc2N7qIrqYugY9PIzMjy"], ["access_token", "abc"], ["created_at", "2017-08-05 18:13:43.936989"], ["updated_at", "2017-08-05 18:13:43.936989"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:2En2GVxRgCM8oktFFrzJ"], ["updated_at", "2017-08-05 18:13:43.938212"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 18:13:43.954858"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 16ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:13:43.961093"], ["updated_at", "2017-08-05 18:13:43.961093"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$NqC8W4Zog8IoTUHqppc5ve6ux1wsmy17u8aefjYruW.SNlzhWJDsa"], ["access_token", "abc"], ["created_at", "2017-08-05 18:13:43.965117"], ["updated_at", "2017-08-05 18:13:43.965117"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:rrR_44eAfzURVW5Ef6v8"], ["updated_at", "2017-08-05 18:13:43.966485"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 18:13:43.970283"], ["last_sign_in_at", "2017-08-05 18:13:43.970283"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 18:13:43.971241"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 18:13:43.973247"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 1.0ms | ActiveRecord: 0.7ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 18:14:32.288400"], ["updated_at", "2017-08-05 18:14:32.288400"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$cKSXzYjx4WaFU/UzSYaVOeM6aPTEDEIjO79qOCiAAYFdWmc/tolEK"], ["created_at", "2017-08-05 18:14:32.430386"], ["updated_at", "2017-08-05 18:14:32.430386"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:AKRJMUbznNapyEUm9S1a"], ["updated_at", "2017-08-05 18:14:32.432526"], ["id", 1]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$FHDaunobgvB8S0XNzcXFNOdLg2eIg2JI5kWWT0NaR/bTMigr6ZQZK"], ["created_at", "2017-08-05 18:14:32.438595"], ["updated_at", "2017-08-05 18:14:32.438595"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:p6XZCPs2xXi2Vsdgb3_H"], ["updated_at", "2017-08-05 18:14:32.439899"], ["id", 2]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$uTYiXgOZmwLoa5XxJfWqCuhvUpca07P6l5JukKpH6pg0Q/0UBSFM2"], ["created_at", "2017-08-05 18:14:32.451086"], ["updated_at", "2017-08-05 18:14:32.451086"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:TRhrBeohW8DhRda3FZrx"], ["updated_at", "2017-08-05 18:14:32.452465"], ["id", 3]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$68vLKBZmoBTheF3bO92mdu5rF2SaRzP8Y4bYWII/JXN3G5.0j1uTK"], ["created_at", "2017-08-05 18:14:32.456849"], ["updated_at", "2017-08-05 18:14:32.456849"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:Jqi3cyY2fQp1gCapfvV5"], ["updated_at", "2017-08-05 18:14:32.458521"], ["id", 4]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:14:32.532442"], ["updated_at", "2017-08-05 18:14:32.532442"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$IfLLfsIZokKQ/T2YaZa0keCUbCiP9UYEQ4onBSzx5Go9/2w1PJcN."], ["access_token", "abc"], ["created_at", "2017-08-05 18:14:32.536875"], ["updated_at", "2017-08-05 18:14:32.536875"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:raS8srC9PPwVNanE4GoQ"], ["updated_at", "2017-08-05 18:14:32.538523"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 0.3ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:14:32.577207"], ["updated_at", "2017-08-05 18:14:32.577207"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$bamL9BA.yyVYHRPlzif5EOG2JlLS3f6Pb82Hh59JyCVMOtnEUrYTK"], ["access_token", "abc"], ["created_at", "2017-08-05 18:14:32.581255"], ["updated_at", "2017-08-05 18:14:32.581255"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:4TAsjWJih2x-ZwE1Nj_R"], ["updated_at", "2017-08-05 18:14:32.582484"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.5ms | ActiveRecord: 0.7ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:14:33.177501"], ["updated_at", "2017-08-05 18:14:33.177501"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$nW5oknAYTMs/oWIBY77HYOGcl736WUwfTX6mHjGZN4Kmw7gPxAb62"], ["access_token", "abc"], ["created_at", "2017-08-05 18:14:33.181663"], ["updated_at", "2017-08-05 18:14:33.181663"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:swq1y6J3iUNN2oyLCnJ2"], ["updated_at", "2017-08-05 18:14:33.182822"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.4ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:14:33.191249"], ["updated_at", "2017-08-05 18:14:33.191249"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$cK8Garna.RrTJhVtC2V0.eUIuQ8XtnmJKOZ/1g/wYW4njkZhMQGs6"], ["access_token", "abc"], ["created_at", "2017-08-05 18:14:33.195351"], ["updated_at", "2017-08-05 18:14:33.195351"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:VW_oWbWuGrNuQeoPwK5m"], ["updated_at", "2017-08-05 18:14:33.196622"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:14:33.202986"], ["updated_at", "2017-08-05 18:14:33.202986"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$LtD4hHUeGHhO1AnC7g0POegd2V8t3E.TGRUgYLQPTMSEVo24r2rZm"], ["access_token", "abc"], ["created_at", "2017-08-05 18:14:33.206920"], ["updated_at", "2017-08-05 18:14:33.206920"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:_x4_eEnZqnEPbem_x694"], ["updated_at", "2017-08-05 18:14:33.208336"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 18:14:33.226018"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 18ms (ActiveRecord: 0.7ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:14:33.233585"], ["updated_at", "2017-08-05 18:14:33.233585"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$IHFFDbEbJ31n4JmrxoEf/eMzwRx9O1uiP4MQ4vRYxYRVlm5h7SgB6"], ["access_token", "abc"], ["created_at", "2017-08-05 18:14:33.237805"], ["updated_at", "2017-08-05 18:14:33.237805"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:gxJHjeoQa7ctB4RDszSd"], ["updated_at", "2017-08-05 18:14:33.238945"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 18:14:33.241481"], ["last_sign_in_at", "2017-08-05 18:14:33.241481"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 18:14:33.242106"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 18:14:33.245271"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 11ms (Views: 0.8ms | ActiveRecord: 0.9ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (1.5ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 18:15:41.322439"], ["updated_at", "2017-08-05 18:15:41.322439"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$yYpdilEtsSt4NXR5isskKuP8hxA2Bvj9gQfqc1H7JVhzWrsBDxQbu"], ["created_at", "2017-08-05 18:15:41.495126"], ["updated_at", "2017-08-05 18:15:41.495126"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.6ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:Uz4vHkcs1DEwts_xFdez"], ["updated_at", "2017-08-05 18:15:41.499730"], ["id", 1]]
  [1m[35m (2.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$yEHCckVdXrnqKQc.CNat0u/W6ZdNU1giN2QuLEGTArZt.FxrZBbYq"], ["created_at", "2017-08-05 18:15:41.523189"], ["updated_at", "2017-08-05 18:15:41.523189"]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:p5TWrNWc-7DTYNkLfeKd"], ["updated_at", "2017-08-05 18:15:41.526944"], ["id", 2]]
  [1m[35m (1.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (1.3ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (1.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$ONPbqbjZ/0lGRGu3UUpPQePBqlvX0jcBKFIpZM/skNJ41nLS8Ln4u"], ["created_at", "2017-08-05 18:15:41.542413"], ["updated_at", "2017-08-05 18:15:41.542413"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:yyxyyo4rBSCVnmXYX6eT"], ["updated_at", "2017-08-05 18:15:41.552017"], ["id", 3]]
  [1m[35m (1.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$MrqMp13u3V5lWgJ3kHOtZOUwW5fV5Qks3870oDr1dCre1ysoLg7hW"], ["created_at", "2017-08-05 18:15:41.560764"], ["updated_at", "2017-08-05 18:15:41.560764"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:3J4CeZdNbu8t-vCR4mVU"], ["updated_at", "2017-08-05 18:15:41.562872"], ["id", 4]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (1.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (2.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:15:41.699955"], ["updated_at", "2017-08-05 18:15:41.699955"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$aYs4D5PeaO2Y37WMBkksa.2bmQTUy8CIf3b94q7g2A88N8KU8RkV."], ["access_token", "abc"], ["created_at", "2017-08-05 18:15:41.704772"], ["updated_at", "2017-08-05 18:15:41.704772"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:8dctzgn_yDXsxWXK3bgr"], ["updated_at", "2017-08-05 18:15:41.726599"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.4ms | ActiveRecord: 0.4ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:15:41.757206"], ["updated_at", "2017-08-05 18:15:41.757206"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$ySVBssLaDYsPtu2aAQik2uC4b.u6K37.i4Uk0SEvA19uix2qWeH5m"], ["access_token", "abc"], ["created_at", "2017-08-05 18:15:41.761406"], ["updated_at", "2017-08-05 18:15:41.761406"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:h4FnYpx5wTCPjHthspRg"], ["updated_at", "2017-08-05 18:15:41.762684"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 10ms (Views: 1.7ms | ActiveRecord: 2.5ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.7ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:15:42.386650"], ["updated_at", "2017-08-05 18:15:42.386650"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$PiS7GaR8tUyNAIu9pEaWI.lhT7EQv7N/qjcP9sZWz5zZmkqV5rDZy"], ["access_token", "abc"], ["created_at", "2017-08-05 18:15:42.390844"], ["updated_at", "2017-08-05 18:15:42.390844"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:avpyajzS5zjD1XEyDMtv"], ["updated_at", "2017-08-05 18:15:42.392684"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:15:42.402554"], ["updated_at", "2017-08-05 18:15:42.402554"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$sN3Ox5MZDK3m4Svya5jYfuqM0lNwSLwFs8v02Pe5r9yq//ScGGSXi"], ["access_token", "abc"], ["created_at", "2017-08-05 18:15:42.407083"], ["updated_at", "2017-08-05 18:15:42.407083"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:JSXL-vRqxMPDTUjoBzKW"], ["updated_at", "2017-08-05 18:15:42.408672"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:15:42.414862"], ["updated_at", "2017-08-05 18:15:42.414862"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$wswoB0yW70q3BDtulUPEuew5BFjCPyTLfUfi.6q8pP0tWF/HtiMqu"], ["access_token", "abc"], ["created_at", "2017-08-05 18:15:42.418814"], ["updated_at", "2017-08-05 18:15:42.418814"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:y_bjuNexBxymWsZgAcfH"], ["updated_at", "2017-08-05 18:15:42.420171"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 18:15:42.437471"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 17ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:15:42.445209"], ["updated_at", "2017-08-05 18:15:42.445209"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$HIW5dvxONQwIZjGOS86TNu42vGmCDOfQwWyO58xK29Ayv2iL.N.o."], ["access_token", "abc"], ["created_at", "2017-08-05 18:15:42.449697"], ["updated_at", "2017-08-05 18:15:42.449697"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:idNY93ssLjJCBbTg8UQP"], ["updated_at", "2017-08-05 18:15:42.451548"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 18:15:42.455190"], ["last_sign_in_at", "2017-08-05 18:15:42.455190"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 18:15:42.455790"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 18:15:42.457393"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 1.0ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 18:18:08.711477"], ["updated_at", "2017-08-05 18:18:08.711477"]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.1ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$RSiSKN9tKuSe2hmYOuFF3.GzzehYF8isTp.v7oqHzGAPkXH9kZ1he"], ["created_at", "2017-08-05 18:18:08.854940"], ["updated_at", "2017-08-05 18:18:08.854940"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:DGqsLZ83NvAqGXwfyjdC"], ["updated_at", "2017-08-05 18:18:08.857061"], ["id", 1]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$7YxD0oCNRkJXGQH5ZZhPQ.taww..LF4hSZ8.22kOfSxhzOj.sypfi"], ["created_at", "2017-08-05 18:18:08.862874"], ["updated_at", "2017-08-05 18:18:08.862874"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:jnVzFFYhpy2yiczygk84"], ["updated_at", "2017-08-05 18:18:08.864355"], ["id", 2]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$xL56iJrb/lEHXywL0Qhw3elwYfVye0VBpEBTCIxA/6YqScINqto/i"], ["created_at", "2017-08-05 18:18:08.874934"], ["updated_at", "2017-08-05 18:18:08.874934"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:v8evzimPLytqnHzeDqU_"], ["updated_at", "2017-08-05 18:18:08.876334"], ["id", 3]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$NgGife802jjepC53gX.zduRzfgxsznJpDfUtpax.5mwAegM5bCU5a"], ["created_at", "2017-08-05 18:18:08.881927"], ["updated_at", "2017-08-05 18:18:08.881927"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:71_rdn6AZehp8uxg9xa-"], ["updated_at", "2017-08-05 18:18:08.883318"], ["id", 4]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.7ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:18:08.990527"], ["updated_at", "2017-08-05 18:18:08.990527"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$jW0fj3AW/4hDEshM8IpFaeMxhbpma2UXmXa/BdC4boAC8OKP1bHI2"], ["access_token", "abc"], ["created_at", "2017-08-05 18:18:09.003588"], ["updated_at", "2017-08-05 18:18:09.003588"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:-UEykcfMUsU6W8SR-rod"], ["updated_at", "2017-08-05 18:18:09.005273"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:18:09.022595"], ["updated_at", "2017-08-05 18:18:09.022595"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$dh29wxko9n2r4dvTXRlyAe6CZbCDnOIZkVAU5uWFhneMlnzSCzVGe"], ["access_token", "abc"], ["created_at", "2017-08-05 18:18:09.027053"], ["updated_at", "2017-08-05 18:18:09.027053"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:ntsJ3eCY9-y8KGAxruyy"], ["updated_at", "2017-08-05 18:18:09.028730"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.7ms | ActiveRecord: 1.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 9ms (Views: 0.8ms | ActiveRecord: 1.8ms)
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:18:09.714275"], ["updated_at", "2017-08-05 18:18:09.714275"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$mFBCKoxlX1kxZ7TL7FycSObJ1JKiZnj9D/jYrPJefadm7pfE2.Qn6"], ["access_token", "abc"], ["created_at", "2017-08-05 18:18:09.721900"], ["updated_at", "2017-08-05 18:18:09.721900"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:iPWsDyJueh1YrzQ2vhnx"], ["updated_at", "2017-08-05 18:18:09.723513"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.7ms | ActiveRecord: 0.4ms)
  [1m[35m (0.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:18:09.739173"], ["updated_at", "2017-08-05 18:18:09.739173"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$czEDJ6As0ZJlIUc3BX0YZewHc.PhX3xNDX6.PuHvoSH3PjWCw5Ayi"], ["access_token", "abc"], ["created_at", "2017-08-05 18:18:09.744435"], ["updated_at", "2017-08-05 18:18:09.744435"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:y4sM_ojzy3TsrUgxq4yP"], ["updated_at", "2017-08-05 18:18:09.747147"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (0.7ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.9ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:18:09.757173"], ["updated_at", "2017-08-05 18:18:09.757173"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$F37QLh5hegTTLy7SO72tm.F3IyiSlmO37r0hh2sD3UAr2id9CGHRe"], ["access_token", "abc"], ["created_at", "2017-08-05 18:18:09.765510"], ["updated_at", "2017-08-05 18:18:09.765510"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:wg3zcSQx3VsF6ErmgpS7"], ["updated_at", "2017-08-05 18:18:09.769015"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.4ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.6ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 18:18:09.796006"], ["id", 5]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 29ms (ActiveRecord: 1.5ms)
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (1.1ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:18:09.814635"], ["updated_at", "2017-08-05 18:18:09.814635"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$A8jU/74DLxfcbxjVLCS1cOOFcQLJ9z98XYQqQSnb/7QPkw84nRnBS"], ["access_token", "abc"], ["created_at", "2017-08-05 18:18:09.824030"], ["updated_at", "2017-08-05 18:18:09.824030"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:xji-p-xjiR7d2DuG2nuk"], ["updated_at", "2017-08-05 18:18:09.825372"], ["id", 5]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 18:18:09.835524"], ["last_sign_in_at", "2017-08-05 18:18:09.835524"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 18:18:09.836934"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 18:18:09.840222"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 17ms (Views: 1.1ms | ActiveRecord: 1.2ms)
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 18:18:59.676734"], ["updated_at", "2017-08-05 18:18:59.676734"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$7g..ar4ypPuC/jkYNpEgau6hNQ9J1sp3msrCAa/WnP/rs2nVxl27q"], ["created_at", "2017-08-05 18:18:59.804482"], ["updated_at", "2017-08-05 18:18:59.804482"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:sDz9raMz9JtCWsLR56ro"], ["updated_at", "2017-08-05 18:18:59.806539"], ["id", 1]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$V9oum90Q.JWCY/kjEtsXr.mNyYanmq4PBToajAWnm2XfySUUAwlna"], ["created_at", "2017-08-05 18:18:59.812547"], ["updated_at", "2017-08-05 18:18:59.812547"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:pH7hKZCubXeyeGAvb-4N"], ["updated_at", "2017-08-05 18:18:59.814217"], ["id", 2]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$V/yPUf5ZKE3bAQbLPFv5j.PDI5GJli50rUFSkAbi8ZjS8kPjI.Vza"], ["created_at", "2017-08-05 18:18:59.823490"], ["updated_at", "2017-08-05 18:18:59.823490"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:8MjhUDsA9MfHrmYoRTyz"], ["updated_at", "2017-08-05 18:18:59.824879"], ["id", 3]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$CnohHNzy6yPOlU1DzJHUwu9Kfd7yWzqKv6ZF/AbM8lhMuGBC8jwC."], ["created_at", "2017-08-05 18:18:59.829328"], ["updated_at", "2017-08-05 18:18:59.829328"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:XZ6TYT9sqGei1Xh9gx9a"], ["updated_at", "2017-08-05 18:18:59.830412"], ["id", 4]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:18:59.917071"], ["updated_at", "2017-08-05 18:18:59.917071"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$Q0D9rpgKdMTGkaThIJ1RpO97O0TAxtPWBKJ74NppmTgF9ARAqDSOy"], ["access_token", "abc"], ["created_at", "2017-08-05 18:18:59.927090"], ["updated_at", "2017-08-05 18:18:59.927090"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:aHGfpxKufXCHu2s6E93G"], ["updated_at", "2017-08-05 18:18:59.928366"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:18:59.945254"], ["updated_at", "2017-08-05 18:18:59.945254"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$COQw2ifGeGA02ySwfFJ7f.ZRzFwqk1IayHKo0xI0gUVS5AlTnqY56"], ["access_token", "abc"], ["created_at", "2017-08-05 18:18:59.949879"], ["updated_at", "2017-08-05 18:18:59.949879"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:hKLshgf4ehF97U_UWs1-"], ["updated_at", "2017-08-05 18:18:59.951145"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.5ms | ActiveRecord: 2.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
  [1m[35m (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:19:00.507295"], ["updated_at", "2017-08-05 18:19:00.507295"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$s0qiGrehKXx8YkwYKgeqAefRxUm7hR3WMjp55gSF87kOygmKhaOR."], ["access_token", "abc"], ["created_at", "2017-08-05 18:19:00.513395"], ["updated_at", "2017-08-05 18:19:00.513395"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:nnwYhCBozaTbY9jdULi6"], ["updated_at", "2017-08-05 18:19:00.514891"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:19:00.524539"], ["updated_at", "2017-08-05 18:19:00.524539"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$bmWynD.KLMjW5YEop1XfFOyDqukAIBoeTn5c12tQc9sm.JdB6M/Su"], ["access_token", "abc"], ["created_at", "2017-08-05 18:19:00.528920"], ["updated_at", "2017-08-05 18:19:00.528920"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:51WZ6_111PW8xUXh-z3E"], ["updated_at", "2017-08-05 18:19:00.530196"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:19:00.535763"], ["updated_at", "2017-08-05 18:19:00.535763"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$6gHtnD.gnIraCJ88wwF2tOAIx4h9JWXXOMk5BkAYeEuMeIgsxCWXm"], ["access_token", "abc"], ["created_at", "2017-08-05 18:19:00.539558"], ["updated_at", "2017-08-05 18:19:00.539558"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:mm395Xzwyqqt3Ltqzxr5"], ["updated_at", "2017-08-05 18:19:00.540791"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.2ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 18:19:00.560668"], ["id", 5]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 20ms (ActiveRecord: 1.0ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:19:00.570859"], ["updated_at", "2017-08-05 18:19:00.570859"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$i5c8sTMW07FnYNpwcmGAXeP5804qVpmg38IYE6Zo.7SkL3bfGqPEG"], ["access_token", "abc"], ["created_at", "2017-08-05 18:19:00.575716"], ["updated_at", "2017-08-05 18:19:00.575716"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:TFpSMaR6enYsbg5WcHmA"], ["updated_at", "2017-08-05 18:19:00.577295"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 18:19:00.580629"], ["last_sign_in_at", "2017-08-05 18:19:00.580629"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 18:19:00.581244"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 18:19:00.583812"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.6ms | ActiveRecord: 0.7ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (2.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 18:20:12.938533"], ["updated_at", "2017-08-05 18:20:12.938533"]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$6yYTJyTNL2MVw7fB4nirwu9RVb2CQ6eKWq.0KkaDYG.ag/TFxwnZy"], ["created_at", "2017-08-05 18:20:13.063063"], ["updated_at", "2017-08-05 18:20:13.063063"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:UQqVxD7d-2ggQrJJTLom"], ["updated_at", "2017-08-05 18:20:13.064860"], ["id", 1]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$glgU4H1jGrMRGUzA7GqtUOyfsPuE0ZivNv9Lhserx8oUdKFsNC6hq"], ["created_at", "2017-08-05 18:20:13.069866"], ["updated_at", "2017-08-05 18:20:13.069866"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:VcryDg4P9BLgjVjexznz"], ["updated_at", "2017-08-05 18:20:13.071056"], ["id", 2]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$NNfK1dF93Gtwp8VmWQI5HupfEMQdDYKCEL8jKXfYzhWWGus00r8RC"], ["created_at", "2017-08-05 18:20:13.078606"], ["updated_at", "2017-08-05 18:20:13.078606"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:d8yhb9nfDayQjwxM_swL"], ["updated_at", "2017-08-05 18:20:13.080599"], ["id", 3]]
  [1m[35m (1.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$uBXHH8P2dG/GN9PHBDFiIOkA6iN7eN5Sg95YdYthhmdSrw5wWPKWe"], ["created_at", "2017-08-05 18:20:13.087935"], ["updated_at", "2017-08-05 18:20:13.087935"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:Kzzjzi299xn9eKnAPKp7"], ["updated_at", "2017-08-05 18:20:13.090107"], ["id", 4]]
  [1m[35m (1.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:20:13.173849"], ["updated_at", "2017-08-05 18:20:13.173849"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$K278znV7ieNKYQ3cuJKLXu4U8poi41Bf.9sOo784QRSeczwEBmQsm"], ["access_token", "abc"], ["created_at", "2017-08-05 18:20:13.184179"], ["updated_at", "2017-08-05 18:20:13.184179"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:zz2hmYxN3ncuB68JzzYN"], ["updated_at", "2017-08-05 18:20:13.185717"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:20:13.202258"], ["updated_at", "2017-08-05 18:20:13.202258"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$XZ12xPGgGQhEs/ckA5I86excs.J98mcnThs.wwnib6t36VhbiS6dG"], ["access_token", "abc"], ["created_at", "2017-08-05 18:20:13.206242"], ["updated_at", "2017-08-05 18:20:13.206242"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:1ms_JkDb-k2Z55K5jdDm"], ["updated_at", "2017-08-05 18:20:13.207509"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.7ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.8ms | ActiveRecord: 1.0ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:20:13.746225"], ["updated_at", "2017-08-05 18:20:13.746225"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$Fl6uD.gGmf1Vt/CaOmqhR.e2p3/Rqe7XHirBa8mVUoxzyRSoIvrbO"], ["access_token", "abc"], ["created_at", "2017-08-05 18:20:13.750435"], ["updated_at", "2017-08-05 18:20:13.750435"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:JxSKDwc1YXZPjfztZKSx"], ["updated_at", "2017-08-05 18:20:13.751649"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:20:13.760784"], ["updated_at", "2017-08-05 18:20:13.760784"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$Rit0tCx1yoFMns0obsgsSuJ7Ri4aQaEW1MeKRmxCLQXXqX4xkuG3q"], ["access_token", "abc"], ["created_at", "2017-08-05 18:20:13.765071"], ["updated_at", "2017-08-05 18:20:13.765071"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:apx-tqK8Uqn3sJ4sVRQJ"], ["updated_at", "2017-08-05 18:20:13.766298"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:20:13.771321"], ["updated_at", "2017-08-05 18:20:13.771321"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$PfwK0mtfnRt.poZgf5/1K.iGvY9UUsC1niZbtM/jxCwncs3HwWkaG"], ["access_token", "abc"], ["created_at", "2017-08-05 18:20:13.775092"], ["updated_at", "2017-08-05 18:20:13.775092"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:CBnwiNaZkxuVzXN2Jgyi"], ["updated_at", "2017-08-05 18:20:13.776790"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 18:20:13.792129"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 15ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:20:13.798928"], ["updated_at", "2017-08-05 18:20:13.798928"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$lqmST/n7t/Y8k.4iim4ppOSlIyFnXu3uMB1Vrav7nGHMst8n0jm2."], ["access_token", "abc"], ["created_at", "2017-08-05 18:20:13.802605"], ["updated_at", "2017-08-05 18:20:13.802605"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:YybiNxzHLxDpe-hR_qrs"], ["updated_at", "2017-08-05 18:20:13.803760"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 18:20:13.806371"], ["last_sign_in_at", "2017-08-05 18:20:13.806371"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 18:20:13.807029"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 18:20:13.809252"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 8ms (Views: 0.6ms | ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 18:21:26.220106"], ["updated_at", "2017-08-05 18:21:26.220106"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.1ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (2.3ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (1.9ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$Aege6o3MJggGYUr0QjYyc.ek04JGMKriYcGngddKDFbYHBk7c13Ry"], ["created_at", "2017-08-05 18:21:26.362752"], ["updated_at", "2017-08-05 18:21:26.362752"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:L9qoho5uXN69VH3WnyPD"], ["updated_at", "2017-08-05 18:21:26.364339"], ["id", 1]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$JGmZlGRDOZEZuWG8qxrd.e.nx34JM5ZNled1hZuT.oEUK/xDSF.C6"], ["created_at", "2017-08-05 18:21:26.369539"], ["updated_at", "2017-08-05 18:21:26.369539"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:zpa86ikyMbHBeoDbpfXX"], ["updated_at", "2017-08-05 18:21:26.370681"], ["id", 2]]
  [1m[35m (1.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (1.1ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$9N/9I5/jdFQbuWevVTtn/unrcDFWX9xGLxTWhokTrXHu63Xn8DLoi"], ["created_at", "2017-08-05 18:21:26.380751"], ["updated_at", "2017-08-05 18:21:26.380751"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.6ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:wEn1R3CB1BJXCz2ixNHX"], ["updated_at", "2017-08-05 18:21:26.382662"], ["id", 3]]
  [1m[35m (1.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$cyGeZTxMRpu5b1vTrIp0Ee6tXSeCEVzmw1OkP.CXURpiQZ3vlwcHa"], ["created_at", "2017-08-05 18:21:26.391127"], ["updated_at", "2017-08-05 18:21:26.391127"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:3KJHsiAJrChVdWLHrxz9"], ["updated_at", "2017-08-05 18:21:26.393659"], ["id", 4]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.7ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:21:26.466239"], ["updated_at", "2017-08-05 18:21:26.466239"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$i90aT5OM3JeQcYk/kCLJ9.8ksGXJNdAaSk32PHz.xPObJmKZZiuLC"], ["access_token", "abc"], ["created_at", "2017-08-05 18:21:26.470583"], ["updated_at", "2017-08-05 18:21:26.470583"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:GroUH9kqt1Yyzxj-bzJK"], ["updated_at", "2017-08-05 18:21:26.471791"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:21:26.487720"], ["updated_at", "2017-08-05 18:21:26.487720"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$k4dIHRB2a71/P79cYLnLSucGZ7uulDEjnRt7tkzZjxs/WD7QNJTpm"], ["access_token", "abc"], ["created_at", "2017-08-05 18:21:26.492499"], ["updated_at", "2017-08-05 18:21:26.492499"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:1ypg-hFypt1TyoHf2a8f"], ["updated_at", "2017-08-05 18:21:26.493870"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.5ms | ActiveRecord: 1.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.4ms | ActiveRecord: 2.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 0.6ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:21:27.043028"], ["updated_at", "2017-08-05 18:21:27.043028"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$JnJPmortPf2nzB4Z9nmjcuPo7bA.n/0I6HKLTFnHY2TA.RqbBsDxu"], ["access_token", "abc"], ["created_at", "2017-08-05 18:21:27.047953"], ["updated_at", "2017-08-05 18:21:27.047953"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:yVhtazJmZHn_qf-APeqk"], ["updated_at", "2017-08-05 18:21:27.049405"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:21:27.056832"], ["updated_at", "2017-08-05 18:21:27.056832"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$maCZgXQX6PVJEIAfFVY.GuuYu0jBLseB54orxv/D2LpkZTg9Ly1tC"], ["access_token", "abc"], ["created_at", "2017-08-05 18:21:27.060765"], ["updated_at", "2017-08-05 18:21:27.060765"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:6mwjJPZx2zxnnUuUBBdt"], ["updated_at", "2017-08-05 18:21:27.062007"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:21:27.067383"], ["updated_at", "2017-08-05 18:21:27.067383"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$Fe7sz40mZnPNa0v3QGcFTuKDXXjJGEpSRUfUSInfChbxrgp32qq0S"], ["access_token", "abc"], ["created_at", "2017-08-05 18:21:27.071422"], ["updated_at", "2017-08-05 18:21:27.071422"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:JP6XZ4Hk4brkbLYbsW1X"], ["updated_at", "2017-08-05 18:21:27.072541"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 18:21:27.087415"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 15ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:21:27.094825"], ["updated_at", "2017-08-05 18:21:27.094825"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$iJ9AwQFa.ykk2xQPYdNDyexUuvmFXqbCFX.LBv6AR8yACKqlvy1Lu"], ["access_token", "abc"], ["created_at", "2017-08-05 18:21:27.098848"], ["updated_at", "2017-08-05 18:21:27.098848"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:7KmS7zmVj4KZHLhByu-m"], ["updated_at", "2017-08-05 18:21:27.100145"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 18:21:27.103389"], ["last_sign_in_at", "2017-08-05 18:21:27.103389"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 18:21:27.104031"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 18:21:27.105814"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.7ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 18:21:52.570331"], ["updated_at", "2017-08-05 18:21:52.570331"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$GxsemWxiVOycKTWl0hYQKOKnEgDhqJl4kwHOZBt.vSeTuGuTCUMcO"], ["created_at", "2017-08-05 18:21:52.716222"], ["updated_at", "2017-08-05 18:21:52.716222"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:2SN8_WsavmxafvuPkysz"], ["updated_at", "2017-08-05 18:21:52.718858"], ["id", 1]]
  [1m[35m (1.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$FZ3kAfMJT1KlPoUqoRKjkuxGw2HatOlxKggIJmTdD0ZyHxk60FkHa"], ["created_at", "2017-08-05 18:21:52.726287"], ["updated_at", "2017-08-05 18:21:52.726287"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:ARxy_MrwjznxARHv9Mjb"], ["updated_at", "2017-08-05 18:21:52.727426"], ["id", 2]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$boW7mnBy9aRvujZnxezjiuB3Xot5tTfjzUqNcMmpeTm4/x7sRUanW"], ["created_at", "2017-08-05 18:21:52.734441"], ["updated_at", "2017-08-05 18:21:52.734441"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:XisdHxXii_JMrvy9JFK1"], ["updated_at", "2017-08-05 18:21:52.735620"], ["id", 3]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$5qWMh2xAITf/5.bEQoVJT.7gg6QOT6a6fIp5Jgj4QaFh.XP10q1B6"], ["created_at", "2017-08-05 18:21:52.740163"], ["updated_at", "2017-08-05 18:21:52.740163"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:noB1PFH9bYw5GEHPVjs1"], ["updated_at", "2017-08-05 18:21:52.741316"], ["id", 4]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.7ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:21:52.809060"], ["updated_at", "2017-08-05 18:21:52.809060"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$0eLUCT8RaXWHTu9sakPaFu0ciZPSyMTp..ZlabJZKqp8x.nzk6FDq"], ["access_token", "abc"], ["created_at", "2017-08-05 18:21:52.814267"], ["updated_at", "2017-08-05 18:21:52.814267"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:Hko_A5FnUJf9sKn-s3xp"], ["updated_at", "2017-08-05 18:21:52.815627"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.2ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:21:52.831736"], ["updated_at", "2017-08-05 18:21:52.831736"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$hGUxzPfRq7oZ6hWnTFa9vOFP9ifME2FH3OSWlOVxiZaGGpT5rMpy."], ["access_token", "abc"], ["created_at", "2017-08-05 18:21:52.836257"], ["updated_at", "2017-08-05 18:21:52.836257"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:xuy6yM9R-vzwisGAFm2e"], ["updated_at", "2017-08-05 18:21:52.837862"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.9ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:21:53.379578"], ["updated_at", "2017-08-05 18:21:53.379578"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$XdtKKljXDXUYyt5oG0LcG.qcfx/0Ru4.Y1eU5yyVCXI0.vax7W.oy"], ["access_token", "abc"], ["created_at", "2017-08-05 18:21:53.384252"], ["updated_at", "2017-08-05 18:21:53.384252"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:pfNrx1fydc5tCip1DqS9"], ["updated_at", "2017-08-05 18:21:53.385633"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:21:53.393750"], ["updated_at", "2017-08-05 18:21:53.393750"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$pBNgUONcQ87KvW4HHigEEO3BFr5RAG9k7G29ZlIO6c2JTnJDCwkHq"], ["access_token", "abc"], ["created_at", "2017-08-05 18:21:53.397628"], ["updated_at", "2017-08-05 18:21:53.397628"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:MMNVDBbH9-UafzYHsFvm"], ["updated_at", "2017-08-05 18:21:53.398838"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.0ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.0ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:21:53.404294"], ["updated_at", "2017-08-05 18:21:53.404294"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$kknaY7cpbKD9NFtHTXEn5uZUH8WRp4Xvs9LWcEbFAZs6yOizeh1d6"], ["access_token", "abc"], ["created_at", "2017-08-05 18:21:53.408980"], ["updated_at", "2017-08-05 18:21:53.408980"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:hTves-s_D5bFaXXzsSF3"], ["updated_at", "2017-08-05 18:21:53.410520"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 18:21:53.428408"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 17ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:21:53.435029"], ["updated_at", "2017-08-05 18:21:53.435029"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$JtVxazi9XOI49jxQBKvA8OlyNENT13glSXN/Fd5Tk48x1HhV7R3Vy"], ["access_token", "abc"], ["created_at", "2017-08-05 18:21:53.439317"], ["updated_at", "2017-08-05 18:21:53.439317"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:DVAx2gg4kHsx8Jv-ZgNN"], ["updated_at", "2017-08-05 18:21:53.440641"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 18:21:53.443499"], ["last_sign_in_at", "2017-08-05 18:21:53.443499"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 18:21:53.444249"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 18:21:53.446346"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.7ms | ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 18:31:26.633613"], ["updated_at", "2017-08-05 18:31:26.633613"]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (2.6ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$AHQaHxx9RQjROfVzt.lt6.d2bDPQpI1vSvXeJ5WN91YNcRhdwQn8."], ["created_at", "2017-08-05 18:31:26.772613"], ["updated_at", "2017-08-05 18:31:26.772613"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:6GjnhFrN9YiVssuRkkx2"], ["updated_at", "2017-08-05 18:31:26.774690"], ["id", 1]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$gVTwsBfmbk5eqglaeI.Jv.M4YamKESHuzUqFz8QezEGk1Ynx3EgqG"], ["created_at", "2017-08-05 18:31:26.780344"], ["updated_at", "2017-08-05 18:31:26.780344"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:joUc5Z3X4fyirgsuhzjJ"], ["updated_at", "2017-08-05 18:31:26.781660"], ["id", 2]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (1.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$g0ZyRK7PyIPI5vewvYlW.eqZYZsVHF9kVZNVRaFQ87PHhfn7VF4j6"], ["created_at", "2017-08-05 18:31:26.792073"], ["updated_at", "2017-08-05 18:31:26.792073"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:1yhWLji-tSwtQWio8iUS"], ["updated_at", "2017-08-05 18:31:26.798999"], ["id", 3]]
  [1m[35m (1.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$OkaygRaBfOdNKgyvIDBHWuaMyjBRlGt517fs6rsvZkaIuiiYyFBYq"], ["created_at", "2017-08-05 18:31:26.808524"], ["updated_at", "2017-08-05 18:31:26.808524"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:YYsBPp_ZD6MC1ye83bJ4"], ["updated_at", "2017-08-05 18:31:26.810772"], ["id", 4]]
  [1m[35m (1.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (2.1ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.7ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:31:26.891083"], ["updated_at", "2017-08-05 18:31:26.891083"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$XpkWmxyH4SnS5ubFq0YIoubmr6JDCbFXfl7XeOxkZEx/QRGEpSQRy"], ["access_token", "abc"], ["created_at", "2017-08-05 18:31:26.896491"], ["updated_at", "2017-08-05 18:31:26.896491"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:6MhX6M5bi_ExsRqQNKEG"], ["updated_at", "2017-08-05 18:31:26.897942"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:31:26.912530"], ["updated_at", "2017-08-05 18:31:26.912530"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$2.XMwk0zN4MYVi4c9hYZbuiyH6m7bFZeIZNCXDPnzhCBHf0RX4Knm"], ["access_token", "abc"], ["created_at", "2017-08-05 18:31:26.923012"], ["updated_at", "2017-08-05 18:31:26.923012"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:Kqjxh5fmWsBPgmLVHdsT"], ["updated_at", "2017-08-05 18:31:26.924439"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 9ms (Views: 0.5ms | ActiveRecord: 1.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.1ms)
  [1m[35m (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:31:27.489081"], ["updated_at", "2017-08-05 18:31:27.489081"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$o2QNSG.RXrfM3LyZuj0nEuR6dXGY8KDnPsFgoHxIhSDGyZ.cLTJpe"], ["access_token", "abc"], ["created_at", "2017-08-05 18:31:27.493357"], ["updated_at", "2017-08-05 18:31:27.493357"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:CE7AVmgauxTtMtJj4ZxS"], ["updated_at", "2017-08-05 18:31:27.494558"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:31:27.505805"], ["updated_at", "2017-08-05 18:31:27.505805"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$PxSMAhvXSoJky2vfwJSNeOtP.fU0nH4DzMKTcB1uySOROt1Tvztxy"], ["access_token", "abc"], ["created_at", "2017-08-05 18:31:27.509718"], ["updated_at", "2017-08-05 18:31:27.509718"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:sCHz7jSqrAXT_sGttFyY"], ["updated_at", "2017-08-05 18:31:27.510953"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:31:27.517445"], ["updated_at", "2017-08-05 18:31:27.517445"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$eSOgFgTsX5BmB/PRbdKDRe0lPplOgFkilyCD45EIs16dm2iETHbJK"], ["access_token", "abc"], ["created_at", "2017-08-05 18:31:27.521604"], ["updated_at", "2017-08-05 18:31:27.521604"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:hJhgxucKo___PmvcW2jz"], ["updated_at", "2017-08-05 18:31:27.523325"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 18:31:27.539323"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 16ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:31:27.545543"], ["updated_at", "2017-08-05 18:31:27.545543"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$m7PxMzNd7qR43EaGOExRDuC1J2JsNgRyuIMS7AZ2V.1Y6jt22KcbW"], ["access_token", "abc"], ["created_at", "2017-08-05 18:31:27.550426"], ["updated_at", "2017-08-05 18:31:27.550426"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:sHubYs-s67xPj_VpR9zk"], ["updated_at", "2017-08-05 18:31:27.552030"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 18:31:27.555500"], ["last_sign_in_at", "2017-08-05 18:31:27.555500"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 18:31:27.556130"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 18:31:27.557855"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.8ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 18:32:24.016759"], ["updated_at", "2017-08-05 18:32:24.016759"]]
  [1m[35m (1.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$e0RhfTYl5ZwbgwWOUPuGk.sPvfxrdYBGH6LYI8C/m5izUZasW8MIy"], ["created_at", "2017-08-05 18:32:24.159147"], ["updated_at", "2017-08-05 18:32:24.159147"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:Bwm1tsLstPGPgKcPeqje"], ["updated_at", "2017-08-05 18:32:24.161892"], ["id", 1]]
  [1m[35m (1.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$7PF/ax4.jB3GnIc6.MsVRuISpgVlzrL49.Bfb.yYfr3UrihZ5GKAW"], ["created_at", "2017-08-05 18:32:24.170619"], ["updated_at", "2017-08-05 18:32:24.170619"]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:ieuYH19HWEF7-nJiHySC"], ["updated_at", "2017-08-05 18:32:24.173519"], ["id", 2]]
  [1m[35m (1.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (1.6ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$VsewrSyNzb1S1m5Yjnj4puFs0a/3Emhxw8Cb2onHmMYanxU/GiXoa"], ["created_at", "2017-08-05 18:32:24.190113"], ["updated_at", "2017-08-05 18:32:24.190113"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.6ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:fQcVyEsCJUshUrWLQyrS"], ["updated_at", "2017-08-05 18:32:24.194225"], ["id", 3]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$ji04ePhTudsKkOTkz4dloOYfSN1p1BkDjic2UwX4wD140VeKXRTN2"], ["created_at", "2017-08-05 18:32:24.201975"], ["updated_at", "2017-08-05 18:32:24.201975"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:x9hwUywTT-fuPGihys_6"], ["updated_at", "2017-08-05 18:32:24.203265"], ["id", 4]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.4ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.3ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (1.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:32:24.330488"], ["updated_at", "2017-08-05 18:32:24.330488"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$3qgkvg3Yu1StX9B98TXCSeVdh.CfyoEOOvpZtnEmtJGh8tJVJcxoC"], ["access_token", "abc"], ["created_at", "2017-08-05 18:32:24.343764"], ["updated_at", "2017-08-05 18:32:24.343764"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:6EC8Ngi-ZEybewvU5aDS"], ["updated_at", "2017-08-05 18:32:24.347927"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.3ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:32:24.372881"], ["updated_at", "2017-08-05 18:32:24.372881"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.4ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$jiu8SPCbQl7R2h6NKTvkAOWtDrz.Hbitdh13UxM3qfBHKaSHk/YEO"], ["access_token", "abc"], ["created_at", "2017-08-05 18:32:24.401060"], ["updated_at", "2017-08-05 18:32:24.401060"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:B_PjnxuG7x4HtMoWxjKu"], ["updated_at", "2017-08-05 18:32:24.404339"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.7ms)
  [1m[35m (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:32:24.965064"], ["updated_at", "2017-08-05 18:32:24.965064"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$cI8lpL3ZYcMCGLQFLNiZVOUP6kNBckBc29rW0BS4PELrR14tU10cK"], ["access_token", "abc"], ["created_at", "2017-08-05 18:32:24.969465"], ["updated_at", "2017-08-05 18:32:24.969465"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:VS39s_RcFguKhXxNXgco"], ["updated_at", "2017-08-05 18:32:24.970743"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:32:24.982241"], ["updated_at", "2017-08-05 18:32:24.982241"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$IovdJBlBoQNm60dS8m6nw.oa0PcrmhKt1Th8JKvuAAEvXhz4wlrM."], ["access_token", "abc"], ["created_at", "2017-08-05 18:32:24.986543"], ["updated_at", "2017-08-05 18:32:24.986543"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:XsDCwgjLFbri27aEMmxs"], ["updated_at", "2017-08-05 18:32:24.987975"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:32:24.993285"], ["updated_at", "2017-08-05 18:32:24.993285"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$9dhasv.yZITpfdizyijl0.TSqzCQSgnJLXULuE2IiscUStbbv4CrC"], ["access_token", "abc"], ["created_at", "2017-08-05 18:32:24.999420"], ["updated_at", "2017-08-05 18:32:24.999420"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:Gu-jrXCzcJdcK4QzzqBP"], ["updated_at", "2017-08-05 18:32:25.000599"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 18:32:25.028208"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 30ms (ActiveRecord: 1.2ms)
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:32:25.043097"], ["updated_at", "2017-08-05 18:32:25.043097"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$OeW.fKn7Da/TVBYrbbhwguRt2nM/siRcYtoUBXmOIjo09R9sRksui"], ["access_token", "abc"], ["created_at", "2017-08-05 18:32:25.047895"], ["updated_at", "2017-08-05 18:32:25.047895"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:7giobVa3gadcPHmtSr84"], ["updated_at", "2017-08-05 18:32:25.049607"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 18:32:25.053014"], ["last_sign_in_at", "2017-08-05 18:32:25.053014"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 18:32:25.053680"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 18:32:25.055516"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 16ms (Views: 2.9ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (1.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 18:34:18.148759"], ["updated_at", "2017-08-05 18:34:18.148759"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$X.D5dpE7rvURMCR9.Ko9SuyVp8.K1uS1OdULG7HwfwSg521p93XUO"], ["created_at", "2017-08-05 18:34:18.292298"], ["updated_at", "2017-08-05 18:34:18.292298"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:WsSCx3K8-_53xB9E3f9c"], ["updated_at", "2017-08-05 18:34:18.294708"], ["id", 1]]
  [1m[35m (1.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$hxfVGHXZn5I2lPKmkkKR0OoXaWxEtPw.PaYdfqT474sH8kc.tnXLS"], ["created_at", "2017-08-05 18:34:18.304043"], ["updated_at", "2017-08-05 18:34:18.304043"]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:8vNAYNE_ybKZUXzjwWPR"], ["updated_at", "2017-08-05 18:34:18.306884"], ["id", 2]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$I3IIBOl0OibHnsW8kossj.Sey1EvWQNaEqYsNyuTu8i0dy0fb5iEK"], ["created_at", "2017-08-05 18:34:18.320450"], ["updated_at", "2017-08-05 18:34:18.320450"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:8ZrDyPDBDe19zQA_42uL"], ["updated_at", "2017-08-05 18:34:18.322173"], ["id", 3]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$8O/kMURtiIEIr1/ijXb5W.li5idJu66nr7nyYgFUyygTv34y4XgJa"], ["created_at", "2017-08-05 18:34:18.326965"], ["updated_at", "2017-08-05 18:34:18.326965"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:Rbtm5yxSrzEuVrscuBYe"], ["updated_at", "2017-08-05 18:34:18.328379"], ["id", 4]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.1ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.6ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:34:18.450319"], ["updated_at", "2017-08-05 18:34:18.450319"]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$C3MH/4uCa/pTv1P4icYjGuCRAOeRI7rjm5h5ar/S3ZZHrjaLt9gRS"], ["access_token", "abc"], ["created_at", "2017-08-05 18:34:18.461794"], ["updated_at", "2017-08-05 18:34:18.461794"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:bEYhkWwjsPnvCfxskF4G"], ["updated_at", "2017-08-05 18:34:18.465422"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.3ms | ActiveRecord: 0.3ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (1.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:34:18.501645"], ["updated_at", "2017-08-05 18:34:18.501645"]]
  [1m[35m (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$fsz9iIt18bv2DiHwV2MCouoxfkVrnPDlW34CZIHuVyzNI2hXUaXM6"], ["access_token", "abc"], ["created_at", "2017-08-05 18:34:18.513539"], ["updated_at", "2017-08-05 18:34:18.513539"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:iTA3wPXggZSQfMzUfvd3"], ["updated_at", "2017-08-05 18:34:18.517113"], ["id", 5]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.5ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.6ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.7ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:34:19.087968"], ["updated_at", "2017-08-05 18:34:19.087968"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$a7T2hKnC9sR59EmYK5YDBeAwHJbaZm1aAggBTBYJb0SRZyEdFEIhi"], ["access_token", "abc"], ["created_at", "2017-08-05 18:34:19.092133"], ["updated_at", "2017-08-05 18:34:19.092133"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:dMbps-3o-y6QrzM61aeF"], ["updated_at", "2017-08-05 18:34:19.093319"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:34:19.099290"], ["updated_at", "2017-08-05 18:34:19.099290"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$i4vasUcbm00a74a8ZEEHq.r/bXIdWloXD/YiWyiqVe44aPD4qrS9O"], ["access_token", "abc"], ["created_at", "2017-08-05 18:34:19.103471"], ["updated_at", "2017-08-05 18:34:19.103471"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:HX79yZFQcyDuG3atZrTN"], ["updated_at", "2017-08-05 18:34:19.104794"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:34:19.111663"], ["updated_at", "2017-08-05 18:34:19.111663"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$gQM5GTnOtv4PsO1e8s2F3Osx.OqCin8pdqa8MpnXhKy1JWZtR9yX2"], ["access_token", "abc"], ["created_at", "2017-08-05 18:34:19.116300"], ["updated_at", "2017-08-05 18:34:19.116300"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:1Dm24wd6xS76eSn8ZgZY"], ["updated_at", "2017-08-05 18:34:19.118002"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 18:34:19.141266"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 22ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:34:19.147405"], ["updated_at", "2017-08-05 18:34:19.147405"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.7ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$W3EKD2CZr8Q9fntlqcwYDOeaR24hBCIyQLG4W1R7X7Tj5AZmo3dy2"], ["access_token", "abc"], ["created_at", "2017-08-05 18:34:19.158705"], ["updated_at", "2017-08-05 18:34:19.158705"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:HLv-sZJixpBeRsY2es1e"], ["updated_at", "2017-08-05 18:34:19.163691"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 18:34:19.171391"], ["last_sign_in_at", "2017-08-05 18:34:19.171391"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 18:34:19.173342"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 18:34:19.179240"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 18ms (Views: 0.8ms | ActiveRecord: 1.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 18:36:01.249098"], ["updated_at", "2017-08-05 18:36:01.249098"]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$IJNGaKWcnBzNzs2EUt5ei.toiUX5j.UBoz.1Ge6KVPERcS8Z2Sn7i"], ["created_at", "2017-08-05 18:36:01.408010"], ["updated_at", "2017-08-05 18:36:01.408010"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.3ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:Ek44-dMXiXVj-BqF6wSS"], ["updated_at", "2017-08-05 18:36:01.412944"], ["id", 1]]
  [1m[35m (1.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$GCtmg8yZcaBe/ElJOJNlVufrTqnXLLOzYRmfghapVu2EyxD2fPHXS"], ["created_at", "2017-08-05 18:36:01.422439"], ["updated_at", "2017-08-05 18:36:01.422439"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:Mzyn-xZkAJhznNJzdMEc"], ["updated_at", "2017-08-05 18:36:01.423854"], ["id", 2]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (1.2ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$XzLOlBmuDkrLoKjBOreWS.cRShHDu20jqEcImxqj.sf.dRvNYlqKe"], ["created_at", "2017-08-05 18:36:01.433853"], ["updated_at", "2017-08-05 18:36:01.433853"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:7asqF_xxaK_Tp7_ByTxN"], ["updated_at", "2017-08-05 18:36:01.435341"], ["id", 3]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$pXcBF89JemyGp6djftuMSu.xaZHUW7TUbkYHIWMksliNNyVZ7IMWW"], ["created_at", "2017-08-05 18:36:01.439437"], ["updated_at", "2017-08-05 18:36:01.439437"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:Knk9-w_QzMP_8ViyxNEP"], ["updated_at", "2017-08-05 18:36:01.440594"], ["id", 4]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (1.4ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.1ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.7ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:36:01.521657"], ["updated_at", "2017-08-05 18:36:01.521657"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$cWudKALt8TTylWRsvmnTdeaxnz/LEC5EAlq/MPpYtT05qosMDvPGK"], ["access_token", "abc"], ["created_at", "2017-08-05 18:36:01.525743"], ["updated_at", "2017-08-05 18:36:01.525743"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:TtxLGRMGqxTRzg7BNrvM"], ["updated_at", "2017-08-05 18:36:01.526940"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:36:01.530149"], ["updated_at", "2017-08-05 18:36:01.530149"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$3WBqq0MI0apRUr6mZVH3Ie3I.F9F/8quhhgWQM8yUvwey8oaKfgWu"], ["access_token", "abc"], ["created_at", "2017-08-05 18:36:01.533887"], ["updated_at", "2017-08-05 18:36:01.533887"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:FbK1s3iWtzbGmdUPbMaz"], ["updated_at", "2017-08-05 18:36:01.535345"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:36:01.538591"], ["updated_at", "2017-08-05 18:36:01.538591"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$KM1FJX3jmFr16nQFdQglNe6ywKQq/sXrtIQXIwciNanynb9icdxPG"], ["access_token", "abc"], ["created_at", "2017-08-05 18:36:01.542116"], ["updated_at", "2017-08-05 18:36:01.542116"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:zZpaYB5Zcy6CDgbP2nG1"], ["updated_at", "2017-08-05 18:36:01.543546"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:36:01.553294"], ["updated_at", "2017-08-05 18:36:01.553294"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$kwveEBHfSPDCAQKAgwQvUuo8oYg8EgS.Nb1Wc6cjW/Y62/VcxgU9."], ["access_token", "abc"], ["created_at", "2017-08-05 18:36:01.557057"], ["updated_at", "2017-08-05 18:36:01.557057"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:BE96KbgvfsvkifMFcvN_"], ["updated_at", "2017-08-05 18:36:01.558285"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:36:01.574797"], ["updated_at", "2017-08-05 18:36:01.574797"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$PtLVemjBp47EVKJBAE2kveAKAyqBMqTed.QPN.zPkm1uayot0o1eC"], ["access_token", "abc"], ["created_at", "2017-08-05 18:36:01.578515"], ["updated_at", "2017-08-05 18:36:01.578515"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:2-qxy1yis7zjzXoeAfXs"], ["updated_at", "2017-08-05 18:36:01.579741"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 18:36:01.596707"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 17ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:36:01.604023"], ["updated_at", "2017-08-05 18:36:01.604023"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$fZ6FTen3OqzaF6YxW7tufu6/RS/mspS2amGp2wDeQDrbEE664Zhdy"], ["access_token", "abc"], ["created_at", "2017-08-05 18:36:01.607822"], ["updated_at", "2017-08-05 18:36:01.607822"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:sYStS_tsXB47WVYM43YF"], ["updated_at", "2017-08-05 18:36:01.609193"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 18:36:01.612960"], ["last_sign_in_at", "2017-08-05 18:36:01.612960"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 18:36:01.613678"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 18:36:01.615701"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.0ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.4ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 18:36:50.487589"], ["updated_at", "2017-08-05 18:36:50.487589"]]
  [1m[35m (0.9ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.1ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$z/erqQiH58hh67GxW0yjiuRZ5DDhy1h5seeRMPsRyYYKHHZW4DaLW"], ["created_at", "2017-08-05 18:36:50.641310"], ["updated_at", "2017-08-05 18:36:50.641310"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:GnRVy4oGB3GbWkHyxkWs"], ["updated_at", "2017-08-05 18:36:50.643307"], ["id", 1]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$sMsoZjL9M.ierwZN/udP4uje2mlQYgQyuMi4ssFb5mRySCLCLDleC"], ["created_at", "2017-08-05 18:36:50.648510"], ["updated_at", "2017-08-05 18:36:50.648510"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:WMi2dc7KW2uBNzYWejPW"], ["updated_at", "2017-08-05 18:36:50.650016"], ["id", 2]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$vk4A2/4fesRYM48tFyJ9xu0h5jyERXlZ9sIXNMTAAUJltXKV6OxzS"], ["created_at", "2017-08-05 18:36:50.656882"], ["updated_at", "2017-08-05 18:36:50.656882"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:e4ugDotv6rMvJo-NqPkf"], ["updated_at", "2017-08-05 18:36:50.658244"], ["id", 3]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$SA8psCYFSLD.QH.LvCyUFO8rYp8yy4KmpSX6bV6ywtzMj1KHcTESS"], ["created_at", "2017-08-05 18:36:50.662883"], ["updated_at", "2017-08-05 18:36:50.662883"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:AaKEkMk6Z6Kf4byhpjBt"], ["updated_at", "2017-08-05 18:36:50.664177"], ["id", 4]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.5ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:36:50.742404"], ["updated_at", "2017-08-05 18:36:50.742404"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$p0GSEVzLG/xJabN8nmebSuAtkBfbiqsqeVf16UZeMYuKjkfpf895."], ["access_token", "abc"], ["created_at", "2017-08-05 18:36:50.746928"], ["updated_at", "2017-08-05 18:36:50.746928"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:MA_qGUrwMTSNNcKtbtNL"], ["updated_at", "2017-08-05 18:36:50.748223"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:36:50.770833"], ["updated_at", "2017-08-05 18:36:50.770833"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$.vRnKLEs4LkfpRQwdu0Unei9YfdXctlxn0Hr1LMger3vOQ7Lm8UaK"], ["access_token", "abc"], ["created_at", "2017-08-05 18:36:50.775839"], ["updated_at", "2017-08-05 18:36:50.775839"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:krBxc5saCcAxn7yqwqzc"], ["updated_at", "2017-08-05 18:36:50.777415"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.6ms | ActiveRecord: 1.3ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 1.2ms | ActiveRecord: 1.5ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.5ms | ActiveRecord: 1.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.5ms | ActiveRecord: 1.2ms)
  [1m[35m (1.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:36:51.319614"], ["updated_at", "2017-08-05 18:36:51.319614"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$sQDBs9hvssCJ9kFZDlkeK.g7c10dPm85MZIQm8obZ.HuWOi/sv3ny"], ["access_token", "abc"], ["created_at", "2017-08-05 18:36:51.324120"], ["updated_at", "2017-08-05 18:36:51.324120"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:uEE3uto7o1Xy7TiAq1cP"], ["updated_at", "2017-08-05 18:36:51.325846"], ["id", 5]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:36:51.350416"], ["updated_at", "2017-08-05 18:36:51.350416"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$4AfBjPO6mnXQVNbPmLwSDeXj5Yeonk534vMmbOV1TA3GRKsy0Jeuq"], ["access_token", "abc"], ["created_at", "2017-08-05 18:36:51.354196"], ["updated_at", "2017-08-05 18:36:51.354196"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:f4gzA2ZAe6d2q_c1--Ch"], ["updated_at", "2017-08-05 18:36:51.355338"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:36:51.361204"], ["updated_at", "2017-08-05 18:36:51.361204"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$hb/OnOS8YWdIZjb3RoA2OuKouwHvYFj/u//Xza/3GcooW0HOQrwvC"], ["access_token", "abc"], ["created_at", "2017-08-05 18:36:51.365215"], ["updated_at", "2017-08-05 18:36:51.365215"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:GsSMpuAwszB9tqTfm68f"], ["updated_at", "2017-08-05 18:36:51.366507"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 18:36:51.386033"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 20ms (ActiveRecord: 0.7ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:36:51.394242"], ["updated_at", "2017-08-05 18:36:51.394242"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$df8IQkOAkGJNAszawZQQeuIPtSXVJqhL7HeZ0jK6z3k31FIoGk3wy"], ["access_token", "abc"], ["created_at", "2017-08-05 18:36:51.398238"], ["updated_at", "2017-08-05 18:36:51.398238"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:Aur1AGkexmyw7jZeVJFi"], ["updated_at", "2017-08-05 18:36:51.399491"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 18:36:51.402607"], ["last_sign_in_at", "2017-08-05 18:36:51.402607"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 18:36:51.403425"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 18:36:51.405433"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.6ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.3ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 18:38:22.086371"], ["updated_at", "2017-08-05 18:38:22.086371"]]
  [1m[35m (0.6ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (4.4ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (1.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$M.HuK338F257Sfo7NIBOneC8craflIOWtOJsKRS7FXxjXaBoEVnSS"], ["created_at", "2017-08-05 18:38:22.227562"], ["updated_at", "2017-08-05 18:38:22.227562"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:3oUhLxrtb8pVfCdy48ev"], ["updated_at", "2017-08-05 18:38:22.230521"], ["id", 1]]
  [1m[35m (1.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$ABWqIVfL0nri.Ypf5U2.XegbIzwt3IW1IZyJPo4AJAfWPsWm4I.2W"], ["created_at", "2017-08-05 18:38:22.238975"], ["updated_at", "2017-08-05 18:38:22.238975"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:DsqrzK7qWhUxMC83prgY"], ["updated_at", "2017-08-05 18:38:22.240258"], ["id", 2]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$WUT7gocMhrUjmkxyRu8JUuOyXkI5cLwBX1DLHEHAKUABGusp34B.S"], ["created_at", "2017-08-05 18:38:22.247821"], ["updated_at", "2017-08-05 18:38:22.247821"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:xYWWQ6iQGvGsoc7gSByR"], ["updated_at", "2017-08-05 18:38:22.249128"], ["id", 3]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$9cETakzNVzGyGeTrTVaR2OSv.nIaF6m77nsSsffXAbqxmMoo0nnKW"], ["created_at", "2017-08-05 18:38:22.254185"], ["updated_at", "2017-08-05 18:38:22.254185"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:354WmCEL7stgcqTDDRFw"], ["updated_at", "2017-08-05 18:38:22.255677"], ["id", 4]]
  [1m[35m (7.3ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (2.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.6ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (5.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:38:22.357307"], ["updated_at", "2017-08-05 18:38:22.357307"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$luWtyOtuhtQ6CIsismPDu.BgD7TNZZ5UgtWq1k.ZksGNu9xbR1XOG"], ["access_token", "abc"], ["created_at", "2017-08-05 18:38:22.361822"], ["updated_at", "2017-08-05 18:38:22.361822"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:iGqtoKPuJyeScHNWjGzr"], ["updated_at", "2017-08-05 18:38:22.363068"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:38:22.385540"], ["updated_at", "2017-08-05 18:38:22.385540"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$/MBKW.M5687qA1I6WPFCeeSRHRC67dv4dXsYwBKq4DaN/k/uJf4x6"], ["access_token", "abc"], ["created_at", "2017-08-05 18:38:22.389956"], ["updated_at", "2017-08-05 18:38:22.389956"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:ogLLTaGzWBqzzc1gbspi"], ["updated_at", "2017-08-05 18:38:22.391170"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.4ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 8ms (Views: 0.8ms | ActiveRecord: 2.1ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.5ms | ActiveRecord: 1.3ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.4ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.4ms | ActiveRecord: 0.9ms)
  [1m[35m (1.0ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:38:22.966901"], ["updated_at", "2017-08-05 18:38:22.966901"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$gEr2lalkTWCtOsVj.IN91.eeKRjHlVBunCTOYFzapsK15iHuBWpQe"], ["access_token", "abc"], ["created_at", "2017-08-05 18:38:22.971715"], ["updated_at", "2017-08-05 18:38:22.971715"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:QToT5s88JzZGjHK2UbnU"], ["updated_at", "2017-08-05 18:38:22.972997"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 2ms (Views: 0.6ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:38:22.997487"], ["updated_at", "2017-08-05 18:38:22.997487"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$Drkw2JbOIVKp85GIBzUMRu8.LM/Y1GLDnakuV3X6/mj0deNrH.7l."], ["access_token", "abc"], ["created_at", "2017-08-05 18:38:23.001645"], ["updated_at", "2017-08-05 18:38:23.001645"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:ptXUkpdzJWNTxgg79QMr"], ["updated_at", "2017-08-05 18:38:23.003441"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:38:23.009769"], ["updated_at", "2017-08-05 18:38:23.009769"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$uyF19voMyioHAwwpLEge5u4PyR9C/zwC5BRppVMc8wgEhA5ihGfwG"], ["access_token", "abc"], ["created_at", "2017-08-05 18:38:23.014026"], ["updated_at", "2017-08-05 18:38:23.014026"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:kv-_bTsur83Uj2-24yc1"], ["updated_at", "2017-08-05 18:38:23.015533"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.2ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 18:38:23.031841"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 16ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:38:23.038891"], ["updated_at", "2017-08-05 18:38:23.038891"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$ajPWdMKrD0IWYf9d3FFWnOhndtyWbjs59wUFwG0zjW4Cw7WTwbs6y"], ["access_token", "abc"], ["created_at", "2017-08-05 18:38:23.043599"], ["updated_at", "2017-08-05 18:38:23.043599"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:1pxnpH-D7EZUMsZwtGn9"], ["updated_at", "2017-08-05 18:38:23.044953"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 18:38:23.048595"], ["last_sign_in_at", "2017-08-05 18:38:23.048595"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 18:38:23.049269"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 18:38:23.051122"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.6ms | ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.1ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (1.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 18:38:58.924324"], ["updated_at", "2017-08-05 18:38:58.924324"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$25a5lLbMg1vGB04Vm3Xmh.Rt4J6AbH5ceJHLYqD2WFaoIrKWEPOKm"], ["created_at", "2017-08-05 18:38:59.065639"], ["updated_at", "2017-08-05 18:38:59.065639"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:qag8Z_xsV3GhSggwyht-"], ["updated_at", "2017-08-05 18:38:59.067604"], ["id", 1]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$8qjxKf94hnsdV/ix1W8tpepiAHOrCTgjsgvWgOdaZ5/pmzYrATZri"], ["created_at", "2017-08-05 18:38:59.075234"], ["updated_at", "2017-08-05 18:38:59.075234"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:1XorLLvjkn4RzwkF2wZe"], ["updated_at", "2017-08-05 18:38:59.076450"], ["id", 2]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.5ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.8ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$QeRTh9ud5QKxT3RmxReG1edDy47K5W7hekrvl2Z6TRfJQTXE3mPay"], ["created_at", "2017-08-05 18:38:59.087911"], ["updated_at", "2017-08-05 18:38:59.087911"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:C4-znzaBH5xYPkFTTG3x"], ["updated_at", "2017-08-05 18:38:59.092701"], ["id", 3]]
  [1m[35m (1.1ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.3ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$/DfzARu2Ho2obLBegPvVJOrMMpvtmfx4UkMVIfYFdlnfIwOp.RHzy"], ["created_at", "2017-08-05 18:38:59.100849"], ["updated_at", "2017-08-05 18:38:59.100849"]]
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:M3LSjMMs883qcJCC_xSs"], ["updated_at", "2017-08-05 18:38:59.104026"], ["id", 4]]
  [1m[35m (1.2ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.8ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.7ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:38:59.189693"], ["updated_at", "2017-08-05 18:38:59.189693"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$cFUG64AC7dKZ.Jn9Tml/I.56xf7fU/MbkviiiRSr.BWk4SBuYBd0e"], ["access_token", "abc"], ["created_at", "2017-08-05 18:38:59.194001"], ["updated_at", "2017-08-05 18:38:59.194001"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:pmqqwiuKXjywvezGsKFD"], ["updated_at", "2017-08-05 18:38:59.195411"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.3ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:38:59.216333"], ["updated_at", "2017-08-05 18:38:59.216333"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$Ux3BkeCYx.cLW.xTMV7mFehaPpssd7Vi7X1X0WtsQWSe4FQlST7TK"], ["access_token", "abc"], ["created_at", "2017-08-05 18:38:59.220279"], ["updated_at", "2017-08-05 18:38:59.220279"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:zsm6-wy54zbVRN8zwwA8"], ["updated_at", "2017-08-05 18:38:59.221700"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.7ms | ActiveRecord: 1.6ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.5ms | ActiveRecord: 1.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 6ms (Views: 0.5ms | ActiveRecord: 2.4ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.7ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.4ms | ActiveRecord: 0.8ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:38:59.769385"], ["updated_at", "2017-08-05 18:38:59.769385"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$VNAmUXNtQiNyVXwuq.9Jfufns6w9pQGFKkGe6xSPKSa6UQ4L93Sj."], ["access_token", "abc"], ["created_at", "2017-08-05 18:38:59.775028"], ["updated_at", "2017-08-05 18:38:59.775028"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:y-U_BCv7w89VEZs3Qjwe"], ["updated_at", "2017-08-05 18:38:59.776580"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:38:59.781855"], ["updated_at", "2017-08-05 18:38:59.781855"]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$u0K3nqs5TXknMgTrFVb6Dez08bHGRGTru/GGjBKIwEWVmWv0JDtoi"], ["access_token", "abc"], ["created_at", "2017-08-05 18:38:59.785390"], ["updated_at", "2017-08-05 18:38:59.785390"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:Vn3crRNrzbpALvVMVyaV"], ["updated_at", "2017-08-05 18:38:59.786551"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:38:59.792241"], ["updated_at", "2017-08-05 18:38:59.792241"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$h9.5SnBxtFRQC1cQ74.WW.b.5PHA8ZIZdBXtGC9XkrM0UlT1RtPY6"], ["access_token", "abc"], ["created_at", "2017-08-05 18:38:59.796261"], ["updated_at", "2017-08-05 18:38:59.796261"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:TxyzaQGV1cBnYQsBzgRe"], ["updated_at", "2017-08-05 18:38:59.797568"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.2ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 18:38:59.815477"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 17ms (ActiveRecord: 0.6ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:38:59.822413"], ["updated_at", "2017-08-05 18:38:59.822413"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$6HBuLDmFmTDYGtuM2Bd/buTIvz8Gj1u/dQ8d.e7byMWg4Vgog9H3O"], ["access_token", "abc"], ["created_at", "2017-08-05 18:38:59.826357"], ["updated_at", "2017-08-05 18:38:59.826357"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:tttZVLE4tgW2hzL3PPi9"], ["updated_at", "2017-08-05 18:38:59.827732"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 18:38:59.831062"], ["last_sign_in_at", "2017-08-05 18:38:59.831062"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 18:38:59.831890"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 18:38:59.833697"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.7ms | ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "environment"]]
  [1m[35m (0.1ms)[0m  [1m[35mDROP TABLE IF EXISTS "shops"[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (1.1ms)[0m  [1m[35mCREATE TABLE "shops" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "shopify_domain" varchar, "shopify_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "users"[0m
  [1m[35m (1.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, "email" varchar DEFAULT '' NOT NULL, "encrypted_password" varchar DEFAULT '' NOT NULL, "reset_password_token" varchar, "reset_password_sent_at" datetime, "remember_created_at" datetime, "sign_in_count" integer DEFAULT 0 NOT NULL, "current_sign_in_at" datetime, "last_sign_in_at" datetime, "current_sign_in_ip" varchar, "last_sign_in_ip" varchar, "name" varchar, "confirmed" boolean, "access_token" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL, "kit_access_token" varchar, "kit_user_id" varchar, "first_name" varchar, "last_name" varchar, "shop_id" integer)[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.2ms)[0m  [1m[34m            SELECT sql
            FROM sqlite_master
            WHERE name='index_users_on_email' AND type='index'
            UNION ALL
            SELECT sql
            FROM sqlite_temp_master
            WHERE name='index_users_on_email' AND type='index'
[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (0.9ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" varchar NOT NULL PRIMARY KEY)[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (20170803102112)[0m
  [1m[35m (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(20160809214321),
(20170802202410);

[0m
  [1m[35m (0.8ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" varchar NOT NULL PRIMARY KEY, "value" varchar, "created_at" datetime NOT NULL, "updated_at" datetime NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["key", "environment"], ["value", "test"], ["created_at", "2017-08-05 18:39:26.534579"], ["updated_at", "2017-08-05 18:39:26.534579"]]
  [1m[35m (0.8ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.1ms)[0m  [1m[34mSELECT  "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ? LIMIT ?[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35mSQL (1.1ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user1@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user1@example.io"], ["encrypted_password", "$2a$04$yFLJOnuZy1RTttnvGLKRxeNoM51Uwg4XxdaMbnjJ1sGTMsP.OLqMC"], ["created_at", "2017-08-05 18:39:26.677101"], ["updated_at", "2017-08-05 18:39:26.677101"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "1:C1g4L2gEndh6EAxt2TxB"], ["updated_at", "2017-08-05 18:39:26.679038"], ["id", 1]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user2@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user2@example.io"], ["encrypted_password", "$2a$04$ckLjr.ObChaoHzXGzf/3aOFc.OXpf5sYJpRkQ9b1AypJgGQU0KVdm"], ["created_at", "2017-08-05 18:39:26.684523"], ["updated_at", "2017-08-05 18:39:26.684523"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "2:69rWK4_BzupsU2vx-wms"], ["updated_at", "2017-08-05 18:39:26.685760"], ["id", 2]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35mSQL (0.7ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.2ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user3@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at", "kit_access_token") VALUES (?, ?, ?, ?, ?)[0m  [["email", "user3@example.io"], ["encrypted_password", "$2a$04$9fN7tl1DmoZ0E6c5LTyN1echKl2hiriwWMF7d0/1.24b4FxZUqQjy"], ["created_at", "2017-08-05 18:39:26.693005"], ["updated_at", "2017-08-05 18:39:26.693005"], ["kit_access_token", "something"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "3:yVcDX_Lb3s-xWs4MkBi8"], ["updated_at", "2017-08-05 18:39:26.694323"], ["id", 3]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[35m (0.0ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user4@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["email", "user4@example.io"], ["encrypted_password", "$2a$04$SPEQ8attCnePybEzp4NFruTJn8HNB74LWZZm8Vo99Rp6wSrqlXWYe"], ["created_at", "2017-08-05 18:39:26.700739"], ["updated_at", "2017-08-05 18:39:26.700739"]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "4:svzJUy3KZx4eegktDAmf"], ["updated_at", "2017-08-05 18:39:26.701881"], ["id", 4]]
  [1m[35m (0.7ms)[0m  [1m[36mcommit transaction[0m
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (1.0ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.9ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.7ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35mSQL (0.7ms)[0m  [1m[31mDELETE FROM "users"[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:39:26.778921"], ["updated_at", "2017-08-05 18:39:26.778921"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user5@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user5@example.io"], ["encrypted_password", "$2a$04$4TBN0owYmI0DUGjjictli.S3ztHQAWvya1YfeZu1mdScNrfsyHIki"], ["access_token", "abc"], ["created_at", "2017-08-05 18:39:26.783117"], ["updated_at", "2017-08-05 18:39:26.783117"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:5ZaWGY6ZowrEKybmYHmW"], ["updated_at", "2017-08-05 18:39:26.784414"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 3ms (Views: 0.3ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:39:26.805539"], ["updated_at", "2017-08-05 18:39:26.805539"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user6@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user6@example.io"], ["encrypted_password", "$2a$04$Pq1LhlfNgIgxbXcDFBBTlOv3JAhvNHUduqxBgEu8rVbnNi8xo25k."], ["access_token", "abc"], ["created_at", "2017-08-05 18:39:26.810119"], ["updated_at", "2017-08-05 18:39:26.810119"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:6TE2qwenTZ4AoGAuyrJa"], ["updated_at", "2017-08-05 18:39:26.811459"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.5ms | ActiveRecord: 1.0ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 4ms (Views: 0.7ms | ActiveRecord: 0.8ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 5ms (Views: 0.8ms | ActiveRecord: 0.9ms)
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 7ms (Views: 0.6ms | ActiveRecord: 1.8ms)
  [1m[35m (0.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:39:27.387371"], ["updated_at", "2017-08-05 18:39:27.387371"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user7@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user7@example.io"], ["encrypted_password", "$2a$04$6XNT2PG0VGnuHQT/l6Ail.VTrR5EgS6f06WCsR/vCa7lOte8ERNvm"], ["access_token", "abc"], ["created_at", "2017-08-05 18:39:27.392590"], ["updated_at", "2017-08-05 18:39:27.392590"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:LiRx5A1ZiQHF1BsSja36"], ["updated_at", "2017-08-05 18:39:27.394356"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"1234", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "1234"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:39:27.402742"], ["updated_at", "2017-08-05 18:39:27.402742"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user8@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user8@example.io"], ["encrypted_password", "$2a$04$2w8CSWDbQlEJA1I8MT.quOoHy28sRc.dU/M3vCkw3K3sc/QdgzZM."], ["access_token", "abc"], ["created_at", "2017-08-05 18:39:27.408034"], ["updated_at", "2017-08-05 18:39:27.408034"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:Rn-Qz1N6owpCNmWPHh3Y"], ["updated_at", "2017-08-05 18:39:27.409689"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#conversation_callback as HTML
  Parameters: {"conversation_id"=>"5", "user_conversation_id"=>"3486", "user_id"=>"0000", "user_reply"=>"yes"}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."kit_user_id" = ? LIMIT ?[0m  [["kit_user_id", "0000"], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.2ms | ActiveRecord: 0.1ms)
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:39:27.417183"], ["updated_at", "2017-08-05 18:39:27.417183"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user9@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user9@example.io"], ["encrypted_password", "$2a$04$Lq36deFX9yVA1SFKyMxWhO2Hs/lqNYFo/zgn6eCnQIWu6ya6Ck0bS"], ["access_token", "abc"], ["created_at", "2017-08-05 18:39:27.422393"], ["updated_at", "2017-08-05 18:39:27.422393"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:hHdpxs8ox8cw2qjsPTNu"], ["updated_at", "2017-08-05 18:39:27.423936"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#callback as HTML
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT  "shops".* FROM "shops" WHERE "shops"."shopify_domain" = ? LIMIT ?[0m  [["shopify_domain", "example.myshopify.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."shop_id" = ? LIMIT ?[0m  [["shop_id", 1], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "kit_access_token" = ?, "first_name" = ?, "last_name" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["kit_access_token", "tokentokentoken"], ["first_name", "Anton"], ["last_name", "Murygin"], ["updated_at", "2017-08-05 18:39:27.445427"], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Redirected to http://test.host/
Completed 302 Found in 21ms (ActiveRecord: 0.5ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("shopify_domain", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["shopify_domain", "example.myshopify.com"], ["created_at", "2017-08-05 18:39:27.452459"], ["updated_at", "2017-08-05 18:39:27.452459"]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists (0.1ms)[0m  [1m[34mSELECT  1 AS one FROM "users" WHERE "users"."email" = ? LIMIT ?[0m  [["email", "user10@example.io"], ["LIMIT", 1]]
  [1m[35mSQL (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "encrypted_password", "access_token", "created_at", "updated_at", "kit_access_token", "kit_user_id", "shop_id") VALUES (?, ?, ?, ?, ?, ?, ?, ?)[0m  [["email", "user10@example.io"], ["encrypted_password", "$2a$04$sKVLqBrldnwjbY5Jg671VuSR1Ou1YX5VkHP1WF.hQ39b/vogOtjiy"], ["access_token", "abc"], ["created_at", "2017-08-05 18:39:27.457842"], ["updated_at", "2017-08-05 18:39:27.457842"], ["kit_access_token", "1234"], ["kit_user_id", "1234"], ["shop_id", 1]]
  [1m[35mSQL (0.1ms)[0m  [1m[33mUPDATE "users" SET "access_token" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["access_token", "5:spMTs9jxqo--zJaRiKGS"], ["updated_at", "2017-08-05 18:39:27.460227"], ["id", 5]]
  [1m[35m (0.0ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Processing by KitController#destroy as HTML
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? ORDER BY "users"."id" ASC LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "current_sign_in_at" = ?, "last_sign_in_at" = ?, "current_sign_in_ip" = ?, "last_sign_in_ip" = ?, "sign_in_count" = ?, "updated_at" = ? WHERE "users"."id" = ?[0m  [["current_sign_in_at", "2017-08-05 18:39:27.463106"], ["last_sign_in_at", "2017-08-05 18:39:27.463106"], ["current_sign_in_ip", "0.0.0.0"], ["last_sign_in_ip", "0.0.0.0"], ["sign_in_count", 1], ["updated_at", "2017-08-05 18:39:27.463756"], ["id", 5]]
  [1m[35m (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.2ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = ?, "kit_access_token" = ? WHERE "users"."id" = ?[0m  [["updated_at", "2017-08-05 18:39:27.466557"], ["kit_access_token", nil], ["id", 5]]
  [1m[35m (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 11ms (Views: 1.0ms | ActiveRecord: 0.8ms)
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT  "users".* FROM "users" WHERE "users"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[35m (0.5ms)[0m  [1m[31mrollback transaction[0m
  [1m[35m (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[35m (0.1ms)[0m  [1m[31mrollback transaction[0m
